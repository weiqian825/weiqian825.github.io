<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=2"
    />
    <meta name="theme-color" content="#222" />
    <meta name="generator" content="Hexo 3.9.0" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/apple-touch-icon-next.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/favicon-32x32-next.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/images/favicon-16x16-next.png"
    />
    <link rel="mask-icon" href="/images/logo.svg" color="#222" />

    <link rel="stylesheet" href="/css/main.css" />

    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css" />

    <script id="hexo-configurations">
      var NexT = window.NexT || {};
      var CONFIG = {
        hostname: 'yoursite.com',
        root: '/',
        scheme: 'Muse',
        version: '7.8.0',
        exturl: false,
        sidebar: {
          position: 'left',
          display: 'post',
          padding: 18,
          offset: 12,
          onmobile: false,
        },
        copycode: { enable: false, show_result: false, style: null },
        back2top: { enable: true, sidebar: false, scrollpercent: false },
        bookmark: { enable: false, color: '#222', save: 'auto' },
        fancybox: false,
        mediumzoom: false,
        lazyload: false,
        pangu: false,
        comments: {
          style: 'tabs',
          active: null,
          storage: true,
          lazyload: false,
          nav: null,
        },
        algolia: {
          hits: { per_page: 10 },
          labels: {
            input_placeholder: 'Search for Posts',
            hits_empty: "We didn't find any results for the search: ${query}",
            hits_stats: '${hits} results found in ${time} ms',
          },
        },
        localsearch: {
          enable: false,
          trigger: 'auto',
          top_n_per_article: 1,
          unescape: false,
          preload: false,
        },
        motion: {
          enable: true,
          async: false,
          transition: {
            post_block: 'fadeIn',
            post_header: 'slideDownIn',
            post_body: 'slideDownIn',
            coll_header: 'slideLeftIn',
            sidebar: 'slideUpIn',
          },
        },
      };
    </script>

    <meta property="og:type" content="website" />
    <meta property="og:title" content="There is no magic" />
    <meta property="og:url" content="http://yoursite.com/page/5/index.html" />
    <meta property="og:site_name" content="There is no magic" />
    <meta property="og:locale" content="default" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="There is no magic" />

    <link rel="canonical" href="http://yoursite.com/page/5/" />

    <script id="page-configurations">
      // https://hexo.io/docs/variables.html
      CONFIG.page = {
        sidebar: '',
        isHome: true,
        isPost: false,
        lang: 'default',
      };
    </script>

    <title>There is no magic</title>

    <noscript>
      <style>
        .use-motion .brand,
        .use-motion .menu-item,
        .sidebar-inner,
        .use-motion .post-block,
        .use-motion .pagination,
        .use-motion .comments,
        .use-motion .post-header,
        .use-motion .post-body,
        .use-motion .collection-header {
          opacity: initial;
        }

        .use-motion .site-title,
        .use-motion .site-subtitle {
          opacity: initial;
          top: initial;
        }

        .use-motion .logo-line-before i {
          left: initial;
        }
        .use-motion .logo-line-after i {
          right: initial;
        }
      </style>
    </noscript>
  </head>

  <body itemscope itemtype="http://schema.org/WebPage">
    <div class="container use-motion">
      <div class="headband"></div>

      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner">
          <div class="site-brand-container">
            <div class="site-nav-toggle">
              <div class="toggle" aria-label="Toggle navigation bar">
                <span class="toggle-line toggle-line-first"></span>
                <span class="toggle-line toggle-line-middle"></span>
                <span class="toggle-line toggle-line-last"></span>
              </div>
            </div>

            <div class="site-meta">
              <a href="/" class="brand" rel="start">
                <span class="logo-line-before"><i></i></span>
                <h1 class="site-title">There is no magic</h1>
                <span class="logo-line-after"><i></i></span>
              </a>
            </div>

            <div class="site-nav-right">
              <div class="toggle popup-trigger"></div>
            </div>
          </div>

          <nav class="site-nav">
            <ul id="menu" class="main-menu menu">
              <li class="menu-item menu-item-home">
                <a href="/" rel="section"
                  ><i class="fa fa-home fa-fw"></i>Home</a
                >
              </li>
              <li class="menu-item menu-item-archives">
                <a href="/archives/" rel="section"
                  ><i class="fa fa-archive fa-fw"></i>Archives</a
                >
              </li>
            </ul>
          </nav>
        </div>
      </header>

      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        <span>0%</span>
      </div>

      <main class="main">
        <div class="main-inner">
          <div class="content-wrap">
            <div class="content index posts-expand">
              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/09/12/mac开发环境配置/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/09/12/mac开发环境配置/"
                      class="post-title-link"
                      itemprop="url"
                      >mac开发环境配置</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-09-12 21:26:43"
                        itemprop="dateCreated datePublished"
                        datetime="2018-09-12T21:26:43+00:00"
                        >2018-09-12</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/tools/" itemprop="url" rel="index"
                          ><span itemprop="name">tools</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <p>
                    很多工具在<a
                      href="http://xclient.info/?t=1da9ceff71daafd2a95b38c4f24f4bf684833998"
                      target="_blank"
                      rel="noopener"
                      >xclient</a
                    >可以找到
                  </p>
                  <h3 id="一、神器homebrew安装">
                    <a
                      href="#一、神器homebrew安装"
                      class="headerlink"
                      title="一、神器homebrew安装"
                    ></a
                    >一、神器homebrew安装
                  </h3>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="二、安装下载工具-wget-curl">
                    <a
                      href="#二、安装下载工具-wget-curl"
                      class="headerlink"
                      title="二、安装下载工具 wget/curl"
                    ></a
                    >二、安装下载工具 wget/curl
                  </h3>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">brew install wget</span><br><span class="line">brew install curl</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="三、-完美终端-iTerm2-oh-my-zsh-solarized">
                    <a
                      href="#三、-完美终端-iTerm2-oh-my-zsh-solarized"
                      class="headerlink"
                      title="三、 完美终端 iTerm2 + oh-my-zsh + solarized"
                    ></a
                    >三、 完美终端 iTerm2 + oh-my-zsh + solarized
                  </h3>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"></span><br><span class="line"></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>持续补充总～～～</p>
                  <p>
                    <a
                      href="http://www.cockos.com/licecap/"
                      target="_blank"
                      rel="noopener"
                      >http://www.cockos.com/licecap/</a
                    >
                  </p>
                  <p>
                    “editor.tokenColorCustomizations”: { “comments”: “#82e0aa”,
                    // 注释 “keywords”: “#0a0”, // 关键字 “variables”: “#f00”,
                    // 变量名 “strings”: “#e2d75dbd”, // 字符串 “functions”:
                    “#5b99fcc9”, // 函数名 “numbers”: “#AE81FF” // 数字 }, //
                    选中高亮的颜色 “workbench.colorCustomizations”: {
                    “editor.selectionBackground”: “#aa0000” }
                  </p>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/09/09/Mac常用操作记录/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/09/09/Mac常用操作记录/"
                      class="post-title-link"
                      itemprop="url"
                      >Mac常用操作记录</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-09-09 16:21:12"
                        itemprop="dateCreated datePublished"
                        datetime="2018-09-09T16:21:12+00:00"
                        >2018-09-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/tools/" itemprop="url" rel="index"
                          ><span itemprop="name">tools</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <h2 id="一、iterm2快捷键">
                    <a
                      href="#一、iterm2快捷键"
                      class="headerlink"
                      title="一、iterm2快捷键"
                    ></a
                    >一、iterm2快捷键
                  </h2>
                  <ol>
                    <li>
                      <p>标签</p>
                      <figure class="highlight js">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">新建标签  : command + t</span><br><span class="line">关闭标签  : command + w</span><br><span class="line">切换标签  : command + number / command + 左右方向键</span><br><span class="line">切换全屏  : command + enter</span><br><span class="line">查找     : command + f</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>分屏</p>
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">垂直分屏 : command + d</span><br><span class="line">水平分屏 : command + shift + d</span><br><span class="line">切换屏幕 : command + option + 方向键  / command + [ / command + ]</span><br><span class="line">查看历史命令 : command + ;</span><br><span class="line">查看粘贴板命令 : command + shift + h</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>其他</p>
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">清除当前行 : ctrl + u</span><br><span class="line">到行首    : ctrl + a</span><br><span class="line">到行尾    : ctrl + e</span><br><span class="line">前进后退   : ctrl + f/b</span><br><span class="line">上一条命令 : ctrl + p</span><br><span class="line">搜索命令历史 : ctrl + r</span><br><span class="line">删除当前光标的字符 : ctrl + d</span><br><span class="line">删除光标之前的字符 : ctrl + h</span><br><span class="line">删除光标之前的单词 : ctrl + w</span><br><span class="line">删除到文本末尾 : ctrl + k</span><br><span class="line">交换光标处文本 : ctrl + t</span><br><span class="line">清屏1 : command + r</span><br><span class="line">清屏2 : ctrl + l</span><br><span class="line">清除当前行 : ctrl + u</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/09/07/nginx-本地部署及问题/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/09/07/nginx-本地部署及问题/"
                      class="post-title-link"
                      itemprop="url"
                      >nginx 本地部署及问题</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-09-07 20:15:35"
                        itemprop="dateCreated datePublished"
                        datetime="2018-09-07T20:15:35+00:00"
                        >2018-09-07</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <p>
                    admin项目的nginx配置需要更改的时候，怎么样验证配置是否ok呢？
                  </p>
                  <h3 id="一、nginx常用命令">
                    <a
                      href="#一、nginx常用命令"
                      class="headerlink"
                      title="一、nginx常用命令"
                    ></a
                    >一、nginx常用命令
                  </h3>
                  <figure class="highlight sh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">// 1. start</span><br><span class="line">nginx</span><br><span class="line">// 2. 停止nginx</span><br><span class="line">nginx -s stop</span><br><span class="line">nginx -s quit</span><br><span class="line">// 3. 重载nginx配置</span><br><span class="line">nginx -s reload</span><br><span class="line">nginx -s quit</span><br><span class="line">// 4. 指定配置的文件</span><br><span class="line">nginx -c /usr/<span class="built_in">local</span>/nginx/nginx.conf</span><br><span class="line">// 5. 检查配置文件是否正确</span><br><span class="line">nginx -t </span><br><span class="line">// 6. 帮助信息</span><br><span class="line">nginx -h</span><br><span class="line">nginx -?</span><br><span class="line">// 7. 查看nginx版本</span><br><span class="line">nginx -v</span><br><span class="line">nginx -V</span><br><span class="line">// 8 使用信号</span><br><span class="line">// 8.1 获得pid</span><br><span class="line">ps aux | grep nginx</span><br><span class="line">cat /path/to/nginx.pid</span><br><span class="line">// 8.2从容停止nginx，等所有结束后关闭服务</span><br><span class="line">ps aux | grep nginx</span><br><span class="line"><span class="built_in">kill</span> -QUIT pid</span><br><span class="line">// 8.3 nginx快速停止命令，立刻关闭进程</span><br><span class="line">ps aux | grep nginx</span><br><span class="line"><span class="built_in">kill</span> -TERM pid</span><br><span class="line">// 8.4 强制停止命令</span><br><span class="line"><span class="built_in">kill</span> -9 pid</span><br><span class="line">// 9. 查看占用端口的pid</span><br><span class="line">lsof -i :8080</span><br><span class="line">lsof -i :端口号| grep LISTEN | awk <span class="string">'&#123; print $2; &#125;'</span> | head -n 2 | grep -v PID</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="二、更改的配置文件">
                    <a
                      href="#二、更改的配置文件"
                      class="headerlink"
                      title="二、更改的配置文件"
                    ></a
                    >二、更改的配置文件
                  </h3>
                  <ol>
                    <li>
                      <p>更改前，有hub的配置</p>
                      <figure class="highlight">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># envs: ["test", "uat", "staging", "live"]</span></span><br><span class="line"><span class="comment"># cids: ["id", "th"]</span></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    server_name  c-api-dp.&#123;&#123; domain_env_flag &#125;&#125;xxxxx.&#123;&#123; domain_suffix &#125;&#125;;</span><br><span class="line">    <span class="attribute">access_log</span>   <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        proxy_pass              http://dp_api_&#123;&#123; env &#125;&#125;_&#123;&#123; cid &#125;&#125;;</span><br><span class="line">        <span class="attribute">include</span>                 django_proxy_params;</span><br><span class="line">        <span class="attribute">include</span>                 gzip_params;</span><br><span class="line">        <span class="attribute">proxy_intercept_errors</span>  <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;% if cid == 'id' %&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    server_name  dp-admin.&#123;&#123; domain_env_flag &#125;&#125;xxxxx.io;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">return</span>   <span class="number">307</span>  https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">443</span> ssl http2;</span><br><span class="line">    server_name  dp-admin.&#123;&#123; domain_env_flag &#125;&#125;xxxxx.io;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## default page ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">      <span class="attribute">try_files</span>     <span class="variable">$uri</span>      /digital-purchase/index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## end default page ##</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of hub_admin ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /hub/static/ &#123;</span><br><span class="line">        alias                   /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/hub/static/;</span><br><span class="line">        <span class="attribute">expires</span>                 <span class="number">30d</span>;</span><br><span class="line">        <span class="attribute">access_log</span>              <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">include</span>                 gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /hub &#123;</span><br><span class="line">        <span class="attribute">try_files</span>     <span class="variable">$uri</span>      /hub/index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> = /hub/index.html &#123;</span><br><span class="line">        alias                 /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/hub/index.html;</span><br><span class="line">        <span class="attribute">expires</span>               -<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">etag</span>                  <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">include</span>               gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of hub_admin ##</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of dp_admin_portal ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /digital-purchase/static/ &#123;</span><br><span class="line">        alias                   /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/windrunner/static/;</span><br><span class="line">        <span class="attribute">expires</span>                 <span class="number">30d</span>;</span><br><span class="line">        <span class="attribute">access_log</span>              <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">include</span>                 gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /digital-purchase &#123;</span><br><span class="line">        <span class="attribute">try_files</span>     <span class="variable">$uri</span>      /digital-purchase/index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> = /digital-purchase/index.html &#123;</span><br><span class="line">        alias                 /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/windrunner/index.html;</span><br><span class="line">        <span class="attribute">expires</span>               -<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">etag</span>                  <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">include</span>               gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of dp_admin_portal ##</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of dp_admin_api ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /api/ &#123;</span><br><span class="line">        proxy_pass            http://dp_admin_&#123;&#123; env &#125;&#125;_&#123;&#123; cid &#125;&#125;;</span><br><span class="line">        <span class="attribute">include</span>               django_proxy_params;</span><br><span class="line">        <span class="attribute">include</span>               gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of dp_admin ##</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endif %&#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>更改后，去掉hub的配置</p>
                      <figure class="highlight">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment"># envs: ["test", "uat", "staging", "live"]</span></span><br><span class="line"><span class="comment"># cids: ["id", "th"]</span></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    server_name  c-api-dp.&#123;&#123; domain_env_flag &#125;&#125;xxxxx.&#123;&#123; domain_suffix &#125;&#125;;</span><br><span class="line">    <span class="attribute">access_log</span>   <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        proxy_pass              http://dp_api_&#123;&#123; env &#125;&#125;_&#123;&#123; cid &#125;&#125;;</span><br><span class="line">        <span class="attribute">include</span>                 django_proxy_params;</span><br><span class="line">        <span class="attribute">include</span>                 gzip_params;</span><br><span class="line">        <span class="attribute">proxy_intercept_errors</span>  <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;% if cid == 'id' %&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    server_name  dp-admin.&#123;&#123; domain_env_flag &#125;&#125;xxxxx.io;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">return</span>   <span class="number">307</span>  https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">443</span> ssl http2;</span><br><span class="line">    server_name  dp-admin.&#123;&#123; domain_env_flag &#125;&#125;xxxxx.io;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of hub_admin ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /hub/static/ &#123;</span><br><span class="line">        alias                   /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/hub/static/;</span><br><span class="line">        <span class="attribute">expires</span>                 <span class="number">30d</span>;</span><br><span class="line">        <span class="attribute">access_log</span>              <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">include</span>                 gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /hub &#123;</span><br><span class="line">        <span class="attribute">try_files</span>     <span class="variable">$uri</span>      /hub/index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> = /hub/index.html &#123;</span><br><span class="line">        alias                 /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/hub/index.html;</span><br><span class="line">        <span class="attribute">expires</span>               -<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">etag</span>                  <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">include</span>               gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of hub_admin ##</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of dp_admin_portal ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /static/ &#123;</span><br><span class="line">        alias                   /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/windrunner/static/;</span><br><span class="line">        <span class="attribute">expires</span>                 <span class="number">30d</span>;</span><br><span class="line">        <span class="attribute">access_log</span>              <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">include</span>                 gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span>     <span class="variable">$uri</span>      /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> = /index.html &#123;</span><br><span class="line">        alias                 /data/xxxxx/&#123;&#123; env &#125;&#125;/&#123;&#123; project_name &#125;&#125;-&#123;&#123; cid &#125;&#125;/windrunner/index.html;</span><br><span class="line">        <span class="attribute">expires</span>               -<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">etag</span>                  <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">include</span>               gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of dp_admin_portal ##</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of dp_admin_api ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /api/ &#123;</span><br><span class="line">        proxy_pass            http://dp_admin_&#123;&#123; env &#125;&#125;_&#123;&#123; cid &#125;&#125;;</span><br><span class="line">        <span class="attribute">include</span>               django_proxy_params;</span><br><span class="line">        <span class="attribute">include</span>               gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of dp_admin ##</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endif %&#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                  <h3 id="三、本地验证nginx配置是否正确">
                    <a
                      href="#三、本地验证nginx配置是否正确"
                      class="headerlink"
                      title="三、本地验证nginx配置是否正确"
                    ></a
                    >三、本地验证nginx配置是否正确
                  </h3>
                  <p>
                    在项目的deploy文件下，新建 nginx.conf，内容如下<br />
                    <figure class="highlight nginx">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attribute">user</span>  root staff;</span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">  <span class="attribute">worker_connections</span>  <span class="number">3003</span>;  <span class="comment">## Default: 1024</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of admin_api ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span><span class="regexp"> ^~</span> /api/ &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>            http://localhost:3003;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of admin_api ##</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of admin ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /static&#123;</span><br><span class="line">        <span class="attribute">alias</span>                    /Users/weiqian/Desktop/xxxxx/Windrunner/build/windrunner/static/;</span><br><span class="line">        <span class="attribute">expires</span>                 <span class="number">30d</span>;</span><br><span class="line">        <span class="attribute">access_log</span>              <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span>     <span class="variable">$uri</span>       /index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">## End of admin ##</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    执行如下脚本<br />
                    <figure class="highlight sh">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">Windrunner git:(feature-ui) lsof -i :8080</span><br><span class="line">➜  Windrunner git:(feature-ui) nginx -c /Users/weiqian/Desktop/xxxxx/Windrunner/deploy/nginx.conf</span><br><span class="line">➜  Windrunner git:(feature-ui) nginx -t</span><br><span class="line">nginx: the configuration file /usr/<span class="built_in">local</span>/etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/<span class="built_in">local</span>/etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    放问网页
                    <a
                      href="http://localhost:8080"
                      target="_blank"
                      rel="noopener"
                      >http://localhost:8080</a
                    >
                    可以正常访问，也就是说我们本地的配置是ok的。
                  </p>
                  <h3 id="四、线上访问验证">
                    <a
                      href="#四、线上访问验证"
                      class="headerlink"
                      title="四、线上访问验证"
                    ></a
                    >四、线上访问验证
                  </h3>
                  <p>
                    线上访问页面还是出错，js路径不对，那么就是说打包出来的静态文件可能不对，查看jenkins的日志报错如下<br />
                    <figure class="highlight sh">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">&gt; node scripts/build.js</span><br><span class="line"></span><br><span class="line">&#123; Error: Command failed: npm run oldbuild</span><br><span class="line"></span><br><span class="line">Warning: DISABLE_ESLINT is deprecated, use ESLINT=none instead has been deprecated.</span><br><span class="line">TypeError: Invalid data, chunk must be a string or buffer, not undefined</span><br><span class="line">    at Socket.write (net.js:701:11)</span><br><span class="line">    at nodeDeprecate (/workspace/node_modules/deprecate/index.js:22:22)</span><br><span class="line">    at deprecate (/workspace/node_modules/deprecate/index.js:11:3)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/workspace/node_modules/af-webpack/lib/getConfig.js:81:26)</span><br><span class="line">    at Module._compile (module.js:635:30)</span><br><span class="line">    at Object.Module._extensions..js (module.js:646:10)</span><br><span class="line">    at Module.load (module.js:554:32)</span><br><span class="line">    at tryModuleLoad (module.js:497:12)</span><br><span class="line">    at Function.Module._load (module.js:489:3)</span><br><span class="line">    at Module.require (module.js:579:17)</span><br><span class="line">    at require (internal/module.js:11:18)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/workspace/node_modules/af-webpack/getConfig.js:1:18)</span><br><span class="line">    at Module._compile (module.js:635:30)</span><br><span class="line">    at Object.Module._extensions..js (module.js:646:10)</span><br><span class="line">    at Module.load (module.js:554:32)</span><br><span class="line">    at tryModuleLoad (module.js:497:12)</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    线上有报错，最后显示build成功了，如果是这样，我们本地的build会不会也有问题，验证了下ok<br />
                    <figure class="highlight sh">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">rm -rf node_modules</span><br><span class="line">rm -rf build</span><br><span class="line">npm i</span><br><span class="line">npm run build</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    报错如下<br />
                    <figure class="highlight sh">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">&gt; ant-design-pro@1.3.0 build /Users/weiqian/Desktop/xxxxx/Windrunner</span><br><span class="line">&gt; node scripts/build.js</span><br><span class="line"></span><br><span class="line">&#123; Error: Command failed: npm run oldbuild</span><br><span class="line"></span><br><span class="line">Warning: DISABLE_ESLINT is deprecated, use ESLINT=none instead has been deprecated.</span><br><span class="line">TypeError [ERR_INVALID_ARG_TYPE]: The <span class="string">"chunk"</span> argument must be one of <span class="built_in">type</span> string or Buffer. Received <span class="built_in">type</span> undefined</span><br><span class="line">    at validChunk (_stream_writable.js:259:10)</span><br><span class="line">    at Socket.Writable.write (_stream_writable.js:293:21)</span><br><span class="line">    at nodeDeprecate (/Users/weiqian/Desktop/xxxxx/Windrunner/node_modules/deprecate/index.js:22:22)</span><br><span class="line">    at deprecate (/Users/weiqian/Desktop/xxxxx/Windrunner/node_modules/deprecate/index.js:11:3)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/Users/weiqian/Desktop/xxxxx/Windrunner/node_modules/af-webpack/lib/getConfig.js:81:26)</span><br><span class="line">    at Module._compile (internal/modules/cjs/loader.js:678:30)</span><br><span class="line">    at Object.Module._extensions..js (internal/modules/cjs/loader.js:689:10)</span><br><span class="line">    at Module.load (internal/modules/cjs/loader.js:589:32)</span><br><span class="line">    at tryModuleLoad (internal/modules/cjs/loader.js:528:12)</span><br><span class="line">    at Function.Module._load (internal/modules/cjs/loader.js:520:3)</span><br><span class="line">    at Module.require (internal/modules/cjs/loader.js:626:17)</span><br><span class="line">    at require (internal/modules/cjs/helpers.js:20:18)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/Users/weiqian/Desktop/xxxxx/Windrunner/node_modules/af-webpack/getConfig.js:1:18)</span><br><span class="line">    at Module._compile (internal/modules/cjs/loader.js:678:30)</span><br><span class="line">    at Object.Module._extensions..js (internal/modules/cjs/loader.js:689:10)</span><br><span class="line">    at Module.load (internal/modules/cjs/loader.js:589:32)</span><br><span class="line">[graceful-process<span class="comment">#4201] exit with code:1</span></span><br><span class="line">npm ERR! code ELIFECYCLE</span><br><span class="line">npm ERR! errno 1</span><br><span class="line">npm ERR! ant-design-pro@1.3.0 oldbuild: `cross-env DISABLE_ESLINT=none roadhog build`</span><br><span class="line">npm ERR! Exit status 1</span><br><span class="line">npm ERR!</span><br><span class="line">npm ERR! Failed at the ant-design-pro@1.3.0 oldbuild script.</span><br><span class="line">npm ERR! This is probably not a problem with npm. There is likely additional logging output above.</span><br><span class="line"></span><br><span class="line">npm ERR! A complete <span class="built_in">log</span> of this run can be found <span class="keyword">in</span>:</span><br><span class="line">npm ERR!     /Users/weiqian/.npm/_logs/2018-09-07T10_31_10_452Z-debug.log</span><br><span class="line"></span><br><span class="line">    at ChildProcess.exithandler (child_process.js:282:12)</span><br><span class="line">    at ChildProcess.emit (events.js:182:13)</span><br><span class="line">    at maybeClose (internal/child_process.js:947:16)</span><br><span class="line">    at Socket.stream.socket.on (internal/child_process.js:368:11)</span><br><span class="line">    at Socket.emit (events.js:182:13)</span><br><span class="line">    at Pipe._handle.close [as _onclose] (net.js:598:12) killed: <span class="literal">false</span>, code: 1, signal: null, cmd: <span class="string">'npm run oldbuild'</span> &#125;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    npm的package.json配置<br />
                    <figure class="highlight">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">"scripts": &#123;</span><br><span class="line">    "oldbuild": "cross-env DISABLE_ESLINT=none roadhog build",</span><br><span class="line">    "build": "node scripts/build.js"</span><br><span class="line">&#125;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    更改配置如下<br />
                    <figure class="highlight">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">"scripts": &#123;</span><br><span class="line">    "oldbuild": "cross-env ESLINT=none roadhog build",</span><br><span class="line">    "build": "node scripts/build.js"</span><br><span class="line">&#125;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    编译如下成功<br />
                    <figure class="highlight sh">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">➜  Windrunner git:(feature-ui) ✗ npm run build</span><br><span class="line"></span><br><span class="line">&gt; ant-design-pro@1.3.0 build /Users/weiqian/Desktop/xxxxx/Windrunner</span><br><span class="line">&gt; node scripts/build.js</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; ant-design-pro@1.3.0 oldbuild /Users/weiqian/Desktop/xxxxx/Windrunner</span><br><span class="line">&gt; cross-env ESLINT=none roadhog build</span><br><span class="line"></span><br><span class="line">Compiled successfully.</span><br><span class="line"></span><br><span class="line">File sizes after gzip:</span><br><span class="line"></span><br><span class="line">  694.35 KB  windrunner/index.fccc1fd9.js</span><br><span class="line">  44.58 KB   windrunner/index.4c60e904.css</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Successful!</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    本地build成功了，我们放到了jenkins试了下果然编译成功了，访问线上页面是ok的。
                  </p>
                  <h3 id="五、其他案例记录">
                    <a
                      href="#五、其他案例记录"
                      class="headerlink"
                      title="五、其他案例记录"
                    ></a
                    >五、其他案例记录
                  </h3>
                  <p>
                    把域名
                    <a
                      href="https://dp-admin.test.xxxxx.io/"
                      target="_blank"
                      rel="noopener"
                      >https://dp-admin.test.xxxxx.io/</a
                    >
                    换成
                    <a
                      href="https://dp-admin.test.xxxxx.io/id"
                      target="_blank"
                      rel="noopener"
                      >https://dp-admin.test.xxxxx.io/id</a
                    ><br />
                    <figure class="highlight nginx">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attribute">user</span>  root staff;</span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">  <span class="attribute">worker_connections</span>  <span class="number">3003</span>;  <span class="comment">## Default: 1024</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of admin_api ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span><span class="regexp"> ^~</span> /api/ &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>            http://localhost:3003;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## End of admin_api ##</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## Start of admin ##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /static &#123;</span><br><span class="line">        <span class="attribute">alias</span>                    /Users/weiqian/Desktop/xxxxx/Windrunner/build/windrunner/static/;</span><br><span class="line">        <span class="attribute">expires</span>                 <span class="number">30d</span>;</span><br><span class="line">        <span class="attribute">access_log</span>              <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /id &#123;</span><br><span class="line">        <span class="attribute">try_files</span>     <span class="variable">$uri</span>       /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> = /index.html &#123;</span><br><span class="line">        <span class="attribute">alias</span>                 /Users/weiqian/Desktop/xxxxx/Windrunner/build/windrunner/index.html;</span><br><span class="line">        <span class="attribute">expires</span>               -<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">etag</span>                  <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">include</span>               gzip_params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">## End of admin ##</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>执行代码</p>
                  <figure class="highlight sh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">➜  Windrunner git:(<span class="built_in">test</span>) lsof -i :8080</span><br><span class="line">COMMAND     PID    USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</span><br><span class="line">Google    23206 weiqian  149u  IPv4 0xd18ff623edf3bb69      0t0  TCP localhost:59974-&gt;localhost:http-alt (ESTABLISHED)</span><br><span class="line">Google    23206 weiqian  202u  IPv4 0xd18ff623e145a789      0t0  TCP localhost:59936-&gt;localhost:http-alt (ESTABLISHED)</span><br><span class="line">nginx     35357 weiqian    8u  IPv4 0xd18ff623dafe64c9      0t0  TCP *:http-alt (LISTEN)</span><br><span class="line">nginx     35555 weiqian    7u  IPv4 0xd18ff623d9afbb69      0t0  TCP localhost:http-alt-&gt;localhost:59936 (ESTABLISHED)</span><br><span class="line">nginx     35555 weiqian    8u  IPv4 0xd18ff623dafe64c9      0t0  TCP *:http-alt (LISTEN)</span><br><span class="line">nginx     35555 weiqian   10u  IPv4 0xd18ff623f9b5f789      0t0  TCP localhost:http-alt-&gt;localhost:59974 (ESTABLISHED)</span><br><span class="line">➜  Windrunner git:(<span class="built_in">test</span>) <span class="built_in">kill</span> -9 23206 35357 35555</span><br><span class="line">➜  Windrunner git:(<span class="built_in">test</span>) nginx -c /Users/weiqian/Desktop/xxxxx/Windrunner/deploy/nginx.conf</span><br><span class="line">nginx: [warn] the <span class="string">"user"</span> directive makes sense only <span class="keyword">if</span> the master process runs with super-user privileges, ignored <span class="keyword">in</span> /Users/weiqian/Desktop/xxxxx/Windrunner/deploy/nginx.conf:1</span><br><span class="line">nginx: [emerg] open() <span class="string">"/Users/weiqian/Desktop/xxxxx/Windrunner/deploy/gzip_params"</span> failed (2: No such file or directory) <span class="keyword">in</span> /Users/weiqian/Desktop/xxxxx/Windrunner/deploy/nginx.conf:38</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    emerg报错gzip_params改正下nginx配置，屏蔽掉gzip_params<br />
                    <figure class="highlight nginx">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="attribute">location</span> = /index.html &#123;</span><br><span class="line">       <span class="attribute">alias</span>                 /Users/weiqian/Desktop/xxxxx/Windrunner/build/windrunner/index.html;</span><br><span class="line">       <span class="attribute">expires</span>               -<span class="number">1</span>;</span><br><span class="line">       <span class="attribute">etag</span>                  <span class="literal">on</span>;</span><br><span class="line">       <span class="comment">#include              gzip_params;</span></span><br><span class="line">   &#125;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    重新起下服务试试<br />
                    <figure class="highlight sh">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">➜  Windrunner git:(<span class="built_in">test</span>) nginx -s stop</span><br><span class="line">nginx: [alert] <span class="built_in">kill</span>(35357, 15) failed (3: No such process)</span><br><span class="line">➜  Windrunner git:(<span class="built_in">test</span>) nginx -c /Users/weiqian/Desktop/xxxxx/Windrunner/deploy/nginx.conf</span><br><span class="line">nginx: [warn] the <span class="string">"user"</span> directive makes sense only <span class="keyword">if</span> the master process runs with super-user privileges, ignored <span class="keyword">in</span> /Users/weiqian/Desktop/xxxxx/Windrunner/deploy/nginx.conf:1</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>也是ok的呢。</p>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/09/06/chrome-extension-jira-auto/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/09/06/chrome-extension-jira-auto/"
                      class="post-title-link"
                      itemprop="url"
                      >chrome-extension-jira-auto</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-09-06 16:38:11"
                        itemprop="dateCreated datePublished"
                        datetime="2018-09-06T16:38:11+00:00"
                        >2018-09-06</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/web/" itemprop="url" rel="index"
                          ><span itemprop="name">web</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <p>
                    <a
                      href="https://weiqian93.github.io/2018/08/30/electron%E5%81%9Ago%E7%88%AC%E8%99%AB%E7%9A%84gui/"
                      target="_blank"
                      rel="noopener"
                      >乞丐版的GUI</a
                    >可以抓取jira，生成本地的csv，我们希望这个东西能直接写到chrome
                    drive里面去，每个人安装一个exe，是有些大材小用了。于是开始重新规划搞一个<a
                      href="https://developer.chrome.com/extensions"
                      target="_blank"
                      rel="noopener"
                      >goole插件</a
                    >，负责抓取数据和写入drive。<a
                      href="https://github.com/weiqian93/jira-auto/tree/chrome-extension-demo"
                      target="_blank"
                      rel="noopener"
                      >源码</a
                    >
                  </p>
                  <h3 id="一、-jira的数据处理">
                    <a
                      href="#一、-jira的数据处理"
                      class="headerlink"
                      title="一、 jira的数据处理"
                    ></a
                    >一、 jira的数据处理
                  </h3>
                  <ol>
                    <li>
                      <a
                        href="https://developer.atlassian.com/cloud/jira/platform/"
                        target="_blank"
                        rel="noopener"
                        >jira官网</a
                      >有相关接口文档，我们自己的jira平台也可抓取请求包。demo测试下<br />插件的demo我们参考了一些<a
                        href="https://github.com/welearnmore/chrome-extension-book"
                        target="_blank"
                        rel="noopener"
                        >简单的教程</a
                      >和<a
                        href="http://www.ituring.com.cn/book/1421"
                        target="_blank"
                        rel="noopener"
                        >书籍资料</a
                      >
                      <figure class="highlight json">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">//manifest.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"jira-demo"</span>,</span><br><span class="line">  <span class="attr">"manifest_version"</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"jira-demo"</span>,</span><br><span class="line">  <span class="attr">"browser_action"</span>: &#123;</span><br><span class="line">    <span class="attr">"default_title"</span>: <span class="string">"jira-demo"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"content_scripts"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"matches"</span>: [<span class="string">"https://jira.hahahanow.com/*"</span>],</span><br><span class="line">      <span class="attr">"js"</span>: [<span class="string">"content_scripts.js"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"permissions"</span>: [</span><br><span class="line">    <span class="string">"cookies"</span>, </span><br><span class="line">    <span class="string">"&lt;all_urls&gt;"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"content_security_policy"</span>: <span class="string">"script-src 'self' 'unsafe-eval'; object-src 'self';"</span></span><br><span class="line">&#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// content_scripts.js</span></span><br><span class="line"><span class="keyword">var</span> searchUrl = <span class="string">'https://jira.hahahanow.com/rest/api/2/search'</span></span><br><span class="line"><span class="built_in">window</span>.fetch(searchUrl)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (response.status === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([<span class="number">400</span>, <span class="number">401</span>].indexOf(response.status) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.alert(<span class="string">'您还没登陆jira呦～去登陆'</span>)</span><br><span class="line">        <span class="built_in">window</span>.chrome.tabs.create(&#123; <span class="attr">url</span>: <span class="string">'https://jira.hahahanow.com/secure/Dashboard.jspa'</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">myJson</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(myJson)</span><br><span class="line">    &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    测试ok，根据jql语法完善下查询条件，demo测试ok，预言这部分完全可以替代go爬虫，更简单一些<br />
                    <figure class="highlight sql">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">var searchUrl = `https://jira.hahahanow.com/rest/api/2/search?jql=</span><br><span class="line">                project IN ("SPDGT", "Test")</span><br><span class="line">            AND issuetype IN ("Task", "Sub-task")</span><br><span class="line">            AND resolution IN ("Unresolved", "Done")</span><br><span class="line">            AND component IN ("FE","BE")</span><br><span class="line">            AND status IN ("To <span class="keyword">Do</span><span class="string">", "</span><span class="keyword">In</span> Progress<span class="string">", "</span>Closed<span class="string">")</span></span><br><span class="line"><span class="string">            AND assignee IN ("</span>qian.wei@xxxxx.com<span class="string">")`</span></span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    这里有一个遗留的问题，就是jira的登陆态问题，刚开始猜想是否可以直接从插件部分输入一次用户的密码和账户，测试发现同样的请求接口，cookie里面的succLogin一直返回false，并且缺少了正常登陆态cookie里面的sessionid，估计这里平台这里做了一些登陆的处理，所以我们登陆模块暂时处理为，引导用户登陆jira，然后再通过插件正常查询jira里面的数据，体验上也不会有太大问题。
                  </p>
                  <h3 id="二、-写入chrome-drive文档">
                    <a
                      href="#二、-写入chrome-drive文档"
                      class="headerlink"
                      title="二、 写入chrome drive文档"
                    ></a
                    >二、 写入chrome drive文档
                  </h3>
                  <p>
                    <a
                      href="https://developers.google.com/sheets/api/guides/values"
                      target="_blank"
                      rel="noopener"
                      >谷歌开发者文档</a
                    >里面支持多种开发方式，在快速引导里面分别体验了
                    browser、google apps
                    script、node.js及python，发现一些问题，貌似并不能和插件有些不一样，插件是纯css
                    html的静态脚本，文档里的例子显然相对复杂。
                  </p>
                  <ol>
                    <li>
                      google apps
                      script类似在谷歌文档里面保存里一段script，需要生成一些模版选择从文档页面插入，有点类似编代码时候快捷键快速生成代码。
                    </li>
                    <li>
                      node也起了一个服务，起了一个服务端资源，我们的初衷希望是一个纯插件，并不想引入服务端的概念，尽可能简单。
                    </li>
                    <li>
                      browser和python方法类似，问题同2。中间尝试是否可以用python写代码编译成一个纯插件，后来并没有开始做因为我们找到了看起来更简单的方法，即4。
                    </li>
                    <li>
                      <p>
                        ayou在翻阅chrome
                        sheets文档测试时候，发现插件可以调用，如下。
                      </p>
                      <figure class="highlight json">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">// manifest.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"sheets-demo"</span>,</span><br><span class="line">    <span class="attr">"manifest_version"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="string">"sheets-demo"</span>,</span><br><span class="line">    <span class="attr">"browser_action"</span>: &#123;</span><br><span class="line">      <span class="attr">"default_title"</span>: <span class="string">"sheets-demo"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"background"</span>: &#123;</span><br><span class="line">      <span class="attr">"page"</span>: <span class="string">"background.html"</span>,</span><br><span class="line">      <span class="attr">"persistent"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"permissions"</span>: [</span><br><span class="line">      <span class="string">"cookies"</span>,</span><br><span class="line">      <span class="string">"&lt;all_urls&gt;"</span>,</span><br><span class="line">      <span class="string">"background"</span>,</span><br><span class="line">      <span class="string">"identity"</span>,</span><br><span class="line">      <span class="string">"notifications"</span>,</span><br><span class="line">      <span class="string">"storage"</span>,</span><br><span class="line">      <span class="string">"alarms"</span>,</span><br><span class="line">      <span class="string">"https://spreadsheets.google.com/"</span>,</span><br><span class="line">      <span class="string">"https://docs.google.com/"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"oauth2"</span>: &#123;</span><br><span class="line">      <span class="attr">"client_id"</span>: <span class="string">"624254244178-9f527anv43dhfs5ghii10bdgo2jbii3e.apps.googleusercontent.com"</span>,</span><br><span class="line">      <span class="attr">"scopes"</span>: [</span><br><span class="line">        <span class="string">"https://spreadsheets.google.com/feeds"</span>,</span><br><span class="line">        <span class="string">"https://docs.google.com/feeds"</span>,</span><br><span class="line">        <span class="string">"https://www.googleapis.com/auth/plus.login"</span>,</span><br><span class="line">        <span class="string">"https://www.googleapis.com/auth/drive"</span>,</span><br><span class="line">        <span class="string">"https://www.googleapis.com/auth/spreadsheets"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">// background.html</span><br><span class="line">&lt;script type=&quot;module&quot; src=&quot;background.js&quot;&gt;&lt;/script&gt;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">//background.js</span><br><span class="line">import GSheet from &apos;./gsheet.js&apos;</span><br><span class="line">const gSheet = new GSheet()</span><br><span class="line">var  data = [[&apos;title1&apos;,&apos;title2&apos;],[11,12],[21,22]]</span><br><span class="line">generateSheet(data)</span><br><span class="line">async function generateSheet (data) &#123;</span><br><span class="line">  await gSheet.getAuthToken()</span><br><span class="line">  const res = await gSheet.createSheet(&#123;</span><br><span class="line">    &apos;properties&apos;: &#123;</span><br><span class="line">        title:&apos;test-demo&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  const &#123; spreadsheetId &#125; = res</span><br><span class="line">  await gSheet.writeToSheet(&#123;</span><br><span class="line">    spreadsheetId,</span><br><span class="line">    range: &apos;Sheet1!A1:A&apos;,</span><br><span class="line">    values: data</span><br><span class="line">  &#125;)</span><br><span class="line">  window.chrome.tabs.create(&#123; url: &apos;https://drive.google.com/drive/u/0/my-drive&apos; &#125;)</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"></span><br><span class="line"><span class="comment">//gsheet.js</span></span><br><span class="line"><span class="keyword">const</span> identity = <span class="built_in">window</span>.chrome.identity</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">GSheet</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">this</span>._token = <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _fetch (&#123;</span><br><span class="line">    url,</span><br><span class="line">    method = <span class="string">'GET'</span>,</span><br><span class="line">    body</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    url = <span class="string">'https://content-sheets.googleapis.com/v4/spreadsheets'</span> + url</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      method,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">'Authorization'</span>: <span class="string">'Bearer '</span> + <span class="keyword">this</span>._token,</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (body) &#123;</span><br><span class="line">      params.body = <span class="built_in">JSON</span>.stringify(body)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> status = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.fetch(url, params)</span><br><span class="line">        .then(<span class="function"><span class="params">rsp</span> =&gt;</span> &#123;</span><br><span class="line">          status = rsp.status</span><br><span class="line">          <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">              <span class="keyword">return</span> rsp.json()</span><br><span class="line">            <span class="keyword">case</span> <span class="number">204</span>:</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">              <span class="keyword">return</span> &#123;</span><br><span class="line">                message: <span class="string">'Internal server error.'</span></span><br><span class="line">              &#125;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">              <span class="keyword">return</span> &#123;</span><br><span class="line">                message: rsp.statusText</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">body</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (status === <span class="number">200</span>) &#123;</span><br><span class="line">            resolve(body)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getAuthToken () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      identity.getAuthToken(&#123;</span><br><span class="line">        <span class="string">'interactive'</span>: <span class="literal">true</span></span><br><span class="line">      &#125;, token =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(token,token)</span><br><span class="line">        identity.removeCachedAuthToken(&#123; token &#125;, () =&gt; &#123;</span><br><span class="line">          identity.getAuthToken(&#123;</span><br><span class="line">            <span class="string">'interactive'</span>: <span class="literal">true</span></span><br><span class="line">          &#125;, token =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>._token = token</span><br><span class="line">            resolve()</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  writeToSheet (&#123;</span><br><span class="line">    spreadsheetId,</span><br><span class="line">    range,</span><br><span class="line">    values</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`/<span class="subst">$&#123;spreadsheetId&#125;</span>/values/<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(range)&#125;</span>:append?insertDataOption=OVERWRITE&amp;valueInputOption=RAW&amp;alt=json`</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._fetch(&#123;</span><br><span class="line">      url,</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      body: &#123;</span><br><span class="line">        range,</span><br><span class="line">        values,</span><br><span class="line">        <span class="string">'majorDimension'</span>: <span class="string">'ROWS'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createSheet (params) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._fetch(&#123;</span><br><span class="line">      url: <span class="string">'/'</span>,</span><br><span class="line">      method: <span class="string">'POST'</span>,</span><br><span class="line">      body: params</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    background.js代码稍微有点多，我们简单的模块化下，引入<a
                      href="https://medium.com/front-end-hacking/es6-modules-in-chrome-extensions-an-introduction-313b3fce955b"
                      target="_blank"
                      rel="noopener"
                      >es6-modules-in-chrome-extensions</a
                    >
                  </p>
                  <h3 id="三、合并抓取数据和写入drive">
                    <a
                      href="#三、合并抓取数据和写入drive"
                      class="headerlink"
                      title="三、合并抓取数据和写入drive"
                    ></a
                    >三、合并抓取数据和写入drive
                  </h3>
                  <p>
                    <a
                      href="https://github.com/weiqian93/jira-auto/tree/chrome-extension-demo"
                      target="_blank"
                      rel="noopener"
                      >源码</a
                    >，再试用的时候发现问题，永远写入了一个人的账户，不管谁操作，猜想是client_id的问题，每个用户是否都在本地有唯一的授权id，毕竟操作google
                    doc也算是比较敏感操作。测试后发现的确是这样，manifest.json里面oauth2部分的client_id是专属的，每个安装插件的人都需要申请google权限并且在manifest.json里面设置自己的专属client_id
                  </p>
                  <figure class="highlight">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">"oauth2": &#123;</span><br><span class="line">  "client_id": "624254244178-9f527anv43dhfs5ghii10bdgo2jbii3e.apps.googleusercontent.com",</span><br><span class="line">  "scopes": [</span><br><span class="line">    "https://spreadsheets.google.com/feeds",</span><br><span class="line">    "https://docs.google.com/feeds",</span><br><span class="line">    "https://www.googleapis.com/auth/plus.login",</span><br><span class="line">    "https://www.googleapis.com/auth/drive",</span><br><span class="line">    <span class="string">"https://www.googleapis.com/auth/spreadsheets"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="四、配置google权限">
                    <a
                      href="#四、配置google权限"
                      class="headerlink"
                      title="四、配置google权限"
                    ></a
                    >四、配置google权限
                  </h3>
                  <ol>
                    <li>
                      获取插件<a
                        href="https://github.com/weiqian93/jira-auto/tree/chrome-extension-demo"
                        target="_blank"
                        rel="noopener"
                        >代码</a
                      >
                    </li>
                    <li>
                      获取插件 id<br />
                      打开<a
                        href="chrome://extensions/"
                        target="_blank"
                        rel="noopener"
                        >chrome插件</a
                      ><br />
                      点击加载已解压的拓展程序，选择jira_auto整个目录，得到插件的id
                    </li>
                    <li>
                      添加 google sheet api 库<br />打开<a
                        href="https://console.developers.google.com/"
                        target="_blank"
                        rel="noopener"
                        >Dashboard</a
                      ><br />输入 google sheet api =&gt; MANAGE
                    </li>
                    <li>
                      修改 client id<br />
                      打开<a
                        href="https://console.developers.google.com/apis/credentials"
                        target="_blank"
                        rel="noopener"
                        >credentials</a
                      ><br />
                      Credentials =&gt; Create Credentials =&gt; oAuth Client Id
                      =&gt; Chrome App<br />
                      将第一步得到的 id 复制到 Application ID 一栏，点击创建得到
                      client ID
                    </li>
                    <li>
                      将得到的 client id 拷贝下来覆盖掉项目下 manifest.json 中的
                      client_id 字段，然后刷新插件，接着就可以愉快的使用了。
                    </li>
                  </ol>
                  <h3 id="五、小结">
                    <a href="#五、小结" class="headerlink" title="五、小结"></a
                    >五、小结
                  </h3>
                  <p>
                    这里的实现比乞丐版的gui的开发代码是简单了许多，不过写chrome
                    drive的操作真的比较繁琐了，权衡下是否可以考虑在插件里做更加丰富的查询生成比较好的本地模版内容，然后复制到google
                    drive里面，更优呢？
                  </p>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/08/30/electron做go爬虫的gui/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/08/30/electron做go爬虫的gui/"
                      class="post-title-link"
                      itemprop="url"
                      >electron做go爬虫的gui</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-08-30 15:20:45"
                        itemprop="dateCreated datePublished"
                        datetime="2018-08-30T15:20:45+00:00"
                        >2018-08-30</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/web/" itemprop="url" rel="index"
                          ><span itemprop="name">web</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <p>
                    一期要做的事情很简单，用electron给一个GO爬虫脚本做一个前端的GUI，顺便学习下<a
                      href="https://electronjs.org/"
                      target="_blank"
                      rel="noopener"
                      >electron</a
                    >
                  </p>
                  <h3 id="一、运行go爬虫">
                    <a
                      href="#一、运行go爬虫"
                      class="headerlink"
                      title="一、运行go爬虫"
                    ></a
                    >一、运行go爬虫
                  </h3>
                  <p>
                    <a
                      href="https://github.com/weiqian93/jira-auto/tree/master"
                      target="_blank"
                      rel="noopener"
                      >go爬虫</a
                    >先要简单配置下<a
                      href="https://golang.org/"
                      target="_blank"
                      rel="noopener"
                      >go</a
                    >的环境<br />
                    <figure class="highlight js">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">// 1. install go</span></span><br><span class="line">brew install go -g</span><br><span class="line"><span class="comment">// 2. config gopath</span></span><br><span class="line">vim ~<span class="regexp">/.bash_profile</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ my simple config</span></span><br><span class="line"><span class="regexp">export PATH=$PATH:/</span>Users/weiqian/go/bin</span><br><span class="line"><span class="keyword">export</span> GOPATH=<span class="regexp">/Users/</span>weiqian/go</span><br><span class="line"><span class="comment">// 3. go env </span></span><br><span class="line">source ~<span class="regexp">/.bash_profile</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 4. clone code in go/</span>src </span><br><span class="line"><span class="comment">// method 1 use go get clone the code </span></span><br><span class="line">go get github.com/weiqian93/jira-auto</span><br><span class="line"><span class="comment">//method 2  </span></span><br><span class="line">cd  /Users/weiqian/go/src/jira-auto</span><br><span class="line">git clone  https:<span class="comment">//github.com/weiqian93/jira-auto.git</span></span><br><span class="line"><span class="comment">// 5. run program</span></span><br><span class="line">go run main.go</span><br><span class="line"><span class="comment">// 如果程序报错缺少库 go get 去安装就好了</span></span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <h3 id="二、eletron-部分">
                    <a
                      href="#二、eletron-部分"
                      class="headerlink"
                      title="二、eletron 部分"
                    ></a
                    >二、eletron 部分
                  </h3>
                  <ol>
                    <li>
                      electron由一个主进程和若干个渲染进程组成，主进程和渲染进程通信用ipcMain，在调试或者在功能开发的时候这个太需要了
                    </li>
                  </ol>
                  <figure class="highlight sh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">// 主进程的调试信息</span><br><span class="line">//开发时候打印的日志可以在bash里面看到。</span><br><span class="line">//打包成可执行程序之后，可以打开jira-auto.app/Contents/MacOS/jira-auto，同样可以看到</span><br><span class="line">//主进程接收由渲染进程发来的消息</span><br><span class="line">ipcMain.on(<span class="string">'exec:querybtn'</span>, <span class="keyword">function</span> (e, <span class="built_in">command</span>) &#123;</span><br><span class="line">  // 主进程向渲染进程发消息，可以在界面console看到</span><br><span class="line">  mainWindow.webContents.send(<span class="string">'exec:querybtn'</span>, <span class="string">'进入函数：exec'</span>)</span><br><span class="line">  <span class="built_in">exec</span>(path.resolve( <span class="built_in">command</span>, (error, stdout, stderr) =&gt; &#123;</span><br><span class="line">    mainWindow.webContents.send(<span class="string">'exec:querybtn'</span>, <span class="string">'结束执行'</span>, error, stdout, stderr)</span><br><span class="line">    error &amp;&amp; console.log(error)</span><br><span class="line">    stdout &amp;&amp; console.log(stdout)</span><br><span class="line">    stderr &amp;&amp; console.log(stderr)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//渲染进程，发送用户的动作到主进程</span><br><span class="line">ipcRenderer.send(<span class="string">'exec:querybtn'</span>,run_exec)</span><br><span class="line"></span><br><span class="line">// 渲染进程接受消息，可以在界面console看到</span><br><span class="line">ipcRenderer.on(<span class="string">'exec:querybtn'</span>, <span class="keyword">function</span> (e, tips, error, stdout, stderr) &#123;</span><br><span class="line">    console.log(tips);</span><br><span class="line">    error &amp;&amp; console.log(<span class="string">"error_____"</span>,error);</span><br><span class="line">    stdout &amp;&amp; console.log(<span class="string">"stdout_____"</span>,stdout);</span><br><span class="line">    stderr &amp;&amp; console.log(<span class="string">"stderr_____"</span>,stderr);</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ol start="2">
                    <li>
                      electron里面如何调用go脚本？
                      go程序提供的是cli接口，不是http接口。查询相关资料后，分别尝试了shelljs和node.js里面child_process模块的spawn方法。
                    </li>
                  </ol>
                  <figure class="highlight sh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"></span><br><span class="line">// method 1: try use shelljs ---error</span><br><span class="line">ipcMain.on(<span class="string">'shelljs:querybtn'</span>, <span class="keyword">function</span> (e, <span class="built_in">command</span>) &#123;</span><br><span class="line">  mainWindow.webContents.send(<span class="string">'shelljs:querybtn'</span>, <span class="built_in">command</span>)</span><br><span class="line">  // need execPath /usr/<span class="built_in">local</span>/bin/node ?</span><br><span class="line">  // // https://github.com/shelljs/shelljs/issues/704</span><br><span class="line">  // shell.config.execPath = shell.which(<span class="string">'node'</span>).stdout</span><br><span class="line">  // shell.config.execPath = process.env.PATH</span><br><span class="line">  console.log(<span class="string">'shelljs command---&gt; '</span>, <span class="built_in">command</span>)</span><br><span class="line">  shell.exec(<span class="built_in">command</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// method 2: try use child_process  <span class="built_in">exec</span></span><br><span class="line">ipcMain.on(<span class="string">'exec:querybtn'</span>, <span class="keyword">function</span> (e, <span class="built_in">command</span>) &#123;</span><br><span class="line">  console.log(<span class="string">'exec command---&gt; '</span>, <span class="built_in">command</span>)</span><br><span class="line">  mainWindow.webContents.send(<span class="string">'exec:querybtn'</span>, <span class="string">'进入函数：exec'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">exec</span>(path.resolve( <span class="built_in">command</span>, (error, stdout, stderr) =&gt; &#123;</span><br><span class="line">    console.log(<span class="string">'执行结束：exec'</span>)</span><br><span class="line">    mainWindow.webContents.send(<span class="string">'exec:querybtn'</span>, <span class="string">'结束执行'</span>, error, stdout, stderr)</span><br><span class="line">    error &amp;&amp; console.log(error)</span><br><span class="line">    stdout &amp;&amp; console.log(stdout)</span><br><span class="line">    stderr &amp;&amp; console.log(stderr)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// method 3: try use child_process  spawn</span><br><span class="line">ipcMain.on(<span class="string">'spawn:querybtn'</span>, <span class="keyword">function</span> (e, <span class="built_in">command</span>) &#123;</span><br><span class="line">  console.log(<span class="string">'spawn command---&gt; '</span>, <span class="built_in">command</span>)</span><br><span class="line">  const _process = spawn( <span class="built_in">command</span>[0], <span class="built_in">command</span>[1])</span><br><span class="line">  mainWindow.webContents.send(<span class="string">'spawn:querybtn'</span>, <span class="string">'进入函数：spawn'</span>)</span><br><span class="line"></span><br><span class="line">  _process.stdout.on(<span class="string">'data'</span>, <span class="keyword">function</span> (data) &#123;</span><br><span class="line">    console.log(<span class="string">'stderr执行结束：spawn'</span>)</span><br><span class="line">    mainWindow.webContents.send(<span class="string">'spawn:querybtn'</span>, <span class="string">'stderr结束执行'</span>, data)</span><br><span class="line">    console.log(data.toString())</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  _process.stderr.on(<span class="string">'data'</span>, <span class="keyword">function</span> (data) &#123;</span><br><span class="line">    console.log(<span class="string">'stderr执行结束：spawn'</span>)</span><br><span class="line">    mainWindow.webContents.send(<span class="string">'spawn:querybtn'</span>, <span class="string">'stderr结束执行'</span>, data)</span><br><span class="line">    console.log(data.toString())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ol start="3">
                    <li>
                      经过1，2小问题的解决后，开心的准备打包 electron-packager
                      <figure class="highlight">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">"scripts": &#123;</span><br><span class="line">     "start": "electron main.js", // 不要用node main.js electron里面的app等会找不到</span><br><span class="line">     "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",</span><br><span class="line">     "pack": "electron-packager --out ../outApp  --overwrite  .",</span><br><span class="line">     "standard": "standard"</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                  <p>
                    npm run pack
                    打包成功了，个性化配置有很多参数可以查询，运行程序发现一直报错并不能运行。
                  </p>
                  <ol start="4">
                    <li>
                      查看文件有没有被打包进去，右击exe=&gt;Show Package
                      Content=&gt;Contents=&gt;Resources=&gt;app=&gt;。。。。可以看见整个工程目录被打包进去了
                    </li>
                    <li>
                      <p>
                        打印日志，发现报错是一直找不到go文件，也就是electron的部分执行了，go的部分不能正常运行
                      </p>
                      <figure class="highlight go">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">_process = spawn(<span class="string">'go'</span>,[<span class="string">'run'</span>,<span class="string">'main.go'</span>,<span class="string">'--cookie="xxxx"'</span>])</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        目前的go是源码呈现的，并没有被编译成可执行文件，这样就会依赖gopath的环境，让go脱离gopath环境的以来，需要把go编译成可以执行文件，go
                        build 之后command部分变成 ./xxx
                      </p>
                      <figure class="highlight go">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">_process = spawn(<span class="string">'./main'</span>,[<span class="string">'--cookie="xxxx"'</span>])</span><br><span class="line">_process.stdout.on(<span class="string">'data'</span>,function(data)&#123;</span><br><span class="line">    console.log(data.toString())</span><br><span class="line">&#125;)</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        Show Package
                        Content显示go可执行文件已经被打包进去了，然而报错路径找不到，猜想是相对路径的问题，添加__dirname
                      </p>
                      <figure class="highlight go">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">_process = spawn(path.resolve(__dirname)+<span class="string">'/'</span>+<span class="string">'./main'</span>,[<span class="string">'--cookie="xxxx"'</span>])</span><br><span class="line">_process.stdout.on(<span class="string">'data'</span>,function(data)&#123;</span><br><span class="line">    console.log(data.toString())</span><br><span class="line">&#125;)</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        函数是可以正常执行了，又报错open data.csv permission
                        denied，先试试选择没有权限要求的文件去写文件，例如desktop
                      </p>
                      <figure class="highlight go">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"os/user"</span></span><br><span class="line">)</span><br><span class="line">myself, error := user.Current()</span><br><span class="line"><span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(error)</span><br><span class="line">&#125;</span><br><span class="line">homedir := myself.HomeDir</span><br><span class="line">desktop := homedir + <span class="string">"/Desktop/data.csv"</span></span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        在体验输入账户时候，发现macos的input部分不能粘贴等操作，解决如下
                      </p>
                      <figure class="highlight js">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="keyword">if</span> (process.platform === <span class="string">'darwin'</span>) &#123;</span><br><span class="line">  mainMenuTemplate.unshift(&#123;</span><br><span class="line">    label: <span class="string">'Edit'</span>,</span><br><span class="line">    submenu: [&#123;</span><br><span class="line">      role: <span class="string">'undo'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      role: <span class="string">'redo'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      type: <span class="string">'separator'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      role: <span class="string">'cut'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      role: <span class="string">'copy'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      role: <span class="string">'paste'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      role: <span class="string">'pasteandmatchstyle'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      role: <span class="string">'delete'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      role: <span class="string">'selectall'</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                  <h3 id="三、目录结构调整">
                    <a
                      href="#三、目录结构调整"
                      class="headerlink"
                      title="三、目录结构调整"
                    ></a
                    >三、目录结构调整
                  </h3>
                  <ol>
                    <li>spider放一起</li>
                    <li>client放一起</li>
                    <li>
                      build写好脚本后，chmod 755 xxx.sh
                      <figure class="highlight js">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment">// build_spider.sh</span></span><br><span class="line">cd ./client &amp;&amp; npm install &amp;&amp; npm run pack </span><br><span class="line"><span class="comment">// build_client.sh</span></span><br><span class="line">go build -o ./client/jira_spider ./spider &amp;&amp;  cd ./client &amp;&amp; npm install &amp;&amp; npm run pack</span><br><span class="line"><span class="comment">// build.sh </span></span><br><span class="line">./build_spider.sh &amp;&amp; ./build_client.sh</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/08/24/让vconsole支持fetch/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/08/24/让vconsole支持fetch/"
                      class="post-title-link"
                      itemprop="url"
                      >让vconsole支持fetch</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-08-24 19:36:20"
                        itemprop="dateCreated datePublished"
                        datetime="2018-08-24T19:36:20+00:00"
                        >2018-08-24</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/web/" itemprop="url" rel="index"
                          ><span itemprop="name">web</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <p>
                    我们<a
                      href="https://weiqian93.github.io/2018/08/22/sentry%E5%92%8Cvconsole%E7%9A%84%E5%BA%94%E7%94%A8/"
                      target="_blank"
                      rel="noopener"
                      >前面</a
                    >说到，react项目接入vconsole后，发现不支持fetch，于是拉取<a
                      href="https://github.com/Tencent/vConsole"
                      target="_blank"
                      rel="noopener"
                      >vconsole</a
                    >库，看看下如何改写源码使它支持fetch
                  </p>
                  <h3 id="一、搭建DevServer服务">
                    <a
                      href="#一、搭建DevServer服务"
                      class="headerlink"
                      title="一、搭建DevServer服务"
                    ></a
                    >一、搭建DevServer服务
                  </h3>
                  <p>
                    源码里面只有生成dist部分的命令，不能自己调试开发，所以我们需要搭建一个DevServer支持我们开发功能。
                  </p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"scripts"</span>: &#123;</span><br><span class="line">        <span class="string">"test"</span>: <span class="string">"mocha"</span>,</span><br><span class="line">        <span class="string">"dist"</span>: <span class="string">"webpack"</span>,</span><br><span class="line">        <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config webpack.dev.conf.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">        <span class="string">"webpack"</span>: <span class="string">"~1.12.11"</span>,</span><br><span class="line">        <span class="string">"webpack-dev-server"</span>: <span class="string">"1.14.0"</span>,</span><br><span class="line">        <span class="string">"webpack-merge"</span>: <span class="string">"^0.14.1"</span>,</span><br><span class="line">        <span class="string">"html-webpack-plugin"</span>: <span class="string">"^2.8.1"</span>,</span><br><span class="line">        <span class="string">"extract-text-webpack-plugin"</span>: <span class="string">"^1.0.1"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// webpack.dev.conf.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">var</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>)</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  entry: <span class="string">'./dev/index.js'</span>,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    noInfo: <span class="literal">true</span>,</span><br><span class="line">    overlay: <span class="literal">true</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    inline: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'#eval-source-map'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'./dev/index.html'</span>,</span><br><span class="line">      filename: <span class="string">'index.html'</span>,</span><br><span class="line">      inject: <span class="literal">true</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    // mkdir dev —index.html index.js data.json 等<br />
                    <figure class="highlight html">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">// index.html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <figure class="highlight js">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> VConsole = <span class="built_in">require</span>(<span class="string">'../src/vconsole'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vc = <span class="keyword">new</span> VConsole()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(vc)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'start vconsole'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.fetch(<span class="string">'http://localhost:8080/dev/data.json?fetch=test'</span>,&#123;<span class="attr">method</span>:<span class="string">'GET'</span>&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'get'</span>,<span class="string">'http://localhost:8080/dev/data.json?xhr=ajax'</span>)</span><br><span class="line">xhr.send()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">//data.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="number">123</span>,</span><br><span class="line">    <span class="attr">"testjson"</span>:&#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    试着运行下<br />
                    <figure class="highlight sh">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">npm i</span><br><span class="line">npm run dev</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <h3 id="二、如何拦截fetch呢">
                    <a
                      href="#二、如何拦截fetch呢"
                      class="headerlink"
                      title="二、如何拦截fetch呢"
                    ></a
                    >二、如何拦截fetch呢
                  </h3>
                  <p>
                    vconsole里面可以抓到ajax的请求包，是在network里面对XMLHttpRequest进行了重写，拦截到相关信息记录下来并在日志面板显示。依照这个思路，我们初步想的是如何重写fetch又不影响它原来的功能，于是搜索到一篇很有意思的<a
                      href="http://undefinedblog.com/how-to-intercept-fetch/"
                      target="_blank"
                      rel="noopener"
                      >博客</a
                    >，利用fetch里面的respone.clone()这个特性在中间做一些拦截记录的工作如下。<br />代码思路
                  </p>
                  <figure class="highlight js">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">mockFetch()&#123;</span><br><span class="line">    <span class="keyword">let</span> _fetch = <span class="built_in">window</span>.fetch</span><br><span class="line">    <span class="keyword">let</span> prevFetch = <span class="function">(<span class="params">url,init</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//做一些发请求前的记录工作</span></span><br><span class="line">        <span class="keyword">return</span> _fetch(url,init).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//利用response.clone()这个特性真正的做一些事情</span></span><br><span class="line">            response.clone().json().then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 具体在这里</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    具体代码<br />
                    <figure class="highlight js">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"> mockFetch() &#123;</span><br><span class="line">  <span class="keyword">let</span> _fetch = <span class="built_in">window</span>.fetch;</span><br><span class="line">  <span class="keyword">if</span>(!_fetch)&#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">  <span class="keyword">let</span> that = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> prevFetch = <span class="function">(<span class="params">url,init</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = that.getUniqueID()</span><br><span class="line">    that.reqList[id] = &#123;&#125;</span><br><span class="line">    <span class="keyword">let</span> item = that.reqList[id] || &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> query = url.split(<span class="string">'?'</span>); </span><br><span class="line">    item.id = id;</span><br><span class="line">    item.method = init.method||<span class="string">'GET'</span>;</span><br><span class="line">    item.url = query.shift(); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (query.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      item.getData = &#123;&#125;;</span><br><span class="line">      query = query.join(<span class="string">'?'</span>); <span class="comment">// =&gt; 'b=c&amp;d=?e'</span></span><br><span class="line">      query = query.split(<span class="string">'&amp;'</span>); <span class="comment">// =&gt; ['b=c', 'd=?e']</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> q <span class="keyword">of</span> query) &#123;</span><br><span class="line">        q = q.split(<span class="string">'='</span>);</span><br><span class="line">        item.getData[ q[<span class="number">0</span>] ] = q[<span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (item.method == <span class="string">'POST'</span>) &#123;</span><br><span class="line">      <span class="comment">// save POST data</span></span><br><span class="line">      <span class="keyword">if</span> (tool.isString(data)) &#123;</span><br><span class="line">        <span class="keyword">let</span> arr = data.split(<span class="string">'&amp;'</span>);</span><br><span class="line">        item.postData = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> q <span class="keyword">of</span> arr) &#123;</span><br><span class="line">          q = q.split(<span class="string">'='</span>);</span><br><span class="line">          item.postData[ q[<span class="number">0</span>] ] = q[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tool.isPlainObject(data)) &#123;</span><br><span class="line">        item.postData = data;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// UNSENT</span></span><br><span class="line">    <span class="keyword">if</span> (!item.startTime) &#123;</span><br><span class="line">      item.startTime = (+<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _fetch(url,init).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      response.clone().json().then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">        item.endTime = +<span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">        item.costTime = item.endTime - (item.startTime || item.endTime);</span><br><span class="line">        item.status = response.status;</span><br><span class="line">        item.header = &#123;&#125;</span><br><span class="line">        <span class="comment">// 拿到header里面的东西</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> pair <span class="keyword">of</span> response.headers.entries()) &#123;</span><br><span class="line">          item.header[pair[<span class="number">0</span>]] = pair[<span class="number">1</span>]</span><br><span class="line">          <span class="built_in">console</span>.log(pair[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        item.response = json;</span><br><span class="line">        item.readyState = <span class="number">4</span>;</span><br><span class="line">        item.responseType = response.type</span><br><span class="line">        that.updateRequest(id, item)</span><br><span class="line">        <span class="keyword">return</span> json</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> response</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">window</span>.fetch = prevFetch</span><br><span class="line">&#125;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <h3 id="三、生成目标js">
                    <a
                      href="#三、生成目标js"
                      class="headerlink"
                      title="三、生成目标js"
                    ></a
                    >三、生成目标js
                  </h3>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">//webpack.config.js</span><br><span class="line">var pkg = require('./package.json');</span><br><span class="line">var webpack = require('webpack');</span><br><span class="line">var ExtractTextPlugin = require('extract-text-webpack-plugin');</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  devtool: false,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vconsole : './src/vconsole.js'</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: './dist',</span><br><span class="line">    filename: '[name].min.js',</span><br><span class="line">    library: 'VConsole',</span><br><span class="line">    libraryTarget: 'umd'</span><br><span class="line">    // umdNameDefine: true</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.html$/, loader: 'html?minimize=false'</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; </span><br><span class="line">        test: /\.js$/, loader: 'babel'</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.less$/,</span><br><span class="line">        loader: 'style!css!less'</span><br><span class="line">        // loader: ExtractTextPlugin.extract('style-loader', 'css-loader!less-loader') // 将css独立打包</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.json$/, loader: 'json'</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new webpack.BannerPlugin([</span><br><span class="line">        'vConsole v' + pkg.version + ' (' + pkg.homepage + ')',</span><br><span class="line">        '',</span><br><span class="line">    ].join('\n'))</span><br><span class="line">    // 开发调试项目的时候先去掉压缩命令，确认没有问题，生产版本再加上</span><br><span class="line">    // ,new webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    //   compress: &#123;</span><br><span class="line">    //     warnings: false</span><br><span class="line">    //   &#125;</span><br><span class="line">    // &#125;)</span><br><span class="line">    // ,new ExtractTextPlugin('[name].min.css') // 将css独立打包</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line">//package.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"dist/vconsole.min.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"mocha"</span>,</span><br><span class="line">    <span class="attr">"dist"</span>: <span class="string">"webpack"</span>,</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"webpack-dev-server --config webpack.dev.conf.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="四、问题记录">
                    <a
                      href="#四、问题记录"
                      class="headerlink"
                      title="四、问题记录"
                    ></a
                    >四、问题记录
                  </h3>
                  <ol>
                    <li>
                      <p>
                        header在window.XMLHtmlRequest里获取的方法是getAllResponseHeaders()。在fetch里面需要去遍历entries
                      </p>
                      <figure class="highlight js">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> pair <span class="keyword">of</span> response.headers.entries()) &#123;</span><br><span class="line">  item.header[pair[<span class="number">0</span>]] = pair[<span class="number">1</span>]</span><br><span class="line">  <span class="built_in">console</span>.log(pair[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        response是json的时候，面板打印不出来具体数据，打印的是[object
                        object]，看了下是vconsole里面重写了JSON.stringify()，重写的作用是？
                      </p>
                    </li>
                  </ol>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/08/22/sentry和vconsole的应用/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/08/22/sentry和vconsole的应用/"
                      class="post-title-link"
                      itemprop="url"
                      >sentry和vconsole的应用
                    </a>
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-08-22 19:27:28"
                        itemprop="dateCreated datePublished"
                        datetime="2018-08-22T19:27:28+00:00"
                        >2018-08-22</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/web/" itemprop="url" rel="index"
                          ><span itemprop="name">web</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <h3 id="一、关于sentry">
                    <a
                      href="#一、关于sentry"
                      class="headerlink"
                      title="一、关于sentry"
                    ></a
                    >一、关于sentry
                  </h3>
                  <p>
                    <a
                      href="https://sentry.io/welcome/"
                      target="_blank"
                      rel="noopener"
                      >sentry</a
                    >业界最流行监控的开源框架，可以说是很多公司的监控系统的基础平台之一。<a
                      href="https://juejin.im/post/5b226cbe51882574d02f9f62"
                      target="_blank"
                      rel="noopener"
                      >sentry本地搭建</a
                    >可以自己试试哈，公司有自建的<a
                      href="https://sentry.xxxxxmobile.com/sentry/"
                      target="_blank"
                      rel="noopener"
                      >站点</a
                    >我们项目使用的react框架，接入方式查阅<a
                      href="https://docs.sentry.io/clients/javascript/integrations/react/"
                      target="_blank"
                      rel="noopener"
                      >官方文档</a
                    >即可。<br />
                    <figure class="highlight js">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="keyword">import</span> Raven <span class="keyword">from</span> <span class="string">'raven-js'</span></span><br><span class="line">Raven.config(<span class="string">'https://&lt;key&gt;@sentry.io/&lt;project&gt;'</span>).install()</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <h3 id="二、关于vconsole">
                    <a
                      href="#二、关于vconsole"
                      class="headerlink"
                      title="二、关于vconsole"
                    ></a
                    >二、关于vconsole
                  </h3>
                  <p>
                    <a
                      href="https://github.com/Tencent/vConsole"
                      target="_blank"
                      rel="noopener"
                      >vconsole</a
                    >是微信前端团队出的一款可以在移动端打印log的工具，我们用户在不同的几个国家，开发面临无法复现用户的网络环境，接入vconsole应该会帮助我们解决一部分定位问题的困难，所以接入试试效果，后期看看效果。
                  </p>
                  <h3 id="三、接入vconsole">
                    <a
                      href="#三、接入vconsole"
                      class="headerlink"
                      title="三、接入vconsole"
                    ></a
                    >三、接入vconsole
                  </h3>
                  <p>
                    方法一: 引入<a
                      href="https://github.com/diamont1001/vconsole-webpack-plugin"
                      target="_blank"
                      rel="noopener"
                      >vconsole-webpack-plugin</a
                    ><br />问题：我们想要线上带有特定参数的链接出console控制面板，这个只能区分不同的部署环境例如test、uat、live等等，无法做到在一个环境里表现不一样，webpack动态加载打包内容是在用户访问前就已经确认的。
                  </p>
                  <figure class="highlight js">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 引入插件</span></span><br><span class="line"><span class="keyword">var</span> vConsolePlugin = <span class="built_in">require</span>(<span class="string">'vconsole-webpack-plugin'</span>); </span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> vConsolePlugin(&#123;</span><br><span class="line">            filter: [],  <span class="comment">// 需要过滤的入口文件</span></span><br><span class="line">            enable: <span class="literal">true</span> <span class="comment">// 发布代码前记得改回 false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    方法二:
                    在public的index.html文件里根据url不一样动态的插入script标签，引入vconsole的js库<br />问题:
                    是可行的，只不过总觉得不是react项目的正常写法，不优雅怪怪的。
                  </p>
                  <figure class="highlight js">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// url里面带有特定参数时候，动态插入js库，js库也在public里面放着</span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"./vconsole.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>方法三: 用import在需要的时候引入vconsole的代码库</p>
                  <figure class="highlight js">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 在满足条件的时候</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./vconsole.js'</span>).then(<span class="function">(<span class="params">VConsole</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> vconsole = <span class="keyword">new</span> VConsole()</span><br><span class="line">    <span class="built_in">console</span>.log(vconsole)</span><br><span class="line">&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="四、vconsole问题">
                    <a
                      href="#四、vconsole问题"
                      class="headerlink"
                      title="四、vconsole问题"
                    ></a
                    >四、vconsole问题
                  </h3>
                  <ol>
                    <li>
                      <p>
                        代码编译不过，报错变量没找到，猜想语法检查没通过，于是各种改package.json里面的standard设置，如下
                      </p>
                      <figure class="highlight">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">"standard": &#123;</span><br><span class="line">  "parser": "babel-eslint",</span><br><span class="line">  "globals": [</span><br><span class="line">    "it",</span><br><span class="line">    <span class="string">"VConsole"</span></span><br><span class="line">  ],</span><br><span class="line">  "ignore": [</span><br><span class="line">    "**/vendor/**/*.js",</span><br><span class="line">    "**/*.test.js",</span><br><span class="line">    <span class="string">"**/src/*.js"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        依旧不对，是不是编译引入的js文件不正确，各种引入不同的js包。
                      </p>
                    </li>
                    <li>
                      依旧不对，终于在一次尝试引入了modules下面的包import(‘vconsole’)编译通过了，于是我们猜想是方向不对，应该是create-my-app在编译的过程中做了某种<a
                        href="https://stackoverflow.com/questions/50672331/failed-to-compile-create-react-app-due-to-lint-warnings-after-ejecting"
                        target="_blank"
                        rel="noopener"
                        >语法检查</a
                      >
                    </li>
                    <li>
                      <p>检查webpack.config.base.js果然发现如下代码</p>
                      <figure class="highlight">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">&#123;</span><br><span class="line">      test: /\.(js|jsx|mjs)$/,</span><br><span class="line">      enforce: 'pre',</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          options: &#123;</span><br><span class="line">            formatter: eslintFormatter,</span><br><span class="line">            eslintPath: require.resolve('eslint')</span><br><span class="line"></span><br><span class="line">          &#125;,</span><br><span class="line">          loader: require.resolve('eslint-loader')</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      include: paths.appSrc</span><br><span class="line">    &#125;,</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                      <p>改正后</p>
                      <figure class="highlight js">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment">// include: paths.appSrc,</span></span><br><span class="line">exclude: [<span class="regexp">/vconsole.js/</span>]</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li><p>语法的报错果然没有了，完美。</p></li>
                    <li>
                      打开体验的时候，发现network竟然没有抓到包，issue里面也没有提到这个问题，简单测试后，发现ajax可以抓到，我们的项目里面使用的是window.fetch竟然没有支持。
                    </li>
                    <li>额，看看怎么改下他们的代码吧。。。。</li>
                  </ol>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/08/16/fe-badjs-project/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/08/16/fe-badjs-project/"
                      class="post-title-link"
                      itemprop="url"
                      >fe-badjs-project</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-08-16 15:31:13"
                        itemprop="dateCreated datePublished"
                        datetime="2018-08-16T15:31:13+00:00"
                        >2018-08-16</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/web/" itemprop="url" rel="index"
                          ><span itemprop="name">web</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <p>
                    页面收集badjs核心是重写window.onerror事件，整理里面的错误信息，上报到接口。<br />
                    <figure class="highlight plain">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">window.onerror = function(msg, url, line, col, error) &#123;</span><br><span class="line">    var errStr, win = window;</span><br><span class="line">    function obj2str(obj) &#123;</span><br><span class="line">        var t, sw;</span><br><span class="line">        if (typeof(obj) == &apos;object&apos;) &#123;</span><br><span class="line">            if (obj === null) &#123;</span><br><span class="line">                return &apos;null&apos;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (window.JSON &amp;&amp; window.JSON.stringify) &#123;</span><br><span class="line">                return JSON.stringify(obj);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sw = isArray(obj);</span><br><span class="line">            t = [];</span><br><span class="line">            for (var i in obj) &#123;</span><br><span class="line">                t.push((sw ? &quot;&quot; : (&quot;\&quot;&quot; + i + &quot;\&quot;:&quot;)) + obj2str(obj[i]));</span><br><span class="line">            &#125;</span><br><span class="line">            t = t.join();</span><br><span class="line">            return sw ? (&quot;[&quot; + t + &quot;]&quot;) : (&quot;&#123;&quot; + t + &quot;&#125;&quot;);</span><br><span class="line">        &#125; else if (typeof(obj) == &apos;undefined&apos;) &#123;</span><br><span class="line">            return &apos;undefined&apos;;</span><br><span class="line">        &#125; else if (typeof(obj) == &apos;number&apos; || typeof(obj) == &apos;function&apos;) &#123;</span><br><span class="line">            return obj.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        return !obj ? &quot;\&quot;\&quot;&quot; : (&quot;\&quot;&quot; + obj + &quot;\&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isArray(source) &#123;</span><br><span class="line">        return &apos;[object Array]&apos; == Object.prototype.toString.call(source);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    col = col || (win.event &amp;&amp; win.event.errorCharacter) || 0;</span><br><span class="line">    if (!!error &amp;&amp; !!error.stack) &#123;</span><br><span class="line">        //如果浏览器有堆栈信息</span><br><span class="line">        //直接使用</span><br><span class="line">        msg = error.stack.toString();</span><br><span class="line">    &#125; else if (!!arguments.callee) &#123;</span><br><span class="line">        //尝试通过callee拿堆栈信息</span><br><span class="line">        var ext = [msg];</span><br><span class="line">        var f = arguments.callee.caller,</span><br><span class="line">            c = 3;</span><br><span class="line">        //这里只拿三层堆栈信息</span><br><span class="line">        while (f &amp;&amp; (--c &gt; 0)) &#123;</span><br><span class="line">            ext.push(f.toString());</span><br><span class="line">            if (f === f.caller) &#123;</span><br><span class="line">                break; //如果有环</span><br><span class="line">            &#125;</span><br><span class="line">            f = f.caller;</span><br><span class="line">        &#125;</span><br><span class="line">        ext = ext.join(&quot;,&quot;);</span><br><span class="line">        msg = ext;</span><br><span class="line">    &#125;</span><br><span class="line">    errStr = obj2str(msg) + (url ? &quot;;URL:&quot; + url : &quot;&quot;) + (line ? &quot;;Line:&quot; + line : &quot;&quot;) + (col ? &quot;;Column:&quot; + col : &quot;&quot;);</span><br><span class="line"></span><br><span class="line">    if (win._last_err_msg) &#123;</span><br><span class="line">        if (win._last_err_msg.indexOf(msg) &gt; -1) return;</span><br><span class="line">        win._last_err_msg += &quot;|&quot; + msg</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        win._last_err_msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&apos;the error log need report to cgi &apos;,errStr)</span><br><span class="line"> </span><br><span class="line">    return false;</span><br><span class="line">&#125;;</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <p>
                    搭建一个nodejs服务，记录上报的badjs错误信息(mongodb+node)
                  </p>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/08/14/hexo-deploy-error/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/08/14/hexo-deploy-error/"
                      class="post-title-link"
                      itemprop="url"
                      >hexo-deploy-error</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-08-14 15:11:59"
                        itemprop="dateCreated datePublished"
                        datetime="2018-08-14T15:11:59+00:00"
                        >2018-08-14</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/tools/" itemprop="url" rel="index"
                          ><span itemprop="name">tools</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <ol>
                    <li>部署(hexo d)错误</li>
                  </ol>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: EACCES: permission denied, unlink &apos;/Users/weiqian/Desktop/hexo/.deploy_git/archives/index.html&apos;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    刚开始以为是权限问题，git代码仓库可以正常提交，但是deploy
                    d的时候总是不对，重新生成了<a
                      href="https://weiqian93.github.io/2018/07/17/Git-ssh-key/"
                      target="_blank"
                      rel="noopener"
                      >ssh密钥</a
                    >，依旧没有用，随后清理.deploy_git及.public目录。
                  </p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">rm -rf .deploy_git </span><br><span class="line">hexo clean </span><br><span class="line">hexo d</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK啦，可以正常工作了呢</p>
                  <ol start="2">
                    <li>publickey不对</li>
                  </ol>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">INFO  Copying files from extend dirs...</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">git@github.com: Permission denied (publickey).</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: git@github.com: Permission denied (publickey).</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>
                    重新配置生成下 ssh key<br />
                    <figure class="highlight plain">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">1⃣️  cd ~/.ssh/ 使用ssh-keygen命令生成ssh密钥 ssh-keygen -t rsa  -C &quot;540518665@qq.com&quot; （enter后，第一个选择文件路径名称 example1 存储key，第二三选择密码空格就可以）</span><br><span class="line">2⃣️  ssh-add ~/.ssh/example1</span><br><span class="line">3⃣️  github上setting的SSH添加本地生成的example1 (cat ~/.ssh/example1.pub)</span><br><span class="line">4⃣️  测试 ssh git@github.com</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                  </p>
                  <ol start="3">
                    <li>
                      由于同步中未将Next主题提交，页面白屏。No layout:
                      index.html
                    </li>
                  </ol>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">// 也是为了下次同步最新的Next主题，故才有多地同步是更新Next主题方案。</span><br><span class="line">// 解决方案：直接获取/更新Next主题</span><br><span class="line">cd your-hexo-site</span><br><span class="line">git clone https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ol start="4">
                    <li>
                      又出现了<a
                        href="mailto:git@github.com"
                        target="_blank"
                        rel="noopener"
                        >git@github.com</a
                      >: Permission denied
                      (publickey)，莫非这里的publickey的会过期，过一段就要添加一下？ssh-add
                      ~/.ssh/id_rsa_hexo
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">➜  hexo git:(master) ✗ hexo d</span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">INFO  Copying files from extend dirs...</span><br><span class="line">[master 7a089f0] Site updated: 2018-09-06 15:50:05</span><br><span class="line"> 2 files changed, 74 insertions(+), 4 deletions(-)</span><br><span class="line">git@github.com: Permission denied (publickey).</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: git@github.com: Permission denied (publickey).</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line"></span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (/Users/weiqian/Desktop/xxxxx/hexo/node_modules/hexo-util/lib/spawn.js:37:17)</span><br><span class="line">    at ChildProcess.emit (events.js:182:13)</span><br><span class="line">    at maybeClose (internal/child_process.js:947:16)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (internal/child_process.js:236:5)</span><br><span class="line">➜  hexo git:(master) ✗ ssh-add ~/.ssh/id_rsa_hexo</span><br><span class="line">Identity added: /Users/weiqian/.ssh/id_rsa_hexo (/Users/weiqian/.ssh/id_rsa_hexo)</span><br><span class="line">➜  hexo git:(master) ✗ ssh git@github.com</span><br><span class="line">PTY allocation request failed on channel 0</span><br><span class="line">Hi weiqian93! You&apos;ve successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line">Connection to github.com closed.</span><br><span class="line">➜  hexo git:(master) ✗ hexo d</span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">INFO  Copying files from extend dirs...</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">To github.com:weiqian93/weiqian93.github.io.git</span><br><span class="line">   b07fcdf..7a089f0  HEAD -&gt; master</span><br><span class="line">Branch &apos;master&apos; set up to track remote branch &apos;master&apos; from &apos;git@github.com:weiqian93/weiqian93.github.io.git&apos;.</span><br><span class="line">INFO  Deploy done: git</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                  <h3 id="原理">
                    <a href="#原理" class="headerlink" title="原理"></a>原理
                  </h3>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">为什么会出现这个错呢？</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p></p>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <article
                itemscope
                itemtype="http://schema.org/Article"
                class="post-block"
                lang="default"
              >
                <link
                  itemprop="mainEntityOfPage"
                  href="http://yoursite.com/2018/08/03/construct-project/"
                />

                <span
                  hidden
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="image" content="/images/avatar.gif" />
                  <meta itemprop="name" content="weiqian" />
                  <meta itemprop="description" content="" />
                </span>

                <span
                  hidden
                  itemprop="publisher"
                  itemscope
                  itemtype="http://schema.org/Organization"
                >
                  <meta itemprop="name" content="There is no magic" />
                </span>
                <header class="post-header">
                  <h2 class="post-title" itemprop="name headline">
                    <a
                      href="/2018/08/03/construct-project/"
                      class="post-title-link"
                      itemprop="url"
                      >construct-project</a
                    >
                  </h2>

                  <div class="post-meta">
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar"></i>
                      </span>
                      <span class="post-meta-item-text">Posted on</span>

                      <time
                        title="Created: 2018-08-03 16:38:24"
                        itemprop="dateCreated datePublished"
                        datetime="2018-08-03T16:38:24+00:00"
                        >2018-08-03</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-calendar-check"></i>
                      </span>
                      <span class="post-meta-item-text">Edited on</span>
                      <time
                        title="Modified: 2021-05-09 20:26:28"
                        itemprop="dateModified"
                        datetime="2021-05-09T20:26:28+00:00"
                        >2021-05-09</time
                      >
                    </span>
                    <span class="post-meta-item">
                      <span class="post-meta-item-icon">
                        <i class="far fa-folder"></i>
                      </span>
                      <span class="post-meta-item-text">In</span>
                      <span
                        itemprop="about"
                        itemscope
                        itemtype="http://schema.org/Thing"
                      >
                        <a href="/categories/web/" itemprop="url" rel="index"
                          ><span itemprop="name">web</span></a
                        >
                      </span>
                    </span>
                  </div>
                </header>

                <div class="post-body" itemprop="articleBody">
                  <h3 id="前言">
                    <a href="#前言" class="headerlink" title="前言"></a>前言
                  </h3>
                  <p>入坑react3个月，记录下一个react项目如何从头搭建</p>
                  <h3 id="一、使用create-react-app搭建步骤">
                    <a
                      href="#一、使用create-react-app搭建步骤"
                      class="headerlink"
                      title="一、使用create-react-app搭建步骤"
                    ></a
                    >一、使用create-react-app搭建步骤
                  </h3>
                  <ol>
                    <li>
                      <p>
                        为了快速学习和方便开发，跳过项目配置和安装的繁琐步骤，我们这里选择了react官方推荐的<a
                          href="https://github.com/facebook/create-react-app"
                          target="_blank"
                          rel="noopener"
                          >create-react-app</a
                        >生成项目框架。
                      </p>
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">npx create-react-app my-app</span><br><span class="line">cd my-app</span><br><span class="line">npm start</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        默认的配置会比较简单，执行eject脚本，弹出更丰富的配置。
                      </p>
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">npm run eject</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        我们代码的规范是<a
                          href="https://standardjs.com/"
                          target="_blank"
                          rel="noopener"
                          >stardardjs</a
                        >，规范开发工作。
                      </p>
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">npm i -D standard</span><br><span class="line">//package.json里面的配置</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;standard&quot;: &quot;standard&quot; // npm run standard</span><br><span class="line">&#125;,</span><br><span class="line">// 日常全局运行 standard --fix 会取package.json的配置</span><br><span class="line">&quot;standard&quot;: &#123;</span><br><span class="line">  &quot;ignore&quot;: [],</span><br><span class="line">  &quot;cwd&quot;: &quot;&quot;,</span><br><span class="line">  &quot;fix&quot;: false,</span><br><span class="line">  &quot;globals&quot;: [</span><br><span class="line">    &quot;it&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;plugins&quot;: [],</span><br><span class="line">  &quot;envs&quot;: [],</span><br><span class="line">  &quot;parser&quot;: &quot;babel-eslint&quot;</span><br><span class="line">&#125;,</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>
                        添加<a
                          href="https://github.com/typicode/husky"
                          target="_blank"
                          rel="noopener"
                          >husky</a
                        >，在commit前进行代码校验
                      </p>
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">npm i -D husky</span><br><span class="line">&quot;husky&quot;: &#123;</span><br><span class="line">  &quot;hooks&quot;: &#123;</span><br><span class="line">    &quot;pre-commit&quot;: &quot;standard&quot;,</span><br><span class="line">    &quot;pre-push&quot;: &quot;npm test&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li><p>搭建mock server</p></li>
                    <li><p>添加jest</p></li>
                  </ol>
                  <h3 id="二、从头搭建react-webpack工程">
                    <a
                      href="#二、从头搭建react-webpack工程"
                      class="headerlink"
                      title="二、从头搭建react-webpack工程"
                    ></a
                    >二、从头搭建react-webpack工程
                  </h3>
                  <ol>
                    <li>
                      要安装的模块及功能
                      <figure class="highlight plain">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">[wepack]     |   webpack-cli webpack webpack-merge</span><br><span class="line">[react]      |   react react-dom</span><br><span class="line">[babel]      |   babel-loader @babel/preset-core @babel/preset-env @babel/preset-core</span><br><span class="line">[html]       |   html-webpack-plugin clean-webpack-plugin</span><br><span class="line">[js]         |   uglifyjs-webpack-plugin </span><br><span class="line">[css]        |   style-loader css-loader  mini-css-extract-plugin less-loader sass-loader node-sass </span><br><span class="line">[css]        |   optimize-css-assets-webpack-plugin postcss postcss_loader autoprefixer</span><br><span class="line">[devserver]  |   webpack-dev-server</span><br><span class="line">[anlyzer]    |   webpack-bundle-analyzer</span><br><span class="line">[eslint]     |   husky standardjs</span><br><span class="line">[pretty]     |   ora chalk</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ol>
                  <h3 id="三、拓展CRA的webpack配置">
                    <a
                      href="#三、拓展CRA的webpack配置"
                      class="headerlink"
                      title="三、拓展CRA的webpack配置"
                    ></a
                    >三、拓展CRA的webpack配置
                  </h3>
                  <p>
                    <a
                      href="https://juejin.im/post/5a5d5b815188257327399962"
                      target="_blank"
                      rel="noopener"
                      >相关资料</a
                    ><br />大体上有4种方法<br /><a href="">项目 eject</a
                    ><br /><a
                      href="https://auth0.com/blog/how-to-configure-create-react-app/#Test-Your-Custom-Script"
                      target="_blank"
                      rel="noopener"
                      >替换 react-scripts 包</a
                    ><br /><a href="">使用 react-app-rewired</a><br /><a href=""
                      >scripts 包 + override 组合</a
                    >
                  </p>
                </div>

                <footer class="post-footer">
                  <div class="post-eof"></div>
                </footer>
              </article>

              <nav class="pagination">
                <a class="extend prev" rel="prev" href="/page/4/"
                  ><i
                    class="fa fa-angle-left"
                    aria-label="Previous page"
                  ></i></a
                ><a class="page-number" href="/">1</a
                ><span class="space">&hellip;</span
                ><a class="page-number" href="/page/4/">4</a
                ><span class="page-number current">5</span
                ><a class="page-number" href="/page/6/">6</a
                ><a class="extend next" rel="next" href="/page/6/"
                  ><i class="fa fa-angle-right" aria-label="Next page"></i
                ></a>
              </nav>
            </div>

            <script>
              window.addEventListener('tabs:register', () => {
                let { activeClass } = CONFIG.comments;
                if (CONFIG.comments.storage) {
                  activeClass =
                    localStorage.getItem('comments_active') || activeClass;
                }
                if (activeClass) {
                  let activeTab = document.querySelector(
                    `a[href="#comment-${activeClass}"]`
                  );
                  if (activeTab) {
                    activeTab.click();
                  }
                }
              });
              if (CONFIG.comments.storage) {
                window.addEventListener('tabs:click', (event) => {
                  if (
                    !event.target.matches(
                      '.tabs-comment .tab-content .tab-pane'
                    )
                  )
                    return;
                  let commentClass = event.target.classList[1];
                  localStorage.setItem('comments_active', commentClass);
                });
              }
            </script>
          </div>

          <div class="toggle sidebar-toggle">
            <span class="toggle-line toggle-line-first"></span>
            <span class="toggle-line toggle-line-middle"></span>
            <span class="toggle-line toggle-line-last"></span>
          </div>

          <aside class="sidebar">
            <div class="sidebar-inner">
              <ul class="sidebar-nav motion-element">
                <li class="sidebar-nav-toc">Table of Contents</li>
                <li class="sidebar-nav-overview">Overview</li>
              </ul>

              <!--noindex-->
              <div class="post-toc-wrap sidebar-panel"></div>
              <!--/noindex-->

              <div class="site-overview-wrap sidebar-panel">
                <div
                  class="site-author motion-element"
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <p class="site-author-name" itemprop="name">weiqian</p>
                  <div class="site-description" itemprop="description"></div>
                </div>
                <div class="site-state-wrap motion-element">
                  <nav class="site-state">
                    <div class="site-state-item site-state-posts">
                      <a href="/archives/">
                        <span class="site-state-item-count">57</span>
                        <span class="site-state-item-name">posts</span>
                      </a>
                    </div>
                    <div class="site-state-item site-state-categories">
                      <a href="/categories/">
                        <span class="site-state-item-count">5</span>
                        <span class="site-state-item-name">categories</span></a
                      >
                    </div>
                    <div class="site-state-item site-state-tags">
                      <a href="/tags/">
                        <span class="site-state-item-count">44</span>
                        <span class="site-state-item-name">tags</span></a
                      >
                    </div>
                  </nav>
                </div>
              </div>
            </div>
          </aside>
          <div id="sidebar-dimmer"></div>
        </div>
      </main>

      <footer class="footer">
        <div class="footer-inner">
          <div class="copyright">
            &copy;
            <span itemprop="copyrightYear">2021</span>
            <span class="with-love">
              <i class="fa fa-heart"></i>
            </span>
            <span class="author" itemprop="copyrightHolder">weiqian</span>
          </div>
          <div class="powered-by">
            Powered by
            <a
              href="https://hexo.io"
              class="theme-link"
              rel="noopener"
              target="_blank"
              >Hexo</a
            >
            &
            <a
              href="https://muse.theme-next.org"
              class="theme-link"
              rel="noopener"
              target="_blank"
              >NexT.Muse</a
            >
          </div>
        </div>
      </footer>
    </div>

    <script src="/lib/anime.min.js"></script>
    <script src="/lib/velocity/velocity.min.js"></script>
    <script src="/lib/velocity/velocity.ui.min.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/motion.js"></script>
    <script src="/js/schemes/muse.js"></script>
    <script src="/js/next-boot.js"></script>
  </body>
</html>
