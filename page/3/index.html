<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="There is no magic">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="There is no magic">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="There is no magic">

<link rel="canonical" href="http://yoursite.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>

  <title>There is no magic</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">There is no magic</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/17/react读书笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/17/react读书笔记/" class="post-title-link" itemprop="url">react读书笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-17 13:03:39" itemprop="dateCreated datePublished" datetime="2019-08-17T13:03:39+00:00">2019-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、react出现背景"><a href="#一、react出现背景" class="headerlink" title="一、react出现背景"></a>一、react出现背景</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 出现的问题根源，<span class="number">2013</span>年fb的简单功能一再出现bug</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 传统的UI操作(DOM api)关注了太多的细节（一般是用jq来进行局部更新）</span><br><span class="line">react始终整理刷新页面</span><br><span class="line"></span><br><span class="line">  新概念：组件</span><br><span class="line">  <span class="number">4</span>个必须的API</span><br><span class="line">  单向数据流</span><br><span class="line">  完善的错误提示</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 应用程序状态分散在各处，难以追踪和维护，数据模型如何解决？</span><br><span class="line">  传统的mvc难以扩展和维护</span><br><span class="line">  controller -&gt; model -&gt; view</span><br><span class="line">  Flux架构(设计模式)：单向数据流         </span><br><span class="line">                               actions--------&gt; Dispatcher----callbacks</span><br><span class="line">                                  |                               |</span><br><span class="line">  webApi &lt;=&gt; webApiUitils &lt;=&gt; actionCreators                     store</span><br><span class="line">                                  |                               |        </span><br><span class="line">                              userInteractions---reactViews&lt;---changeEvents  +storeQueries</span><br><span class="line">  </span><br><span class="line"><span class="number">4.</span> Flux架构的衍生项目 redux + mbox</span><br></pre></td></tr></table></figure>
<h3 id="二、以组件方式考虑ui的构建"><a href="#二、以组件方式考虑ui的构建" class="headerlink" title="二、以组件方式考虑ui的构建"></a>二、以组件方式考虑ui的构建</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 将UI组织成组件树的形式</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 理解react组件</span><br><span class="line">  props + state -&gt; view</span><br><span class="line">  a react组件一般不提供方法，而是某种状态机</span><br><span class="line">  b react组件可以理解为纯函数</span><br><span class="line">  c 单向数据绑定</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 受控组件: 表单元素状态由外部维护</span><br><span class="line">  vs 非受控组件: 表单元素状态由DOM自身维护</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 何时创建组件： 单一职责原则</span><br><span class="line">  a 每个组件只做一件事</span><br><span class="line">  b 如果组件变得复杂，那么应该拆分成小组件</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> 数据状态管理：DRY原则（不要去做重复的状态保存）</span><br><span class="line">  a 能计算得到的状态就不要单独存储</span><br><span class="line">  b 组件尽量无状态 所需数据由props获得</span><br></pre></td></tr></table></figure>
<h3 id="三、JSX本质：不是模版语言，只是语法糖"><a href="#三、JSX本质：不是模版语言，只是语法糖" class="headerlink" title="三、JSX本质：不是模版语言，只是语法糖"></a>三、JSX本质：不是模版语言，只是语法糖</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">JSX: 在javascript代码中直接写html标记</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> JSX本质：动态创建组件的语法糖</span><br><span class="line">  eg1 jsx(是用javascript本身的特性，而不是用一种新的模版模版)</span><br><span class="line">  <span class="keyword">const</span> name =<span class="string">'john'</span></span><br><span class="line">  <span class="keyword">const</span> ele = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  eg2 javascript</span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">'john'</span></span><br><span class="line">  <span class="keyword">const</span> ele = React.createElement(<span class="string">'h1'</span>,<span class="literal">null</span>,<span class="string">'hello'</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 在jsx中使用表达式</span><br><span class="line">  a jsx本身也是表达式</span><br><span class="line">  b 在属性中使用表达式</span><br><span class="line">  c 延展属性</span><br><span class="line">  d 表达式作为子元素</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> jsx的优点</span><br><span class="line">  a 声明式创建界面的直观</span><br><span class="line">  b 代码动态创建界面的灵活</span><br><span class="line">  c 不用学习新的模版语言</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 约定： 所有的自定义组件以大写字母开头</span><br><span class="line">  a react认为小写tag是原生dom节点，如div</span><br><span class="line">  b 大写字母开头为自定义组件</span><br><span class="line">  c jsx标记是可以直接使用属性语法的 如&lt;item.Menu&gt;</span><br></pre></td></tr></table></figure>
<h3 id="四、react组件的生命周期"><a href="#四、react组件的生命周期" class="headerlink" title="四、react组件的生命周期"></a>四、react组件的生命周期</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                                |  创建时        更新时      卸载时</span><br><span class="line">render阶段                       |  constructor</span><br><span class="line">[纯净且没有副作用，可中止重启]       |  getDerivedStateFromProps</span><br><span class="line">                                 |  shouldComponentUpdate(此处可以做性能优</span><br><span class="line">-----------------------------------------------------------------                 </span><br><span class="line"> Pre-commit阶段[读取Dom]             | getSnapshotBeforeUpdate        </span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">commit阶段[使用Dom，运行副作用，安排更新] |   componentDidMount|  componentDidUnmount|componentDidUnmount</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">constructor</span> </span><br><span class="line">  a 初始化内部状态，比较少使用</span><br><span class="line">  b 唯一可以直接修改state的地方</span><br><span class="line"></span><br><span class="line">2. getDerivedStateFromProps </span><br><span class="line">  a 当state需要从Props初始化时候使用</span><br><span class="line">  b 尽量不要使用： 维护2者状态一致性会增加复杂度</span><br><span class="line">  c 每次render都会调用</span><br><span class="line">  e 典型场景： 表单控件获取默认值</span><br><span class="line"></span><br><span class="line">3. componentDidMount</span><br><span class="line">  a UI渲染完成后调用</span><br><span class="line">  b 只执行一次</span><br><span class="line">  c 典型场景：获取外部资源</span><br><span class="line"></span><br><span class="line">4. componentDidUnmount</span><br><span class="line">  a 组件移除时候调用</span><br><span class="line">  b 典型场景：释放资源</span><br><span class="line"></span><br><span class="line">5. getSnapshotBeforeUpdate</span><br><span class="line">  a 在页面render之前会调用，state已更新</span><br><span class="line">  b 典型场景： 获取render之前的dom状态</span><br><span class="line"></span><br><span class="line">6. componentDidUpdate</span><br><span class="line">  a 每次UI更新时被调用</span><br><span class="line">  b 典型场景： 页面需要根据Props的变化重新获取数据</span><br><span class="line"></span><br><span class="line">7. shouldComponentUpdate</span><br><span class="line">  a 决定Virtual Dom是否需要重绘</span><br><span class="line">  b 一般可以由PureComponent自动实现</span><br><span class="line">  c 典型场景：性能优化</span><br></pre></td></tr></table></figure>
<h3 id="五、Virtual-Dom-Diff算法"><a href="#五、Virtual-Dom-Diff算法" class="headerlink" title="五、Virtual Dom (Diff算法)"></a>五、Virtual Dom (Diff算法)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 虚拟Dom工作原理</span><br><span class="line">  标准的<span class="number">2</span>个tree diff <span class="number">0</span>n3次方</span><br><span class="line">  react Diff算法O(n)</span><br><span class="line"><span class="number">2.</span> 广度优先分层比较</span><br><span class="line"><span class="number">3.</span> 节点的跨层移动</span><br><span class="line">  删除原来的，创建新的节点(性能问题？)</span><br><span class="line"><span class="number">4.</span> 虚拟dom的<span class="number">2</span>个假设</span><br><span class="line">  A组件dom结构其实相对稳定</span><br><span class="line">  B类型相同的兄弟节点可以唯一被标识（key不仅是消除warning，而 且是提升性能）</span><br></pre></td></tr></table></figure>
<h3 id="六、高阶组件（HOC）"><a href="#六、高阶组件（HOC）" class="headerlink" title="六、高阶组件（HOC）"></a>六、高阶组件（HOC）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">组件复用的另外<span class="number">2</span>种形式：高阶组件和函数作为子组件</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 高阶组件</span><br><span class="line">  <span class="keyword">const</span> EnhancedComponent = higerOrderComponent (WrapperdComponent)</span><br><span class="line">  a 对已有组件进行封装，形成一个新组建，新组件形成包含自己的应  用逻辑和新状态传给已有组件。</span><br><span class="line">  b 高阶组件一般不会有自己的UI展现，而是为它封装的组件提供一些新的方法和功能。</span><br><span class="line">c 高阶组件接受组件作为参数，返回新的组件</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 函数作为子组件</span><br><span class="line">  &lt;MyComponent&gt;&#123;(name) =&gt; (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)&#125; &lt;<span class="regexp">/MyComponent&gt;</span></span><br><span class="line"><span class="regexp">  一个组件如何render的内容可以很大程度上由使用它的让你来决定</span></span><br></pre></td></tr></table></figure>
<h3 id="七、contextApi"><a href="#七、contextApi" class="headerlink" title="七、contextApi"></a>七、contextApi</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> contextApis使用方法</span><br><span class="line">  根节点 provide</span><br><span class="line">  使用contextApi consume</span><br><span class="line">  <span class="keyword">const</span> TestContext = React.createContext(<span class="string">'light'</span>)</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> (&lt;TestContext.Provider value='dark'&gt;   &lt;TestButton /&gt;&lt;TestContext.Provider /&gt;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  function TestButton(props) &#123;</span><br><span class="line">    return (&lt;TestContext.Consumer&gt;&#123;theme =&gt; &lt;button   &#123;...props&#125; theme=&#123;theme&#125;/&gt;&#125;&lt;/  TestContext.Consumer&gt;)</span><br><span class="line">  &#125;</span><br><span class="line">  Context.Provider一定要包住Context.Consumer</span><br><span class="line">2. 使用场景： i18n</span><br></pre></td></tr></table></figure>
<h3 id="八、使用脚手架工具"><a href="#八、使用脚手架工具" class="headerlink" title="八、使用脚手架工具"></a>八、使用脚手架工具</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 使用脚手架工具创建React应用</span><br><span class="line">  create react app </span><br><span class="line">  codesandbox.io</span><br><span class="line">  rekit</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 为什么需要脚手架工具</span><br><span class="line">  react ui开发</span><br><span class="line">  redux 状态管理</span><br><span class="line">  react/router 路由管理</span><br><span class="line">  babel 将最新的javascript特性翻译成浏览器兼容的旧  javascript</span><br><span class="line">  webpack进行打包</span><br><span class="line">  eslint进行语法检查</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 各个脚手架对比</span><br><span class="line">  create react app [babel+webpack config +testing + eslint]适合简单的新学习的，简单的application</span><br><span class="line">  rekit[redux+reactRouter+less/sass  +featureOrientedArchitecture+DedicatedIDE]更丰富的配置</span><br><span class="line">  codesandbox 在线的IDE脚手架，不需要搭建本地环境就可以直接开发，webpack打包的是运行在浏览器端的，很牛逼，平常都是在node端运行webpack</span><br></pre></td></tr></table></figure>
<h3 id="九、打包和部署"><a href="#九、打包和部署" class="headerlink" title="九、打包和部署"></a>九、打包和部署</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 为什么要打包</span><br><span class="line">  a 编译ES6语法特性，编译JSX</span><br><span class="line">  b 整合资源，例如图片，Less/Sass</span><br><span class="line">  c 优化代码的体积</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>使用webpack进行打包</span><br><span class="line">  a nodejs环境为production</span><br><span class="line">  b 禁用开发时候的专用代码，比如logger</span><br><span class="line">  c 设置应用跟路径</span><br></pre></td></tr></table></figure>
<h3 id="十、Redux（1）JS状态管理框架"><a href="#十、Redux（1）JS状态管理框架" class="headerlink" title="十、Redux（1）JS状态管理框架"></a>十、Redux（1）JS状态管理框架</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 为什么需要redux</span><br><span class="line">  react组件工作：把state转换成DOM结构（组件内部发生）</span><br><span class="line">  redux工作：store-&gt;DOM(把状态放到组件外部管理)</span><br><span class="line">  redux store里面的结构也是一个类似Tree的结构</span><br><span class="line">  [链接](https:<span class="comment">//css-tricks.com/learning-react-redux/)</span></span><br><span class="line">  解决组件通信: 组件之前的通信通过store来完成</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> Redux特性</span><br><span class="line">  a single source <span class="keyword">of</span> truth</span><br><span class="line">    view</span><br><span class="line">    view --&gt; store</span><br><span class="line">    view</span><br><span class="line">  b 可预测性 state + action = <span class="keyword">new</span> sate</span><br><span class="line">  c 纯函数[输出结果完全取决于输入参数，不依赖任何外部]更新store</span><br></pre></td></tr></table></figure>
<h3 id="十一、Redux（2）深入理解store-action"><a href="#十一、Redux（2）深入理解store-action" class="headerlink" title="十一、Redux（2）深入理解store action"></a>十一、Redux（2）深入理解store action</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 理解Store</span><br><span class="line">  <span class="keyword">const</span> store = createStore(reducer)</span><br><span class="line">  a getState</span><br><span class="line">  b dispatch(action)</span><br><span class="line">  c subscribe(listener)</span><br><span class="line">  |---------------------| </span><br><span class="line">  |  dispatcher action  | </span><br><span class="line">  |     |               | </span><br><span class="line">  |   reducer  处理action| </span><br><span class="line">  |     |      改变store | </span><br><span class="line">  |   state              | </span><br><span class="line">  |----------------------| </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 理解action(描述行为的数据结构)</span><br><span class="line">  &#123;</span><br><span class="line">      type: ADD_TODO</span><br><span class="line">      text: <span class="string">'build my app'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 理解reducer</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">todoApp</span>(<span class="params">state = intialState, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> ADD_TODO:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class="line">          todos: [</span><br><span class="line">            ...state.todos,</span><br><span class="line">            &#123;</span><br><span class="line">              text: action.text,</span><br><span class="line">              completed: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">default</span>: </span><br><span class="line">        <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">(state,action) =&gt; <span class="keyword">new</span> state</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 理解combineReducers </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dispatch(actionCreator.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(actionCreators)</span><br><span class="line">  <span class="keyword">const</span> boundActionCreators = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++ &gt;) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="keyword">const</span> actionCreator = actionCreators[key]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator === <span class="string">'function'</span>) &#123;</span><br><span class="line">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> boundActionCreators</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> pureRedux Demos</span><br><span class="line"><span class="comment">// pureRedux</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, boundActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//Store initial state</span></span><br><span class="line">  <span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line">  <span class="comment">// reducer</span></span><br><span class="line">  <span class="keyword">const</span> counter = <span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">      <span class="keyword">case</span>: <span class="string">'PLUS_ONE'</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count + <span class="number">1</span> &#125;</span><br><span class="line">      <span class="keyword">case</span>: <span class="string">'MINUS_ONE'</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count - <span class="number">1</span> &#125;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> todos = <span class="function"><span class="params">state</span> =&gt;</span> state</span><br><span class="line">  <span class="keyword">const</span> re</span><br><span class="line">  <span class="comment">//create store</span></span><br><span class="line">  <span class="comment">//const store = createStore(counter)</span></span><br><span class="line">  <span class="keyword">const</span> store = creatorStore(combineReducers(&#123;</span><br><span class="line">      todos,</span><br><span class="line">      counter</span><br><span class="line">  &#125;))</span><br><span class="line">  <span class="comment">//action creator</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">plusOne</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'PLUS_ONE'</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">minusOne</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'PLUS_ONE'</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(store.getState()))</span><br><span class="line">  store.dispatch(plusOne)</span><br><span class="line">  <span class="comment">//store.dispatch(minusOne)</span></span><br><span class="line">  minusOne = boundActionCreators(minusOne)</span><br><span class="line">  minusOne()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十二、Redux（3）在react中使用redux"><a href="#十二、Redux（3）在react中使用redux" class="headerlink" title="十二、Redux（3）在react中使用redux"></a>十二、Redux（3）在react中使用redux</h3><ol>
<li><p>component =&gt;connect=&gt; store</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SidePanel</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        nextGen: state.nextGen,</span><br><span class="line">        router: state.router</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        actions: bindActionCreators(&#123;...actions&#125;,dispatch)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(SildePannel)</span><br></pre></td></tr></table></figure>
</li>
<li><p>connect 工作原理： 高阶组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    connect(Mycomp) &lt;---store&lt;---</span><br><span class="line">Mycomp &lt;--传入props             reducers</span><br><span class="line">                    &lt;---actions---&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="十三、Redux（4）理解异步Action-Redux中间件"><a href="#十三、Redux（4）理解异步Action-Redux中间件" class="headerlink" title="十三、Redux（4）理解异步Action Redux中间件"></a>十三、Redux（4）理解异步Action Redux中间件</h3><p><a href="/images/异步redux.png">异步ReduxAction</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> redux异步请求：到Middleware进行预处理，再形成最后的action然后dispatch。异步ReduxAction比同步ReduxAction多了一个Middleware，Middleware帮助实现异步action流程</span><br><span class="line">异步action并不是redux的概念，而是一个action的设计模式，是几个同步action的组合</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> redux中间件Middleware</span><br><span class="line">a 截获action(ajax由redux-thunk截获，是否截获是判断action是否是一个promise)</span><br><span class="line">b 发出action</span><br><span class="line">典型例子：logger</span><br><span class="line">谷歌插件redux</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>demo</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  FETCH_LIST_BEGIN,</span><br><span class="line">  FETCH_LIST_SUC,</span><br><span class="line">  FETCH_LIST_FAIL</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchList</span>(<span class="params">args = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: FETCH_LIST_BEGIN</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> doRequest = axios.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">      doRequest.then(</span><br><span class="line">        res =&gt; &#123;</span><br><span class="line">          dispatch(&#123;</span><br><span class="line">            type: FETCH_LIST_SUC,</span><br><span class="line">            data: res.data</span><br><span class="line">          &#125;)</span><br><span class="line">          resolve(res)</span><br><span class="line">        &#125;,</span><br><span class="line">        err =&gt; &#123;</span><br><span class="line">          dispatch(&#123;</span><br><span class="line">            type: FETCH_LIST_FAIL,</span><br><span class="line">            data: &#123; <span class="attr">error</span>: err &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          reject(err)</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> FETCH_LIST_BEGIN:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        fetchListPending: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> FETCH_LIST_SUC:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        fetchListPending: <span class="literal">false</span>,</span><br><span class="line">        list: action.data</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> FETCH_LIST_FAIL:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        fetchListPending: <span class="literal">false</span>,</span><br><span class="line">        list: action.data.error</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="十四、Redux（5）如何组织actions和reducer"><a href="#十四、Redux（5）如何组织actions和reducer" class="headerlink" title="十四、Redux（5）如何组织actions和reducer"></a>十四、Redux（5）如何组织actions和reducer</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 标准形式的redux action的问题</span><br><span class="line">  a 所有action放一个文件，会无限拓展</span><br><span class="line">  b action reducer 分开，实现业务逻辑需要来回切换</span><br><span class="line">  c 系统中有哪些action不够直观</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 新的方式： 单个action和reducer放在同一个文件</span><br><span class="line">  a 易于开发： 不用再action和reducer切换</span><br><span class="line">  b 易于维护： 每个action文件都很小，容易理解 </span><br><span class="line">  c 易于测试： 每个业务逻辑只需要对应一个测试文件</span><br><span class="line">  d 易于理解： 文件名就是action名字，文件列表就是action列表</span><br></pre></td></tr></table></figure>
<h3 id="十五、Redux（6）不可变数据（immutable-data）"><a href="#十五、Redux（6）不可变数据（immutable-data）" class="headerlink" title="十五、Redux（6）不可变数据（immutable data）"></a>十五、Redux（6）不可变数据（immutable data）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 为何需要不可变数据</span><br><span class="line">  a 性能优化（只需要比较引用）</span><br><span class="line">  b 易于调试和跟踪（看前一个数据，后一个数据状态）</span><br><span class="line">  c 易于推测</span><br><span class="line"><span class="number">2.</span> 如何操作不可变数据</span><br><span class="line">  a 原生写法 &#123;...&#125;, <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;<span class="attr">xxx</span>: <span class="number">1</span>&#125;)</span><br><span class="line">  b immutability-helper</span><br><span class="line">    <span class="keyword">import</span> update <span class="keyword">from</span> <span class="string">'imutablility-helper'</span></span><br><span class="line">    <span class="keyword">const</span> state = &#123; <span class="attr">filter</span>: <span class="string">'completed'</span>, <span class="attr">todos</span>: [<span class="string">'learn react'</span>]&#125;</span><br><span class="line">    <span class="keyword">const</span> newState = update(state, &#123;<span class="attr">todo</span>: &#123;<span class="attr">$push</span>: [<span class="string">'Learn redux'</span>]&#125;&#125;)</span><br><span class="line">  c immer (用很原生的写法简单操作，性能稍微差一点)</span><br><span class="line">    <span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">'immer'</span></span><br><span class="line">    <span class="keyword">const</span> state = &#123; <span class="attr">filter</span>: <span class="string">'completed'</span>, <span class="attr">todos</span>: [<span class="string">'learn react'</span>]&#125;</span><br><span class="line">    <span class="keyword">const</span> newState = product(state, draft =&gt; &#123;</span><br><span class="line">        draft.todos.push(<span class="string">'learn redux'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    product接受旧状态，新生成新数据的一个代理draft，对draft的任何造作都会再immer内部以不可变数据操作</span><br><span class="line">    当节点层数很多很多，会为每个属性建立一个代理，操作会有一定的性能问题。</span><br></pre></td></tr></table></figure>
<h3 id="十六、React-Router-1-路由不只是页面切换，更是代码的组织方式"><a href="#十六、React-Router-1-路由不只是页面切换，更是代码的组织方式" class="headerlink" title="十六、React Router(1): 路由不只是页面切换，更是代码的组织方式"></a>十六、React Router(1): 路由不只是页面切换，更是代码的组织方式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 为什么需要路由</span><br><span class="line">  a 单页面应用需要进行页面切换</span><br><span class="line">  b 通过url可以定位到页面</span><br><span class="line">  c 更有语义的组织资源</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 路由实现的基础架构</span><br><span class="line">  路由定义                Router      页面布局</span><br><span class="line">  /topic/:id -&gt; Topic</span><br><span class="line">  /topics -&gt; <span class="function"><span class="params">List</span>        =&gt;</span>          组件容器</span><br><span class="line">  /abount -&gt; About</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line">  <span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Index</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">About</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Users</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">AppRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;nav&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">              &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">              &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/about/"</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">              &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/users/"</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">            &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>nav&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/"</span> exact component=&#123;Index&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/about/"</span> component=&#123;About&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/users/"</span> component=&#123;Users&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Router&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> AppRouter;</span><br><span class="line">  </span><br><span class="line"><span class="number">2.</span> react router的特性（和后端对比，通过路由配置表）</span><br><span class="line">  a 声明式路由定义</span><br><span class="line">    [路由其实是像使用react标记一样的，作为一个tag定义的，所以使用非常灵活，想放到哪里]</span><br><span class="line">  b 动态路由</span><br><span class="line">    路由是在页面render的时候实时解析的</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 三种路由实现方式</span><br><span class="line">  a url路径(BrowserRouter)</span><br><span class="line">  b hash路由(HashRouter)（兼容低版本浏览器）</span><br><span class="line">  c 内存路由（MemeryRouter）路由并不会反应到url上，一般是服务器渲染</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 基于路由配置进行资源组织</span><br><span class="line">  a 实现业务逻辑的松耦合</span><br><span class="line">  b 易于扩展，重构和维护</span><br><span class="line">  c 路由层面实现lazyload</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>React Router Api<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123;Link， NavLink &#125; from &apos;react-router-dom&apos;</span><br><span class="line">&lt;Link /&gt; =&gt; 类似&lt;a&gt;，不会触发浏览器刷新</span><br><span class="line">NavLink =&gt; 类似Link但是会添加当前选中的状态，&lt;NavLink to=&apos;/fag&apos; xxxClassName=&#123;xxxClass&#125;&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Prompt, Route, Redirect, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router'</span></span><br><span class="line">&lt;Prompt when=&#123;formIsOk&#125; message=<span class="string">'are you sure you want to leave'</span>&gt; 满足条件时候提醒用户是否离开当前页面</span><br><span class="line">&lt;Redirect /&gt;重定向单前页面</span><br><span class="line">&lt;Route exact path=<span class="string">'/'</span> render=&#123;() =&gt; (</span><br><span class="line">    loggedIn ? (<span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">'/dashboard'</span>&gt;</span>): (<span class="tag">&lt;<span class="name">PublicHomePage</span> /&gt;</span>)</span></span><br><span class="line"><span class="xml">)&#125;&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Route</span> /&gt;</span>路径匹配时候显示对应组件</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Switch</span> /&gt;</span>只显示第一个匹配的路由</span></span><br></pre></td></tr></table></figure>
<h3 id="十七、React-Router-2-参数定义，嵌套路由的使用场景"><a href="#十七、React-Router-2-参数定义，嵌套路由的使用场景" class="headerlink" title="十七、React Router(2): 参数定义，嵌套路由的使用场景"></a>十七、React Router(2): 参数定义，嵌套路由的使用场景</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 通过url传递参数</span><br><span class="line">  a 如何通过url传递参数 &lt;Route path=<span class="string">'/topic/:id'</span> /&gt;</span><br><span class="line">  b 如何获取参数 <span class="keyword">this</span>.props.match.params</span><br><span class="line">  c https:<span class="comment">//github.com/pillarjs/path-to-regexp</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 何时需要url参数，页面状态尽量通过Url参数定义</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 嵌套路由</span><br><span class="line">  a 每个react组件都可以是路由容器</span><br><span class="line">  b React Router声明式语法可以方便的定义嵌套路由</span><br><span class="line">  react route标记是可以多个匹配的，因为他只是react的一个组件</span><br></pre></td></tr></table></figure>
<h3 id="十八、-UI组件库对比介绍-ant-Design-Material-UI-Semantic-UI"><a href="#十八、-UI组件库对比介绍-ant-Design-Material-UI-Semantic-UI" class="headerlink" title="十八、 UI组件库对比介绍 ant.Design, Material UI, Semantic UI"></a>十八、 UI组件库对比介绍 ant.Design, Material UI, Semantic UI</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 当前比较流行的</span><br><span class="line"> ant.Design =&gt; 企业级应用，数据密集合理，复杂场景</span><br><span class="line"> Material UI =&gt; 更花哨消费者</span><br><span class="line"> Semantic UI =&gt; jq时代，ui作为一种languageOfWeb</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 考虑选择UI库的因素</span><br><span class="line">  a  组件库是否齐全 antDesign &gt; Material &gt; Semantic</span><br><span class="line">  b  样式风格是否符合业务需求 </span><br><span class="line">  c  api设计是否更加便捷灵活 antDesign &gt; Material &gt; Semantic</span><br><span class="line">     例如table （antd 数据驱动型）&gt;（Material|和写html一样）</span><br><span class="line">     antd table功能非常强大</span><br><span class="line">  d 技术支持是否完善（文档issue等）</span><br><span class="line">  c 开发是否完善（稳定团队）</span><br></pre></td></tr></table></figure>
<h3 id="十九、-使用next-js创建react的同构应用"><a href="#十九、-使用next-js创建react的同构应用" class="headerlink" title="十九、 使用next.js创建react的同构应用"></a>十九、 使用next.js创建react的同构应用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 什么是同构应用</span><br><span class="line">  浏览器                 服务器</span><br><span class="line">      --&gt;初次发送请求--&gt;   </span><br><span class="line">                       服务器端逻辑</span><br><span class="line">      &lt;--返回渲染后的app页面&lt;--</span><br><span class="line">  客户端操作</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 创建页面</span><br><span class="line">  a 页面就是pages目录下的一个组件</span><br><span class="line">  b <span class="keyword">static</span>目录映射静态文件</span><br><span class="line">  c page具有特殊的静态方法getInitialProps</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 页面中使用其他的react组件</span><br><span class="line">  a 页面也是标准的node模块，可使用其它React组件</span><br><span class="line">  b 页面会针对性打包，仅包含其引入的组件</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 使用Link实现同构的路由</span><br><span class="line">  a 使用next/link定义链接</span><br><span class="line">  b 点击链接时页面不会刷新</span><br><span class="line">  c 使用prefetch预加载目标资源</span><br><span class="line">  d 使用replace属性替换Url</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> 动态加载页面</span><br><span class="line">  <span class="keyword">import</span> dynamic <span class="keyword">from</span> <span class="string">'next/dynamic'</span></span><br><span class="line">  <span class="keyword">const</span> DynamicHello = dynamic(<span class="keyword">import</span>(<span class="string">'./xxx'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="二十、-使用Jest-Enzyme等工具进行单元测试"><a href="#二十、-使用Jest-Enzyme等工具进行单元测试" class="headerlink" title="二十、 使用Jest, Enzyme等工具进行单元测试"></a>二十、 使用Jest, Enzyme等工具进行单元测试</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> React让单元测试变得容易</span><br><span class="line">  a React应用很少需要访问浏览器API</span><br><span class="line">  b 虚拟DOM可以在NodeJS环境运行和测试</span><br><span class="line">  c Redux隔离了状态管理，纯数据层单元测试</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 单元测试涉及的工具</span><br><span class="line">  a Jest: FB开源的JS单元测试框架</span><br><span class="line">  b JS DOM: 浏览器环境的NodeJS模拟</span><br><span class="line">  c Enzyme: React组件渲染和测试（airbnb）</span><br><span class="line">  d nock: 模拟Http请求</span><br><span class="line">  e sinon: 函数的模拟和调用跟踪</span><br><span class="line">  f istanbul: 单元测试覆盖率</span><br></pre></td></tr></table></figure>
<h3 id="二十一、-常用的开发调试工具-Eslint、Prettier、React-DevTool、Redux-DevTool"><a href="#二十一、-常用的开发调试工具-Eslint、Prettier、React-DevTool、Redux-DevTool" class="headerlink" title="二十一、 常用的开发调试工具 Eslint、Prettier、React DevTool、Redux DevTool"></a>二十一、 常用的开发调试工具 Eslint、Prettier、React DevTool、Redux DevTool</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> Eslint 语法风格检查</span><br><span class="line">  a 使用.eslintrc进行规则配置</span><br><span class="line">  b 使用airbnb的javascript代码风格</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="string">"extends"</span>: <span class="string">'./node_modules/eslint-config-airbnb/.eslintrc'</span>,</span><br><span class="line">       <span class="string">"parser"</span>: <span class="string">"babel-eslint"</span>,</span><br><span class="line">       <span class="string">"globals"</span>: &#123;</span><br><span class="line">           <span class="string">"document"</span>: <span class="literal">true</span>,</span><br><span class="line">           <span class="string">"window"</span>: <span class="literal">true</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"settings"</span>: &#123;</span><br><span class="line">           <span class="string">"import/resolver"</span>: &#123;</span><br><span class="line">               <span class="string">"babel-modules"</span>: &#123;&#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       rules: &#123;</span><br><span class="line">          <span class="string">"prettier/prettier"</span>: <span class="string">"error"</span>,</span><br><span class="line">          <span class="string">"strict"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"function-paren-newline"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"guard-for-in"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"max-len"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"no-nested-ternary"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"no_underscore_dangle"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"no-console"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"no-shadow"</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">"class-methods-use-this"</span>: <span class="number">0</span>,</span><br><span class="line">       &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> Prettier </span><br><span class="line">  a 代码格式化的神器</span><br><span class="line">  b 保证大家写出风格一致的代码</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> React Dev Tools</span><br><span class="line">  a select</span><br><span class="line">  b highlight updates</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> Redux DevTool</span><br><span class="line">  a 观察store的完整状态</span><br><span class="line">  b diff引起的变化</span><br><span class="line">  c timeMachine jump(可以停止到某个状态，不用<span class="keyword">debugger</span>)</span><br><span class="line">  d test 测试某个action是否正确，拷贝到单元测试文件中，就可以形成一个完整的testcase</span><br></pre></td></tr></table></figure>
<h3 id="二十二、-前端理想架构"><a href="#二十二、-前端理想架构" class="headerlink" title="二十二、 前端理想架构"></a>二十二、 前端理想架构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>理想架构</span><br><span class="line">  易于开发--&gt; 开发工具是否完善、生态圈是否繁荣、社区是否活跃</span><br><span class="line">  易于维护--&gt; 增加新功能是否容易、新功能是否会显著的增加系统的复杂度</span><br><span class="line">  易于扩展--&gt; 代码是否容易理解、文档是否健全</span><br><span class="line">  易于测试--&gt; 功能的分层是否清晰、副作用（外部变量）少、尽量使用纯函数</span><br><span class="line">  易于构建--&gt; 使用通用技术和架构、构建工具的选择（webpack rollup）</span><br></pre></td></tr></table></figure>
<h3 id="二十三、-拆分复杂度rekit"><a href="#二十三、-拆分复杂度rekit" class="headerlink" title="二十三、 拆分复杂度rekit"></a>二十三、 拆分复杂度rekit</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 按照领域模型（feature）组织代码，降低耦合度</span><br><span class="line">   eg 文件夹结构</span><br><span class="line">   a 按照feature组织源文件</span><br><span class="line">   b 组件和样式文件</span><br><span class="line">   c Redex 单独文件夹</span><br><span class="line">   d 单元测试保持同样的目录结构在单独文佳佳</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 在每个feature中单独定义自己的路由</span><br><span class="line">   根路由分散到每个子路由</span><br><span class="line">   使用json定义顶级路由</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> rekit如何工作</span><br><span class="line">   定义了基于feature的可扩展的文件夹结构</span><br><span class="line">   基于最佳实践生成代码和管理项目元素</span><br><span class="line">   提供工具和IDE确保代码和文件夹结构遵循最佳结构</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 通过代码生成保持一致性</span><br><span class="line">   文件夹结构、文件名、变量名、代码逻辑一致性</span><br></pre></td></tr></table></figure>
<h3 id="二十四、使用react-router来管理登陆"><a href="#二十四、使用react-router来管理登陆" class="headerlink" title="二十四、使用react router来管理登陆"></a>二十四、使用react router来管理登陆</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 使用react router管理路由授权</span><br><span class="line">   实现基础是react router的动态路由机制</span><br><span class="line">   区分受保护路由和公开路由</span><br><span class="line">   访问未授权路由时重定向到登陆页面</span><br><span class="line">  （方法： 动态修改路由配置）</span><br></pre></td></tr></table></figure>
<h3 id="二十五、实现表单、列表页面、react-router实现分步操作"><a href="#二十五、实现表单、列表页面、react-router实现分步操作" class="headerlink" title="二十五、实现表单、列表页面、react-router实现分步操作"></a>二十五、实现表单、列表页面、react-router实现分步操作</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> form = validator + jsonschema</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 设计list </span><br><span class="line">  a redux的store模型设计</span><br><span class="line">  &#123;</span><br><span class="line">     listItems: array</span><br><span class="line">     keyword: string</span><br><span class="line">     page:numner </span><br><span class="line">     byId: <span class="built_in">Object</span></span><br><span class="line">     fetchListPending:bool</span><br><span class="line">     fetchListError: object</span><br><span class="line">     listNeedReload: bool</span><br><span class="line">  &#125;</span><br><span class="line">  b url的设计以及和store同步</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 向导页面考虑的技术要点</span><br><span class="line">  a 使用url进行导航的好处</span><br><span class="line">  b 表单内容存放的位置</span><br><span class="line">  c 页面状态如何切换</span><br></pre></td></tr></table></figure>
<h3 id="二十六、常见的布局方式实现、ReactPortals"><a href="#二十六、常见的布局方式实现、ReactPortals" class="headerlink" title="二十六、常见的布局方式实现、ReactPortals"></a>二十六、常见的布局方式实现、ReactPortals</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1. 常见页面布局的实现</span><br><span class="line">  a 从0开始用css实现</span><br><span class="line">  b 使用css Grid系统[boostrap等]</span><br><span class="line">  c 使用组件库，例如antd</span><br><span class="line"></span><br><span class="line">2. demo</span><br><span class="line">  上中下布局</span><br><span class="line">  左右布局</span><br><span class="line">3. dialog（ant Model）</span><br><span class="line">  react 16.3引入的Api</span><br><span class="line">  可以将虚拟DOM映射到任何真实的DOM节点</span><br><span class="line">  解决了漂浮层的问题，比如：Dialog、ToolTip</span><br></pre></td></tr></table></figure>
<h3 id="二十七、-集成第三方js库，例如d3-js"><a href="#二十七、-集成第三方js库，例如d3-js" class="headerlink" title="二十七、 集成第三方js库，例如d3.js"></a>二十七、 集成第三方js库，例如d3.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 集成第三方JS库的技术要点</span><br><span class="line">  a 使用ref获取原生DOM节点引用</span><br><span class="line">  b 手动将组件状态更新到DOM节点</span><br><span class="line">  c 组件销毁时移除原生节点DOM事件</span><br><span class="line">  核心：这些js库都是在操作真实的dom节点</span><br><span class="line"><span class="number">2.</span> demo</span><br></pre></td></tr></table></figure>
<h3 id="二十八、-基于路由实现菜单导航"><a href="#二十八、-基于路由实现菜单导航" class="headerlink" title="二十八、 基于路由实现菜单导航"></a>二十八、 基于路由实现菜单导航</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 技术要点</span><br><span class="line">  a 菜单导航只是改变url状态</span><br><span class="line">  b 根据当前url显示菜单的当前状态</span><br><span class="line"><span class="number">2.</span> demo NavLink</span><br></pre></td></tr></table></figure>
<h3 id="二十九、-react中拖放的实现"><a href="#二十九、-react中拖放的实现" class="headerlink" title="二十九、 react中拖放的实现"></a>二十九、 react中拖放的实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 技术要点</span><br><span class="line">  a 如何使用React的鼠标事件系统</span><br><span class="line">  b 如何判断拖放开始和拖放结束</span><br><span class="line">  c 如何实现拖放元素的位置移动</span><br><span class="line">  d 拖放状态在组件中如何维护</span><br><span class="line"><span class="number">2.</span> demo</span><br><span class="line">  react-beautiful-dnd虽然好，但是太繁琐了，自己需要明白怎么搞dnd的原理</span><br></pre></td></tr></table></figure>
<h3 id="三十、性能优化（如何避免应用出现性能问题）"><a href="#三十、性能优化（如何避免应用出现性能问题）" class="headerlink" title="三十、性能优化（如何避免应用出现性能问题）"></a>三十、性能优化（如何避免应用出现性能问题）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 了解常见的性能问题场景[例如键盘输入、鼠标移动例如滚动页面]</span><br><span class="line"><span class="number">2.</span> 自动按需加载[loadable|webpack按需加载]</span><br><span class="line"><span class="number">3.</span> 使用reselect避免重复计算</span><br><span class="line"><span class="number">4.</span> 异步渲染</span><br></pre></td></tr></table></figure>
<h3 id="三十一、使用Chrome-DevTool"><a href="#三十一、使用Chrome-DevTool" class="headerlink" title="三十一、使用Chrome DevTool"></a>三十一、使用Chrome DevTool</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 使用react DevTool 找到多余的渲染</span><br><span class="line"><span class="number">2.</span> 使用Chrome DevTool 定位性能瓶颈</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/treeform表单设计/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/22/treeform表单设计/" class="post-title-link" itemprop="url">treeform表单设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-22 14:32:01" itemprop="dateCreated datePublished" datetime="2019-01-22T14:32:01+00:00">2019-01-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、用法示例"><a href="#一、用法示例" class="headerlink" title="一、用法示例"></a>一、用法示例</h3><ol>
<li><p>组件调用方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Props     | Type         | use</span><br><span class="line">--------- | ------------ | ---------  </span><br><span class="line">treeData  | object|array | 业务数据来源</span><br><span class="line">schemaData| object       | UI形态设计(表单)</span><br><span class="line">onError   | <span class="function"><span class="keyword">function</span>     | 类型校验错误处理函数，回传错误<span class="title">info</span></span></span><br><span class="line"><span class="function"><span class="title">onChange</span>  | <span class="title">function</span>     | 回传<span class="title">treeData</span>的最新状态，业务里需要写一个<span class="title">action</span>改变<span class="title">store</span></span></span><br><span class="line"><span class="function"><span class="title">onSubmit</span>  | <span class="title">function</span>     | 回传当前提交表单下的数据</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&lt;<span class="title">TreeForm</span></span></span><br><span class="line"><span class="function">  <span class="title">treeData</span>=</span>&#123;treeData&#125;</span><br><span class="line">  schemaData=&#123;noticeSettingSchema&#125;</span><br><span class="line">  onError=&#123;<span class="keyword">this</span>.onError&#125;</span><br><span class="line">  onChange=&#123;<span class="keyword">this</span>.onChange&#125;</span><br><span class="line">  onSubmit=&#123;<span class="keyword">this</span>.onSubmit&#125; </span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>const/notice业务的schema，主要设计的式表单相关<br>此处的设计遵循 <a href="http://json-schema.org/" target="_blank" rel="noopener">JSON schema</a><br>有2个作用 A.自动生成表单  B.利用jsonschema校验基础类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">showField  | Type    | use</span><br><span class="line">---------- | ------- | -----------------------------------------------  </span><br><span class="line">type       | string  | 数据的类型object|array|string </span><br><span class="line">field      | string  | UI的展示形式 [text|select|time|textarea ]</span><br><span class="line">properties | object  | object类型的表单数据组织</span><br><span class="line">title      | string  | 表单的title</span><br><span class="line">placeholder| string  | input的默认placeholder</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">validator | Type     | use</span><br><span class="line">--------- | -------- | -----------------------------------------------  </span><br><span class="line">required  | array    | 设置当前表单的必填字段</span><br><span class="line">maxItems  | number   | 超过最大长度会触发onError,不触发onSubmit</span><br><span class="line">maxLength | number   | 超过最大长度会触发onError,不触发onSubmit</span><br><span class="line">minLength | number   | 小与最小长度会触发onError,不触发onSubmit</span><br><span class="line">pattern   | <span class="built_in">RegExp</span>   | 校验数据类型，会触发onError,不触发onSubmit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">action    | Type     | use</span><br><span class="line">--------- | -------- | ----------------------------------------------- </span><br><span class="line">canSubmit | boolean  | 表单页面是否出现submit按钮，默认<span class="literal">false</span>，不出现</span><br><span class="line">canDel    | boolean  | 当前表单列表是否允许删除，默认<span class="literal">false</span>，不删除</span><br><span class="line">canAdd    | boolean  | 当前表单列表是否允许新增，默认<span class="literal">false</span>，不新增</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> noticeSettingSchema = &#123;</span><br><span class="line">  type: <span class="string">'object'</span>,</span><br><span class="line">  field: <span class="string">'object'</span>,</span><br><span class="line">  canSubmit: <span class="literal">true</span>,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    children: &#123;</span><br><span class="line">      type: <span class="string">'array'</span>,</span><br><span class="line">      field: <span class="string">'array'</span>,</span><br><span class="line">      maxItems: <span class="number">50</span>,</span><br><span class="line">      defaultItemName: <span class="string">'Notice'</span>,</span><br><span class="line">      canAdd: <span class="literal">true</span>,</span><br><span class="line">      canDel: <span class="literal">true</span>,</span><br><span class="line">      items: &#123;</span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        field: <span class="string">'object'</span>,</span><br><span class="line">        required: [ <span class="string">'name'</span>, <span class="string">'status'</span>, <span class="string">'startTime'</span>, <span class="string">'endTime'</span>, <span class="string">'cycleType'</span>,   <span class="string">'text'</span> ],</span><br><span class="line">        properties: &#123;</span><br><span class="line">          name: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'text'</span>,</span><br><span class="line">            title: <span class="string">'Name'</span>,</span><br><span class="line">            maxLength: <span class="number">20</span>,</span><br><span class="line">            pattern: <span class="regexp">/.*\S+.*/</span></span><br><span class="line">          &#125;,</span><br><span class="line">          status: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'select'</span>,</span><br><span class="line">            title: <span class="string">'Status'</span>,</span><br><span class="line">            data: [&#123;</span><br><span class="line">              title: <span class="string">'Shown'</span>,</span><br><span class="line">              value: <span class="string">'shown'</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">              title: <span class="string">'Hidden'</span>,</span><br><span class="line">              value: <span class="string">'hidden'</span></span><br><span class="line">            &#125;],</span><br><span class="line">            defaultValue: <span class="string">'shown'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          startTime: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'time'</span>,</span><br><span class="line">            title: <span class="string">'Start Time'</span>,</span><br><span class="line">            defaultValue: <span class="string">'00:00'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          endTime: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'time'</span>,</span><br><span class="line">            title: <span class="string">'End Time'</span>,</span><br><span class="line">            defaultValue: <span class="string">'23:59'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          cycleType: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'select'</span>,</span><br><span class="line">            title: <span class="string">'Cycle'</span>,</span><br><span class="line">            data: [&#123;</span><br><span class="line">              title: <span class="string">'Every Day'</span>,</span><br><span class="line">              value: <span class="string">'EveryDay'</span></span><br><span class="line">            &#125;],</span><br><span class="line">            defaultValue: <span class="string">'EveryDay'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          startDate: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'datePicker'</span>,</span><br><span class="line">            title: <span class="string">'Start Date'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          endDate: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'datePicker'</span>,</span><br><span class="line">            title: <span class="string">'End Date'</span></span><br><span class="line">          &#125;,</span><br><span class="line">          text: &#123;</span><br><span class="line">            type: <span class="string">'string'</span>,</span><br><span class="line">            field: <span class="string">'textarea'</span>,</span><br><span class="line">            title: <span class="string">'Text'</span>,</span><br><span class="line">            maxLength: <span class="number">70</span>,</span><br><span class="line">            placeholder: <span class="string">'Please input text'</span>,</span><br><span class="line">            pattern: <span class="regexp">/.*\S+.*/</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>notice的treeData数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">showField  | Type                | use</span><br><span class="line">---------- | ------------------- | ----------------------------------------  </span><br><span class="line">id         | string              | 必填，节点的唯一标识 </span><br><span class="line">name       | string              | 必填，节点的展示标识</span><br><span class="line">toggled    | boolean             | 树节点是否展开，<span class="literal">true</span>为展开，<span class="literal">false</span>为关闭(默认)</span><br><span class="line">active     | boolean             | 展示的当前节点，对应节点的object的active为<span class="literal">true</span></span><br><span class="line">childrenKey| string              | 当前树子节点的key</span><br><span class="line">data       | array|object|string | 当前数据为array时候，组件会自动增加childrenKey</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  id: <span class="number">0</span>,</span><br><span class="line">  name: <span class="string">'notice'</span>,</span><br><span class="line">  toggled: <span class="literal">true</span>,</span><br><span class="line">  children: [&#123;</span><br><span class="line">      name: <span class="string">"Notice 8"</span>,</span><br><span class="line">      status: <span class="string">"shown"</span>,</span><br><span class="line">      start_time : <span class="string">"00:00"</span>,</span><br><span class="line">      end_time : <span class="string">"23:59"</span>,</span><br><span class="line">      start_date : <span class="string">""</span>,</span><br><span class="line">      end_date : <span class="string">""</span>,</span><br><span class="line">      text : <span class="string">" 35"</span>,</span><br><span class="line">      cycle_type : <span class="string">"EveryDay"</span>,</span><br><span class="line">      create_time : <span class="string">"2019-01-22 13:55"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name : <span class="string">"Notice 7"</span>,</span><br><span class="line">      status : <span class="string">"shown"</span>,</span><br><span class="line">      start_time : <span class="string">"00:00"</span>,</span><br><span class="line">      end_time : <span class="string">"23:59"</span>,</span><br><span class="line">      start_date : <span class="string">""</span>,</span><br><span class="line">      end_date : <span class="string">""</span>,</span><br><span class="line">      text : <span class="string">" grge"</span>,</span><br><span class="line">      cycle_type : <span class="string">"EveryDay"</span>,</span><br><span class="line">      create_time : <span class="string">"2019-01-22 13:55"</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="dp-admin.test.xxxxx.io/id/notice/detail/1">notice demo访问地址</a></p>
</li>
</ol>
<h3 id="二、实现思路"><a href="#二、实现思路" class="headerlink" title="二、实现思路"></a>二、实现思路</h3><p><a href="https://www.processon.com/view/link/5c47069ae4b03334b50c3f34" target="_blank" rel="noopener">实现思路流程图</a></p>
<h3 id="三、待优化部分"><a href="#三、待优化部分" class="headerlink" title="三、待优化部分"></a>三、待优化部分</h3><ol>
<li><p>id和name的设计</p>
</li>
<li><p>数据同步问题</p>
</li>
<li><p>关键函数的实现</p>
</li>
</ol>
<h3 id="四、问题"><a href="#四、问题" class="headerlink" title="四、问题"></a>四、问题</h3><p>1.某某这个页面需要填写用户信息？</p>
<p>这几个输入框能填写正常信息就行</p>
<p>2.so easy？</p>
<p>Bug太磨人，这个光标，这个键盘，那个校验</p>
<p>3.听说你解过这个bug，我的邮箱校验好像漏了个啥</p>
<p>抄作业</p>
<p>🈶️</p>
<p>4.奋发图强，做一个通用方案，不让同事在踩坑？</p>
<p>sniper ota和nearby里的@comp/Common/DataEntry/Form</p>
<p>Windrunner </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/14/commitzen的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/14/commitzen的使用/" class="post-title-link" itemprop="url">commitzen的使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-14 10:23:02" itemprop="dateCreated datePublished" datetime="2018-12-14T10:23:02+00:00">2018-12-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><a href="https://github.com/commitizen/cz-cli" target="_blank" rel="noopener">commitzen</a>是一个帮助规范commit message的工具，优点很规范、优雅、易管理拓展等等好处不列举了，看下怎么使用</p>
<h3 id="一、commit-message-格式"><a href="#一、commit-message-格式" class="headerlink" title="一、commit message 格式"></a>一、commit message 格式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">commit message</span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>(<span class="tag">&lt;<span class="name">scope</span>&gt;</span>): <span class="tag">&lt;<span class="name">subject</span>&gt;</span></span><br><span class="line">// 空一行</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">// 空一行</span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Header</span><br><span class="line">  type + scope + subject</span><br><span class="line">type</span><br><span class="line">  feat    : 新增加的功能（feature）</span><br><span class="line">  fix     : 修复bug</span><br><span class="line">  doc     : 文档，例如README</span><br><span class="line">  style   : 格式（不影响代码运行的变动）</span><br><span class="line">  refactor: 重构</span><br><span class="line">  test    : 测试</span><br><span class="line">  chore   : 构建过程或辅助工具的变动，项目版本变更等。</span><br><span class="line">scope   : 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同</span><br><span class="line">subject : 提交内容的简要描述</span><br></pre></td></tr></table></figure>
<h3 id="二、commitizen-全局安装"><a href="#二、commitizen-全局安装" class="headerlink" title="二、commitizen(全局安装)"></a>二、commitizen(全局安装)</h3><ol>
<li><p>全局安装执行命令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  test npm install -g commitizen</span><br><span class="line">➜  test  commitizen init cz-conventional-changelog --save --save-exact</span><br><span class="line">（或者 echo <span class="string">'&#123; "path": "cz-conventional-changelog" &#125;'</span> &gt; ~<span class="regexp">/.czrc）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置的改变</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">"devDependencies": &#123;</span><br><span class="line">  "cz-conventional-changelog": "^2.1.0"</span><br><span class="line">&#125;,</span><br><span class="line">"config": &#123;</span><br><span class="line">  "commitizen": &#123;</span><br><span class="line">    "path": "./node_modules/cz-conventional-changelog"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>全局安装demo</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">➜  xxxxx mkdir test</span><br><span class="line">➜  xxxxx cd test</span><br><span class="line">➜  test npm init</span><br><span class="line">➜  test npm i</span><br><span class="line">➜  test npm install -g commitizen</span><br><span class="line">➜  test  commitizen init cz-conventional-changelog --save --save-exact</span><br><span class="line">➜  test git init</span><br><span class="line">➜  test git:(master) ✗ git status</span><br><span class="line">➜  test git:(master) ✗ git add .</span><br><span class="line">➜  test git:(master) ✗ git cz</span><br><span class="line">cz-cli@<span class="number">3.0</span><span class="number">.5</span>, cz-conventional-changelog@<span class="number">2.1</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Line <span class="number">1</span> will be cropped at <span class="number">100</span> characters. All other lines will be wrapped after <span class="number">100</span> characters.</span><br><span class="line"></span><br><span class="line">? Select the type <span class="keyword">of</span> change that you<span class="string">'re committing: (Use arrow keys)</span></span><br><span class="line"><span class="string">❯ feat:     A new feature</span></span><br><span class="line"><span class="string">  fix:      A bug fix</span></span><br><span class="line"><span class="string">  docs:     Documentation only changes</span></span><br><span class="line"><span class="string">  style:    Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)</span></span><br><span class="line"><span class="string">  refactor: A code change that neither fixes a bug nor adds a feature</span></span><br><span class="line"><span class="string">  perf:     A code change that improves performance</span></span><br><span class="line"><span class="string">  test:     Adding missing tests or correcting existing tests</span></span><br><span class="line"><span class="string">(Move up and down to reveal more choices)</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="三、commitizen-局部安装"><a href="#三、commitizen-局部安装" class="headerlink" title="三、commitizen(局部安装)"></a>三、commitizen(局部安装)</h3><ol>
<li><p>局部安装执行命令（AB方法等效）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---------------方法A-------------------------</span><br><span class="line">➜  test  npm i commitizen --save-dev</span><br><span class="line">➜  test ./node_modules/.bin/commitizen init cz-conventional-changelog --save-dev</span><br><span class="line">---------------方法B-------------------------</span><br><span class="line">➜  test  npm i commitizen --save-dev</span><br><span class="line">➜  test  npm i cz-conventional-changelog --save-dev</span><br><span class="line">自己配置package.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"config"</span>: &#123;</span><br><span class="line">    <span class="string">"commitizen"</span>: &#123;</span><br><span class="line">      <span class="string">"path"</span>: <span class="string">"./node_modules/cz-conventional-changelog"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置的改变</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"devDependencies": &#123;</span><br><span class="line">   "commitizen": "^3.0.5",</span><br><span class="line">   "cz-conventional-changelog": "^2.1.0"</span><br><span class="line"> &#125;,</span><br><span class="line"> "config": &#123;</span><br><span class="line">   "commitizen": &#123; </span><br><span class="line">     "path": "./node_modules/cz-conventional-changelog"</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> // 比全局的commitizen多了一个局部依赖commitizen</span><br></pre></td></tr></table></figure>
</li>
<li><p>cz-customizable和cz-conventional-changelog差不多，也是commitizen的adapter。</p>
</li>
</ol>
<h3 id="四、Change-log"><a href="#四、Change-log" class="headerlink" title="四、Change log"></a>四、Change log</h3><ol>
<li><p>全局安装执行脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm install -g conventional-changelog-cli</span><br><span class="line">conventional-changelog -p angular -i CHANGELOG.md -w </span><br><span class="line">为了方便起见我们把这个log的命令写到package.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"changelog"</span>: <span class="string">"conventional-changelog -p angular -i CHANGELOG.md -w -r 0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>全局安装demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">如果你的提交都符合规范，那么执行脚本npm run changelog将生成文档包括下面三个部分</span><br><span class="line">New features</span><br><span class="line">Bug fixes</span><br><span class="line">Breaking changes.</span><br><span class="line">➜  test git:(master) conventional-changelog -p angular -i CHANGELOG.md -w</span><br><span class="line"># 1.0.0 (2018-12-14)</span><br><span class="line">### Features</span><br><span class="line">* **test commitlint and changelog:** test commitlint and changelog c6cb5f5</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="五、commitlint"><a href="#五、commitlint" class="headerlink" title="五、commitlint"></a>五、commitlint</h3><p>commitzen和change log添加了后，还有一个遗留问题，git commit 依旧能使用，忘记的时候还有可能不规范提交，<a href="https://marionebl.github.io/commitlint/#/guides-local-setup" target="_blank" rel="noopener">commitlint安装</a>了解下<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">类似于 eslint commitlint支持配置文件类型</span><br><span class="line"> .commitlint.config.js</span><br><span class="line"> .commitlintrc.js</span><br><span class="line"> .commitlintrc.json</span><br><span class="line"> .commitlintrc.yml </span><br><span class="line"> ...</span><br><span class="line">或者在package.json添加commitlint字段。</span><br></pre></td></tr></table></figure></p>
<ol>
<li>配置一<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Install commitlint cli and conventional config</span><br><span class="line">npm install --save-dev @commitlint/&#123;config-conventional,cli&#125;</span><br><span class="line"># Configure commitlint to use conventional config</span><br><span class="line">echo "module.exports = &#123;extends: ['@commitlint/config-conventional']&#125;" &gt; commitlint.config.js</span><br><span class="line">npm install --save-dev husky</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"@commitlint/cli"</span>: <span class="string">"^7.2.1"</span>,</span><br><span class="line">    <span class="attr">"@commitlint/config-conventional"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="attr">"cz-conventional-changelog"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">    <span class="attr">"husky"</span>: <span class="string">"^1.2.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"husky"</span>: &#123;</span><br><span class="line">    <span class="attr">"hooks"</span>: &#123;</span><br><span class="line">      <span class="attr">"commit-msg"</span>: <span class="string">"commitlint -E HUSKY_GIT_PARAMS"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"commitizen"</span>: &#123;</span><br><span class="line">      <span class="attr">"path"</span>: <span class="string">"./node_modules/cz-conventional-changelog"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>test demo<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  test git:(master) ✗ git add .</span><br><span class="line">➜  test git:(master) ✗ git cm 'test commitlint'</span><br><span class="line">husky &gt; commit-msg (node v10.0.0)</span><br><span class="line"></span><br><span class="line">⧗   input:</span><br><span class="line">test commitlint</span><br><span class="line"></span><br><span class="line">✖   message may not be empty [subject-empty]</span><br><span class="line">✖   type may not be empty [type-empty]</span><br><span class="line">✖   found 2 problems, 0 warningshusky &gt; commit-msg hook failed (add --no-verify to bypass)</span><br></pre></td></tr></table></figure></p>
<h3 id="六、实践问题"><a href="#六、实践问题" class="headerlink" title="六、实践问题"></a>六、实践问题</h3><p>在加上了commitzen之后遇到一个问题，不同人提交终端提示不一样，最终的提交记录也不一样，有的有小图标，有的没有小图标？</p>
<ol>
<li><p>有图标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  sniper git:(feature-train-tickets) npm run commit</span><br><span class="line"></span><br><span class="line">&gt; sniper@0.1.0 commit /Users/weiqian/Desktop/sniper</span><br><span class="line">&gt; npx git-cz</span><br><span class="line"></span><br><span class="line">npx: 1 安装成功，用时 3.681 秒</span><br><span class="line">? Select the type of change that you&apos;re committing:</span><br><span class="line">  🎡 ci:         CI related changes</span><br><span class="line">  ⚡️ perf:       A code change that improves performance</span><br><span class="line">  💍 test:       Adding missing tests</span><br><span class="line">❯ 🎸 feat:       A new feature</span><br><span class="line">  🐛 fix:        A bug fix</span><br><span class="line">  🤖 chore:      Build process or auxiliary tool changes</span><br><span class="line">  ✏️ docs:       Documentation only changes</span><br></pre></td></tr></table></figure>
</li>
<li><p>没图标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  sniper git:(feature-train-tickets) ✗ npm run commit</span><br><span class="line"></span><br><span class="line">&gt; sniper@0.1.1 commit /Users/weiqian/Desktop/sniper</span><br><span class="line">&gt; npx git-cz</span><br><span class="line"></span><br><span class="line">cz-cli@3.0.5, cz-conventional-changelog@2.1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Line 1 will be cropped at 100 characters. All other lines will be wrapped after 100 characters.</span><br><span class="line"></span><br><span class="line">? Select the type of change that you&apos;re committing: (Use arrow keys)</span><br><span class="line">❯ feat:     A new feature</span><br><span class="line">  fix:      A bug fix</span><br><span class="line">  docs:     Documentation only changes</span><br><span class="line">  style:    Changes that do not affect the meaning of the code (white-space, formatting, missing semi</span><br><span class="line">-colons, etc)</span><br><span class="line">  refactor: A code change that neither fixes a bug nor adds a feature</span><br><span class="line">  perf:     A code change that improves performance</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>从执行的命令可以看到，执行npx git-cz，有图标的实际上是在安装git-cz的adpater。没有图标的实际上是用的<a href="mailto:cz-cli@3.0.5" target="_blank" rel="noopener">cz-cli@3.0.5</a>的adapter，为什么执行同样的命令会发生不一样的结果，是因为npm的bin目录不一致导致，最简单的方法就是把依赖安装到项目本身，而不是用全局命令，保证所有人命令是统一的。</p>
<h3 id="七、npm-一些其他命令"><a href="#七、npm-一些其他命令" class="headerlink" title="七、npm 一些其他命令"></a>七、npm 一些其他命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm list -g --depth 0</span><br><span class="line">npm cache clean -f</span><br><span class="line">sudo chown -R $USER /Users/weiqian/Desktop/test</span><br></pre></td></tr></table></figure>
<p>➜  sniper git:(feature-train-tickets) ✗ npm list -g –depth 0<br>/usr/local/lib<br>├── @<a href="mailto:xxxxx/regen@0.3.0" target="_blank" rel="noopener">xxxxx/regen@0.3.0</a><br>├── <a href="mailto:ant-design-pro-cli@1.0.0" target="_blank" rel="noopener">ant-design-pro-cli@1.0.0</a><br>├── <a href="mailto:babel-eslint@8.2.5" target="_blank" rel="noopener">babel-eslint@8.2.5</a><br>├── <a href="mailto:commitizen@3.0.5" target="_blank" rel="noopener">commitizen@3.0.5</a><br>├── <a href="mailto:conventional-changelog-cli@2.0.11" target="_blank" rel="noopener">conventional-changelog-cli@2.0.11</a><br>├── <a href="mailto:create-react-app@1.5.2" target="_blank" rel="noopener">create-react-app@1.5.2</a><br>├── <a href="mailto:cz@1.8.2" target="_blank" rel="noopener">cz@1.8.2</a><br>├── <a href="mailto:depcheck@0.6.11" target="_blank" rel="noopener">depcheck@0.6.11</a><br>├── <a href="mailto:download-csv@1.1.1" target="_blank" rel="noopener">download-csv@1.1.1</a><br>├── <a href="mailto:eslint@5.0.1" target="_blank" rel="noopener">eslint@5.0.1</a><br>├── <a href="mailto:hexo@3.7.1" target="_blank" rel="noopener">hexo@3.7.1</a><br>├── <a href="mailto:hexo-cli@1.1.0" target="_blank" rel="noopener">hexo-cli@1.1.0</a><br>├── <a href="mailto:husky@0.14.3" target="_blank" rel="noopener">husky@0.14.3</a><br>├── <a href="mailto:n@2.1.11" target="_blank" rel="noopener">n@2.1.11</a><br>├── <a href="mailto:node-pre-gyp@0.11.0" target="_blank" rel="noopener">node-pre-gyp@0.11.0</a><br>├── <a href="mailto:npm@6.4.1" target="_blank" rel="noopener">npm@6.4.1</a><br>├── <a href="mailto:rapydscript@0.5.58" target="_blank" rel="noopener">rapydscript@0.5.58</a><br>├── <a href="mailto:rimraf@2.6.2" target="_blank" rel="noopener">rimraf@2.6.2</a><br>├── <a href="mailto:sqlite3@4.0.2" target="_blank" rel="noopener">sqlite3@4.0.2</a><br>├── <a href="mailto:standard@11.0.1" target="_blank" rel="noopener">standard@11.0.1</a><br>├── <a href="mailto:webpack@4.8.3" target="_blank" rel="noopener">webpack@4.8.3</a><br>├── <a href="mailto:webpack-cli@2.1.3" target="_blank" rel="noopener">webpack-cli@2.1.3</a><br>├── <a href="mailto:webpack-dev-server@3.1.4" target="_blank" rel="noopener">webpack-dev-server@3.1.4</a><br>├── <a href="mailto:whistle@1.10.10" target="_blank" rel="noopener">whistle@1.10.10</a><br>├── <a href="mailto:whistle.vase@0.1.0" target="_blank" rel="noopener">whistle.vase@0.1.0</a><br>└── <a href="mailto:yarn@1.9.4" target="_blank" rel="noopener">yarn@1.9.4</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/13/基本代码规范（持续更新中-）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/13/基本代码规范（持续更新中-）/" class="post-title-link" itemprop="url">基本代码规范（持续更新中...）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-13 18:35:55" itemprop="dateCreated datePublished" datetime="2018-12-13T18:35:55+00:00">2018-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、日常CR代码规范"><a href="#一、日常CR代码规范" class="headerlink" title="一、日常CR代码规范"></a>一、日常CR代码规范</h3><p>JS部分</p>
<ol>
<li>字符串模版</li>
<li>indexOf x  =&gt; includes</li>
<li>ployfill =&gt; Object.values() </li>
<li>[…new Array(max).keys()]</li>
<li>combineAction createStructuredSelector</li>
</ol>
<p>CS部分</p>
<ol>
<li>颜色字体大小用统一的变量</li>
<li>最小单位写1px，不要用p2w(1)</li>
<li>常用的箭头之类的写成函数</li>
</ol>
<h3 id="二、项目规范"><a href="#二、项目规范" class="headerlink" title="二、项目规范"></a>二、项目规范</h3><p>component/common部分<br>组件比较多，参照了antd和element的分类方法</p>
<ol>
<li>General-通用</li>
<li>Layout-布局</li>
<li>DataEntry-数据录入</li>
<li>DataDisplay-数据展示</li>
<li>Feedback-反馈</li>
<li>Deprecated-废弃</li>
<li>Primary-业务</li>
</ol>
<p></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/13/一个npm包引起的bug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/13/一个npm包引起的bug/" class="post-title-link" itemprop="url">一个npm包引起的小bug</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-13 10:32:16" itemprop="dateCreated datePublished" datetime="2018-12-13T10:32:16+00:00">2018-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">测试到了尾声，测试小姐姐忽然找到说filter点击不生效，一脸蒙蔽发生什么，本地测试是OK的啊</span><br></pre></td></tr></table></figure>
<h3 id="二、猜想"><a href="#二、猜想" class="headerlink" title="二、猜想"></a>二、猜想</h3><ol>
<li>重启大法好，node_modules，重新安装下，没卵用</li>
<li><p>webpack的prodution和development版本不一样？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a. 把dev.js的mode配置由development改为production</span><br><span class="line">b. 给prod.js里添加devServer配置，运行prod.js</span><br><span class="line">c. 用python起一个简单的服务器 python -m SimpleHTTPServer <span class="number">8001</span></span><br><span class="line">...</span><br><span class="line">没找到问题</span><br></pre></td></tr></table></figure>
</li>
<li><p>点击按钮无效，A原生标签的小手也不见了，应该是被什么东西挡住了，查看dom节点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对比测试线上版本和本地版本，果然看见了dom节点不一样，本地的没有:before，线上有个before挡住了按钮，所以点击不到</span><br><span class="line">a. 样式污染了吗？ 找配置的问题，modulecss都是有的啊</span><br><span class="line">b. 去antd官网看下，它们也有:before，本地居然没有，但是没更新版本啊</span><br></pre></td></tr></table></figure>
</li>
<li><p>antd出毛病了吧，去搜下issue [:brefore reset filter 这些关键字换着发都是OK的能搜出来的]<br>果然是 <a href="https://github.com/ant-design/ant-design/issues/13563" target="_blank" rel="noopener">https://github.com/ant-design/ant-design/issues/13563</a></p>
</li>
</ol>
<h3 id="三、原因"><a href="#三、原因" class="headerlink" title="三、原因"></a>三、原因</h3><p>是antd的问题没错了，这里还有一些疑问</p>
<ol>
<li>本地为什么是好的，按理说antd的问题本地也会有问题啊？删掉node_modules重装为什么不生效？</li>
</ol>
<p>查看<a href="https://docs.npmjs.com/files/package-lock.json" target="_blank" rel="noopener">npm文档</a> <a href="https://www.zhihu.com/question/62331583" target="_blank" rel="noopener">https://www.zhihu.com/question/62331583</a><br>a. npm 5.0.x 版本，不管package.json怎么变，npm i 时都会根据lock文件下载 <a href="https://github.com/npm/npm/issues/16866" target="_blank" rel="noopener">相关issue</a><br>b. 5.1.0版本后 npm install 会无视lock文件 去下载最新的npm  <a href="https://github.com/npm/npm/issues/17979" target="_blank" rel="noopener">相关issue</a><br>c. 如果改了package.json，且package.json和lock文件不同，那么执行<code>npm i</code>时npm会根据package中的版本号以及语义含义去下载最新的包，并更新至lock  <a href="https://github.com/npm/npm/issues/17979" target="_blank" rel="noopener">相关issue</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">➜  Windrunner git:(master) npm -v</span><br><span class="line"><span class="number">6.4</span><span class="number">.1</span></span><br><span class="line">-------------package.json为^<span class="number">6.5</span><span class="number">.0</span> 第一次执行 npm i -----------------</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">        <span class="string">"qs"</span>: <span class="string">"^6.5.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"requires"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"lockfileVersion"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"qs"</span>: &#123;</span><br><span class="line">      <span class="string">"version"</span>: <span class="string">"6.6.0"</span>,</span><br><span class="line">      <span class="string">"resolved"</span>: <span class="string">"https://registry.npmjs.org/qs/-/qs-6.6.0.tgz"</span>,</span><br><span class="line">      <span class="string">"integrity"</span>: <span class="string">"sha512-KIJqT9jQJDQx5h5uAVPimw6yVg2SekOKu959OCtktD3FjzbpvaPr8i4zzg07DOMz+igA4W/aNM7OV8H37pFYfA=="</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------改package.json为<span class="number">6.5</span><span class="number">.0</span> 第二次执行npm i-----------------</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">        <span class="string">"qs"</span>: <span class="string">"6.5.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"requires"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"lockfileVersion"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"qs"</span>: &#123;</span><br><span class="line">      <span class="string">"version"</span>: <span class="string">"6.5.0"</span>,</span><br><span class="line">      <span class="string">"resolved"</span>: <span class="string">"https://registry.npmjs.org/qs/-/qs-6.5.0.tgz"</span>,</span><br><span class="line">      <span class="string">"integrity"</span>: <span class="string">"sha512-fjVFjW9yhqMhVGwRExCXLhJKrLlkYSaxNWdyc9rmHlrVZbk35YHH312dFd7191uQeXkI3mKLZTIbSvIeFwFemg=="</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------改package.json为^<span class="number">6.5</span><span class="number">.0</span> 第三次执行npm i-----------------</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">        <span class="string">"qs"</span>: <span class="string">"^6.5.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"requires"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"lockfileVersion"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"qs"</span>: &#123;</span><br><span class="line">      <span class="string">"version"</span>: <span class="string">"6.5.0"</span>,</span><br><span class="line">      <span class="string">"resolved"</span>: <span class="string">"https://registry.npmjs.org/qs/-/qs-6.5.0.tgz"</span>,</span><br><span class="line">      <span class="string">"integrity"</span>: <span class="string">"sha512-fjVFjW9yhqMhVGwRExCXLhJKrLlkYSaxNWdyc9rmHlrVZbk35YHH312dFd7191uQeXkI3mKLZTIbSvIeFwFemg=="</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------改package.json为^<span class="number">6.5</span><span class="number">.0</span> 第四次执行npm i-----------------</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">        <span class="string">"qs"</span>: <span class="string">"^6.5.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"requires"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"lockfileVersion"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"qs"</span>: &#123;</span><br><span class="line">      <span class="string">"version"</span>: <span class="string">"6.5.0"</span>,</span><br><span class="line">      <span class="string">"resolved"</span>: <span class="string">"https://registry.npmjs.org/qs/-/qs-6.5.0.tgz"</span>,</span><br><span class="line">      <span class="string">"integrity"</span>: <span class="string">"sha512-fjVFjW9yhqMhVGwRExCXLhJKrLlkYSaxNWdyc9rmHlrVZbk35YHH312dFd7191uQeXkI3mKLZTIbSvIeFwFemg=="</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------rm package-lock.json第<span class="number">5</span>次执行npm i---无变化--------------</span><br><span class="line">------------rm -rf node_modules 第<span class="number">6</span>次执行npm i---无变化--------------</span><br><span class="line">------------rm -rf node_modules package-lock.json 第<span class="number">7</span>次执行npm i---有变化--------------</span><br><span class="line">回到了最初的地方，所以为了稳妥起见，如果你和我一样，不确定包的安装策略，又想安装到和服务端一样的包，那么就把node_modules和package-lock.json都删掉，再npm i</span><br><span class="line">在定位问题的时候，我一直都删除node_modules重装，但实际上包一直都没有更新，本地的antd包是一个没有bug的包，线上jenkins在编译的时候没有lock版本，会一直更新，antd的bug也就被更新进来了。</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>代码的package.json一直没有更新版本，为什么antd会有问题？npm是围绕着语义版本控制<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">semver</a>的思想而设计的<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">semver以x.y.z为格式，x为major，y为minor，z为patch 以下这三种情况需要增加相应的版本号:</span><br><span class="line"></span><br><span class="line">主版本号： 当API发生改变，并与之前的版本不兼容的时候</span><br><span class="line">次版本号： 当增加了功能，但是向后兼容的时候</span><br><span class="line">补丁版本号： 当做了向后兼容的缺陷修复的时候</span><br><span class="line"></span><br><span class="line"><span class="string">"5.0.3"</span> 表示安装指定的<span class="number">5.0</span><span class="number">.3</span>版本</span><br><span class="line"><span class="string">"~5.0.3"</span> 表示安装<span class="number">5.0</span>.X中最新的版本</span><br><span class="line"><span class="string">"^5.0.3"</span> 表示安装<span class="number">5.</span>X.X中最新的版本</span><br><span class="line"></span><br><span class="line">package.json的配置是 <span class="string">"antd"</span>: <span class="string">"^3.4.3"</span>, antd更新了，测试项目build时候也会自己更新到有bug的版本</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="四、疑问"><a href="#四、疑问" class="headerlink" title="四、疑问"></a>四、疑问</h3><p><a href="https://github.com/yarnpkg/yarn" target="_blank" rel="noopener">yarn</a>可以解决版本非确定性的问题，我们为什么没用呢？不少讨论的，其实差别也还好～<br><a href="https://blog.risingstack.com/yarn-vs-npm-node-js-package-managers/" target="_blank" rel="noopener">相关讨论</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/16/ant-pro替换-dva框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/16/ant-pro替换-dva框架/" class="post-title-link" itemprop="url">ant-pro替换-dva框架</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-16 16:39:24" itemprop="dateCreated datePublished" datetime="2018-11-16T16:39:24+00:00">2018-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xxxxx/" itemprop="url" rel="index"><span itemprop="name">xxxxx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>背景参考<a href="https://weiqian93.github.io/2018/11/16/ant-pro-%E6%9B%BF%E6%8D%A2roadhog%E4%B8%BAwebpack/" target="_blank" rel="noopener">ant-pro 替换roadhog为webpack</a></p>
<h3 id="一、替换步骤概览（what）"><a href="#一、替换步骤概览（what）" class="headerlink" title="一、替换步骤概览（what）"></a>一、替换步骤概览（what）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 添加meepjs相关loader webpack配置</span><br><span class="line"><span class="number">2.</span> 新建apis文件配置yml文件，删除service/api模块</span><br><span class="line"><span class="number">3.</span> 新建store|reducer模块、删除model模块</span><br><span class="line"><span class="number">4.</span> 新建页面Loadable加载、删除dva/dynamic的创建方式</span><br><span class="line"><span class="number">5.</span> page里面引入react-redux的connent、删除dva的connect</span><br><span class="line"><span class="number">6.</span> 结合yml引入新的error模块，删除原有的error模块</span><br><span class="line"><span class="number">7.</span> selector重新写一下，util和helper模块规划的更细一些</span><br><span class="line"><span class="number">8.</span> 重新替换上自己的layout布局</span><br><span class="line"><span class="number">9.</span> 新增mock、i18n（这<span class="number">2</span>个模块作用现在不是很大，为了后面提取更完善的框架，先把这些标配的东西放进去）</span><br></pre></td></tr></table></figure>
<h3 id="二、为什么要做替换呢-why"><a href="#二、为什么要做替换呢-why" class="headerlink" title="二、为什么要做替换呢(why)"></a>二、为什么要做替换呢(why)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> dva的框架和现在有sniper的框架有一些差距，很容易走到一个人的小圈子，不够开放，不能及时更新同步新的东西</span><br><span class="line"><span class="number">2.</span> 代码的可读性没有sniper高，sniper模块就很繁琐强迫证一样，但也使的代码的可读性更好</span><br><span class="line"><span class="number">3.</span> 我们做自己的脚手架，从打包到ui最终都尽量用自己的东西，更好掌控一些，这样就一定要去掉这些别人家的轮子，做自家轮子</span><br><span class="line"><span class="number">4.</span> 把这些模块慢慢替换掉后，就可以慢慢打磨代码，从线上代码很快提取手架的，相互磨合改造的一个过程。</span><br></pre></td></tr></table></figure>
<h3 id="三、首次迁移的遗留问题"><a href="#三、首次迁移的遗留问题" class="headerlink" title="三、首次迁移的遗留问题"></a>三、首次迁移的遗留问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> reducer的模块多繁琐，代码都差不多，如何精简</span><br><span class="line"><span class="number">2.</span> 关于数据的处理，有时候时在action 有时候时在saga，这里有没有更好的规范</span><br><span class="line"><span class="number">3.</span> 各个组件之间的loading和全局的loading组织关系，怎么优雅组织代码</span><br></pre></td></tr></table></figure>
<h3 id="四、dva替换部分具体细节"><a href="#四、dva替换部分具体细节" class="headerlink" title="四、dva替换部分具体细节"></a>四、dva替换部分具体细节</h3><ol>
<li><p>添加meepjs相关loader webpack配置 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.base.conf.js</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">   noParse: [<span class="regexp">/\.min\.js$/</span>],</span><br><span class="line">   rules: [</span><br><span class="line">     &#123;</span><br><span class="line">       test: <span class="regexp">/\.yml$/</span>,</span><br><span class="line">       use: [</span><br><span class="line">         &#123; <span class="attr">loader</span>: <span class="built_in">require</span>.resolve(<span class="string">'meepojs-loader'</span>) &#125;</span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建apis文件配置yml文件，删除service/api模块<br>src/apis/banner.yml</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">apis:</span><br><span class="line">  fetchBannerGroup:</span><br><span class="line">    url: <span class="regexp">/api/</span>banner/group</span><br><span class="line">    options:</span><br><span class="line">      method: GET</span><br><span class="line">      timeout: <span class="number">6000</span></span><br><span class="line">    needs:</span><br><span class="line">     group_id: number</span><br><span class="line"></span><br><span class="line">  saveBannerGroup:</span><br><span class="line">    url: <span class="regexp">/api/</span>banner/save</span><br><span class="line">    options:</span><br><span class="line">      method: POST</span><br><span class="line">      timeout: <span class="number">6000</span></span><br><span class="line">    needs:</span><br><span class="line">      images: array</span><br><span class="line">      group_id: number</span><br><span class="line">      group_name: string</span><br><span class="line"></span><br><span class="line">config:</span><br><span class="line">  meta:</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>src/apis/index.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./init.js'</span></span><br><span class="line"><span class="keyword">import</span> &#123; registerApi &#125; <span class="keyword">from</span> <span class="string">'meepojs'</span></span><br><span class="line"><span class="keyword">import</span> bannerApiConf <span class="keyword">from</span> <span class="string">'./banner.yml'</span></span><br><span class="line"><span class="keyword">import</span> &#123; memoizeAsync, hashObj &#125; <span class="keyword">from</span> <span class="string">'@utils/memoize'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> registerApis = <span class="function"><span class="params">apiConfObj</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> apiMap = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> name <span class="keyword">in</span> apiConfObj) &#123;</span><br><span class="line">    apiConfObj[name].url = apiConfObj[name].url.replace(<span class="string">'/api'</span>, <span class="string">'/api/id'</span>)</span><br><span class="line">    apiMap[name] = <span class="function"><span class="params">params</span> =&gt;</span></span><br><span class="line">      (memoizeAsync(</span><br><span class="line">        registerApi(apiConfObj[name]),</span><br><span class="line">        (&#123; query, body, params &#125;) =&gt; apiConfObj[name].url + hashObj(query) + hashObj(params) + hashObj(body)</span><br><span class="line">      ))(params, apiConfObj[name].meta)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> apiMap</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> bannerApi = registerApis(bannerApiConf)</span><br></pre></td></tr></table></figure></p>
<p>src/apis/init.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; notification &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> &#123; accountLogin &#125; <span class="keyword">from</span> <span class="string">'@utils/authority'</span></span><br><span class="line"><span class="keyword">import</span> &#123; clearLoginSession &#125; <span class="keyword">from</span> <span class="string">'@helper/login'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  configDefaultFetchOptions,</span><br><span class="line">  registerApiSuccChecker,</span><br><span class="line">  onHttpError,</span><br><span class="line">  onApiError</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'meepojs'</span></span><br><span class="line"></span><br><span class="line">configDefaultFetchOptions(&#123;</span><br><span class="line">  credentials: <span class="string">'include'</span>,</span><br><span class="line">  prefix: <span class="string">''</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">registerApiSuccChecker(</span><br><span class="line">  (&#123; body, status &#125;) =&gt; body.err_code === <span class="number">0</span> &amp;&amp; status === <span class="number">200</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">onHttpError(<span class="function">(<span class="params">&#123; status, apiConfig &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!apiConfig.meta.showError) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span> (status === <span class="number">404</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.href = <span class="string">'/error/404'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (status &gt;= <span class="number">500</span> &amp;&amp; status &lt; <span class="number">600</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.href = <span class="string">`/error/<span class="subst">$&#123;status&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">onApiError(<span class="function">(<span class="params">&#123; body, status, apiConfig &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (body.err_code !== <span class="number">0</span>) &#123;</span><br><span class="line">    notification.error(&#123;</span><br><span class="line">      message: <span class="string">`Request Error <span class="subst">$&#123;body.err_code&#125;</span>: <span class="subst">$&#123;body.err_msg&#125;</span>`</span>,</span><br><span class="line">      description: body.err_msg</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (body.err_code === <span class="number">31</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">window</span>.alert(body.err_code)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (body.err_code === <span class="number">32</span>) &#123;</span><br><span class="line">      clearLoginSession()</span><br><span class="line">      accountLogin()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>src/utils/momoize.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> hashObj = <span class="function"><span class="params">obj</span> =&gt;</span></span><br><span class="line">  obj ? <span class="built_in">Object</span>.keys(obj).map(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;obj[key]&#125;</span>`</span>).join(<span class="string">'&amp;'</span>)</span><br><span class="line">    : <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MAX_CACHE_SIZE = <span class="number">1000</span></span><br><span class="line"><span class="keyword">const</span> DEFAULT_OPTIONS = &#123;</span><br><span class="line">  isFlush: <span class="literal">false</span>,</span><br><span class="line">  expiry: <span class="number">1000</span> * <span class="number">60</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> memoizeAsync = <span class="function">(<span class="params">func, keyCreator = hashObj</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> that = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">const</span> setCache = <span class="function">(<span class="params">key, data</span>) =&gt;</span> &#123;</span><br><span class="line">    cache[key] = &#123;</span><br><span class="line">      data,</span><br><span class="line">      updateTime: <span class="built_in">Date</span>.now()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">params, opt</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> key = keyCreator(params)</span><br><span class="line">    <span class="keyword">const</span> options = <span class="built_in">Object</span>.assign(&#123;&#125;, DEFAULT_OPTIONS, opt)</span><br><span class="line">    <span class="keyword">const</span> &#123; isFlush, expiry &#125; = options</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(cache).length &gt; MAX_CACHE_SIZE) cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isFlush || !cache[key] || cache[key].updateTime + expiry &lt; <span class="built_in">Date</span>.now()) &#123;</span><br><span class="line">      result = <span class="keyword">await</span> func.call(that, params)</span><br><span class="line">      setCache(key, result)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = cache[key].data</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>新建store|reducer模块、删除model模块<br>src/store.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> createHistory <span class="keyword">from</span> <span class="string">'history/createBrowserHistory'</span></span><br><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">'redux-saga'</span></span><br><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">'redux-logger'</span></span><br><span class="line"><span class="keyword">import</span> &#123; routerReducer, routerMiddleware &#125; <span class="keyword">from</span> <span class="string">'react-router-redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; reducers, sagas &#125; <span class="keyword">from</span> <span class="string">'./reducers'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> history = createHistory(&#123;&#125;)</span><br><span class="line"><span class="keyword">const</span> _routerMiddleware = routerMiddleware(history)</span><br><span class="line"><span class="keyword">const</span> sagaMiddleware = createSagaMiddleware()</span><br><span class="line"><span class="keyword">const</span> middlewares = [sagaMiddleware, _routerMiddleware, logger]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(</span><br><span class="line">  combineReducers(&#123;</span><br><span class="line">    ...reducers,</span><br><span class="line">    router: routerReducer</span><br><span class="line">  &#125;),</span><br><span class="line">  applyMiddleware(...middlewares)</span><br><span class="line">)</span><br><span class="line">sagaMiddleware.run(sagas)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>src/reducer/banner/fetch.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createActions &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeLatest, call, put &#125; <span class="keyword">from</span> <span class="string">'redux-saga/effects'</span></span><br><span class="line"><span class="keyword">import</span> &#123; bannerApi &#125; <span class="keyword">from</span> <span class="string">'@apis/index.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123;</span><br><span class="line">  fetchBannerGroupReq,</span><br><span class="line">  fetchBannerGroupSucc,</span><br><span class="line">  fetchBannerGroupFailed</span><br><span class="line">&#125; = createActions(&#123;</span><br><span class="line">  FETCH_BANNER_GROUP_REQ: <span class="literal">null</span>,</span><br><span class="line">  FETCH_BANNER_GROUP_SUCC: <span class="function">(<span class="params">rsp</span>) =&gt;</span> (&#123; <span class="attr">banner</span>: rsp &#125;),</span><br><span class="line">  FETCH_BANNER_GROUP_FAILED: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">fetchBannerGroupReqSaga</span> (<span class="params">&#123; payload &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; groupId, callback &#125; = payload</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> rsp = <span class="keyword">yield</span> call(bannerApi.fetchBannerGroup, &#123;</span><br><span class="line">      query: &#123;</span><br><span class="line">        group_id: groupId</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    rsp.data = <span class="function">(<span class="params">rsp.data || []</span>).<span class="params">map</span>(<span class="params">(item, idx</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        key: idx + <span class="number">1</span>,</span><br><span class="line">        name: item.name,</span><br><span class="line">        banner_link: item.location,</span><br><span class="line">        redirect_url: item.url,</span><br><span class="line">        start_time: item.start_time,</span><br><span class="line">        end_time: item.end_time</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">yield</span> put(fetchBannerGroupSucc(rsp.data))</span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      callback(rsp.data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">yield</span> put(fetchBannerGroupFailed())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> * <span class="title">watchFetchBannerGroup</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> takeLatest(fetchBannerGroupReq, fetchBannerGroupReqSaga)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************************************************</span></span><br><span class="line"><span class="comment"> *                        saveBannerGroup</span></span><br><span class="line"><span class="comment"> ****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123;</span><br><span class="line">  saveBannerGroupReq,</span><br><span class="line">  saveBannerGroupSucc,</span><br><span class="line">  saveBannerGroupFailed</span><br><span class="line">&#125; = createActions(&#123;</span><br><span class="line">  SAVE_BANNER_GROUP_REQ: <span class="literal">null</span>,</span><br><span class="line">  SAVE_BANNER_GROUP_SUCC: <span class="function">(<span class="params">rsp</span>) =&gt;</span> (&#123; <span class="attr">banner</span>: rsp &#125;),</span><br><span class="line">  SAVE_BANNER_GROUP_FAILED: <span class="literal">null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">saveBannerGroupReqSaga</span> (<span class="params">&#123; payload &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> rsp = <span class="keyword">yield</span> call(bannerApi.saveBannerGroup, &#123;</span><br><span class="line">      body: payload</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">yield</span> put(saveBannerGroupSucc(rsp.data))</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> payload.callback === <span class="string">'function'</span>) &#123;</span><br><span class="line">      payload.callback(rsp.data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="keyword">yield</span> put(saveBannerGroupFailed())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> * <span class="title">watchSaveBannerGroup</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> takeLatest(saveBannerGroupReq, saveBannerGroupReqSaga)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************************************************</span></span><br><span class="line"><span class="comment"> *                        watchFetch</span></span><br><span class="line"><span class="comment"> ****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> watchFetch = [ watchFetchBannerGroup, watchSaveBannerGroup ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  [fetchBannerGroupSucc]: <span class="function">(<span class="params">state, &#123; payload: &#123; banner &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...state</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  [fetchBannerGroupFailed]: <span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">    ...state,</span><br><span class="line">    isError: <span class="literal">true</span></span><br><span class="line">  &#125;),</span><br><span class="line">  [saveBannerGroupSucc]: <span class="function">(<span class="params">state, &#123; payload: &#123; banner &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...state</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  [saveBannerGroupFailed]: <span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">    ...state,</span><br><span class="line">    isError: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>src/reducer/banner/index.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; handleActions &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span></span><br><span class="line"><span class="keyword">import</span> fetchReducer, &#123; watchFetch &#125; <span class="keyword">from</span> <span class="string">'./fetch'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> watchBannerSagas = [</span><br><span class="line">  ...watchFetch</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> handleActions(fetchReducer, &#123;&#125;)</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>新建页面Loadable加载、删除dva/dynamic的创建方式<br>src/index.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ConnectedRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-redux'</span></span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'@layouts/BasicLayout'</span></span><br><span class="line"><span class="keyword">import</span> createHistory <span class="keyword">from</span> <span class="string">'history/createBrowserHistory'</span></span><br><span class="line"><span class="keyword">import</span> &#123; setCountry &#125; <span class="keyword">from</span> <span class="string">'@utils/utils'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.less'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> country = <span class="string">'id'</span></span><br><span class="line">  country = <span class="built_in">window</span>.location.pathname.split(<span class="string">'/'</span>)[<span class="number">1</span>]</span><br><span class="line">  setCountry(country)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> history = createHistory(&#123; <span class="attr">basename</span>: <span class="string">'/'</span> + (country || <span class="string">'id'</span>) &#125;)</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;ConnectedRouter history=&#123;history&#125;&gt;</span><br><span class="line">      &lt;BasicLayout /&gt;</span><br><span class="line">    &lt;<span class="regexp">/ConnectedRouter &gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Provider&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>src/layout/BasicLayout.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Layout &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route, Redirect, Switch &#125; <span class="keyword">from</span> <span class="string">'dva/router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ContainerQuery &#125; <span class="keyword">from</span> <span class="string">'react-container-query'</span></span><br><span class="line"><span class="keyword">import</span> &#123; routerData &#125; <span class="keyword">from</span> <span class="string">'@common/menu'</span></span><br><span class="line"><span class="keyword">import</span> &#123; setCountry &#125; <span class="keyword">from</span> <span class="string">'@utils/utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123; accountLogout &#125; <span class="keyword">from</span> <span class="string">'@utils/authority.js'</span></span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'@comp/Loading'</span></span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span></span><br><span class="line"><span class="keyword">import</span> &#123; layoutData &#125; <span class="keyword">from</span> <span class="string">'@common/default'</span></span><br><span class="line"><span class="keyword">import</span> DocumentTitle <span class="keyword">from</span> <span class="string">'react-document-title'</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">'classnames'</span></span><br><span class="line"><span class="keyword">import</span> GlobalHeader <span class="keyword">from</span> <span class="string">'@comp/GlobalHeader'</span></span><br><span class="line"><span class="keyword">import</span> SiderMenu <span class="keyword">from</span> <span class="string">'@comp/SiderMenu/index.js'</span></span><br><span class="line"><span class="keyword">import</span> NotFound <span class="keyword">from</span> <span class="string">'@pages/Exception/500'</span></span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'@assets/favicon.jpg'</span></span><br><span class="line"><span class="keyword">const</span> &#123; Content, Header, Footer &#125; = Layout</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> genOptions = <span class="function">(<span class="params">loader</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line">    loading: Loading</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    loader</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicLayout</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      collapsed: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.routerConfig = routerData.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (</span><br><span class="line">      (</span><br><span class="line">        &lt;Route</span><br><span class="line">          key=&#123;index&#125;</span><br><span class="line">          path=&#123;item.path&#125;</span><br><span class="line">          title=&#123;item.name&#125;</span><br><span class="line">          component=&#123;Loadable(genOptions(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@pages/'</span> + item.component)))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      )</span><br><span class="line">    ))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleMenuCollapse = <span class="function"><span class="params">collapsed</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      collapsed: !<span class="keyword">this</span>.state.collapsed</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleMenuClick = <span class="function">(<span class="params">&#123; key &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">'logout'</span>) &#123;</span><br><span class="line">      accountLogout()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  handleCountryClick = <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`selected <span class="subst">$&#123;key&#125;</span>`</span>)</span><br><span class="line">    setCountry(key)</span><br><span class="line">    <span class="built_in">window</span>.location = <span class="built_in">window</span>.location.origin + <span class="string">'/'</span> + key</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; collapsed &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> layout = (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;SiderMenu</span><br><span class="line">          collapsed=&#123;collapsed&#125;</span><br><span class="line">          isMobile=&#123;<span class="keyword">this</span>.state.isMobile&#125;</span><br><span class="line">          onCollapse=&#123;<span class="keyword">this</span>.handleMenuCollapse&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Layout&gt;</span><br><span class="line">          &#123; &lt;Header style=&#123;&#123; <span class="attr">padding</span>: <span class="number">0</span> &#125;&#125;&gt;</span><br><span class="line">            &lt;GlobalHeader</span><br><span class="line">              logo=&#123;logo&#125;</span><br><span class="line">              collapsed=&#123;collapsed&#125;</span><br><span class="line">              isMobile=&#123;<span class="keyword">this</span>.state.isMobile&#125;</span><br><span class="line">              onCountryClick=&#123;<span class="keyword">this</span>.handleCountryClick&#125;</span><br><span class="line">              onMenuClick=&#123;<span class="keyword">this</span>.handleMenuClick&#125;</span><br><span class="line">              onCollapse=&#123;<span class="keyword">this</span>.handleMenuCollapse&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Header&gt; &#125;</span></span><br><span class="line"><span class="regexp">          &lt;Content style=&#123;&#123; margin: '24px 24px 0', height: '100%' &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">              &#123; this.routerConfig &#125;</span></span><br><span class="line"><span class="regexp">              &lt;Redirect exact from='/</span><span class="string">' to='</span>order/list<span class="string">' /&gt;</span></span><br><span class="line"><span class="string">              &lt;Route render=&#123;NotFound&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">          &lt;/Content&gt;</span></span><br><span class="line"><span class="string">          &lt;Footer style=&#123;&#123; padding: 0 &#125;&#125; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">      &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    return (</span></span><br><span class="line"><span class="string">      &lt;DocumentTitle title=&#123;layoutData.docTitle&#125;&gt;</span></span><br><span class="line"><span class="string">        &lt;ContainerQuery query=&#123;layoutData.query&#125;&gt;</span></span><br><span class="line"><span class="string">          &#123;params =&gt; &lt;div className=&#123;classNames(params)&#125;&gt;&#123;layout&#125;&lt;/div&gt;&#125;</span></span><br><span class="line"><span class="string">        &lt;/ContainerQuery&gt;</span></span><br><span class="line"><span class="string">      &lt;/DocumentTitle&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default BasicLayout</span></span><br></pre></td></tr></table></figure></p>
<ol start="5">
<li>page里面引入react-redux的connent、删除dva的connect<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> PageHeaderLayout <span class="keyword">from</span> <span class="string">'@layouts/PageHeaderLayout'</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchOrderDetailReq &#125; <span class="keyword">from</span> <span class="string">'@reducers/order/fetch'</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchRefundDetailReq &#125; <span class="keyword">from</span> <span class="string">'@reducers/refund/fetch'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createCardDescriptList &#125; <span class="keyword">from</span> <span class="string">'@utils/utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123; refundDetailSelector, orderDetailSelector &#125; <span class="keyword">from</span> <span class="string">'@selector/index'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RefundDetail</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">location</span>: &#123; pathname &#125; &#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">const</span> urlparam = pathname.split(<span class="string">'/'</span>)[<span class="number">3</span>].split(<span class="string">'_'</span>)</span><br><span class="line">    <span class="keyword">const</span> param = &#123;</span><br><span class="line">      order_id: urlparam[<span class="number">0</span>],</span><br><span class="line">      user_id: urlparam[<span class="number">1</span>] * <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.props.fetchOrderDetailReq(param)</span><br><span class="line">    <span class="keyword">this</span>.props.fetchRefundDetailReq(param)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; refund, order &#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">const</span> refundProfile = refundDetailSelector(refund.detail)</span><br><span class="line">    <span class="keyword">const</span> refundDetail = createCardDescriptList(refundProfile, <span class="string">'Refund Detail'</span>)</span><br><span class="line">    <span class="keyword">const</span> orderProfile = orderDetailSelector(order.detail)</span><br><span class="line">    <span class="keyword">const</span> orderDetail = createCardDescriptList(orderProfile, <span class="string">'Order Detail'</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;PageHeaderLayout&gt;</span><br><span class="line">        &#123; refundDetail &#125;</span><br><span class="line">        &#123; orderDetail &#125;</span><br><span class="line">      &lt;<span class="regexp">/PageHeaderLayout&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = state =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    ...state</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapDispatchToProps = dispatch =&gt; bindActionCreators(&#123;</span></span><br><span class="line"><span class="regexp">  fetchOrderDetailReq,</span></span><br><span class="line"><span class="regexp">  fetchRefundDetailReq</span></span><br><span class="line"><span class="regexp">&#125;, dispatch)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, mapDispatchToProps)(RefundDetail)</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/16/ant-pro-替换roadhog为webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/16/ant-pro-替换roadhog为webpack/" class="post-title-link" itemprop="url">ant-pro 替换roadhog为webpack</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-16 12:29:22" itemprop="dateCreated datePublished" datetime="2018-11-16T12:29:22+00:00">2018-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xxxxx/" itemprop="url" rel="index"><span itemprop="name">xxxxx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>admin项目最初时间紧迫，再确定了使用react技术栈后，选择了快速产出的antd及开箱即用的框架antd-pro。当初框架用的有多爽，后来就有多哭～</p>
<p>9月底决定干掉框架，造一些自己的轮子，为了不影响线上业务，分为3个步骤做：1.替换打包roadhog为webpack 2.替换dva框架为开源的react技术栈 3.替换antd的UI<br>本篇主要记录替换roadhog的步骤。</p>
<h3 id="一、替换步骤概览（what）"><a href="#一、替换步骤概览（what）" class="headerlink" title="一、替换步骤概览（what）"></a>一、替换步骤概览（what）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 新建webpack的配置 config/webpack.base.conf.js|webpack.dev.conf.js|webpack.prod.conf.js</span><br><span class="line"><span class="number">2.</span> 删除webpackrc.js、paths.js，删除package.json里面的roadhog相关包和命令</span><br><span class="line"><span class="number">3.</span> 新增package.json里webpack的依赖包及相关命令、配置babelrc等</span><br><span class="line"><span class="number">4.</span> 删除原来移动文件操作的build.js，改成新的build.js，做终端的编译美化工作。</span><br><span class="line"><span class="number">5.</span> 删掉之前的router模块，改造为react-router4的做法，把menu和路由配置在一起</span><br><span class="line"><span class="number">6.</span> 精简之前的layout|pageheader|golbalheader等</span><br><span class="line"><span class="number">7.</span> 删除所有关于登录权限的模块，我们的权限是后台控制的相当于前端不做权限模块。</span><br></pre></td></tr></table></figure>
<h3 id="二、为什么要做替换呢-why"><a href="#二、为什么要做替换呢-why" class="headerlink" title="二、为什么要做替换呢(why)"></a>二、为什么要做替换呢(why)</h3><p>当初选择的理由只有一个，是框架里自带的，适合快速产出，替换的理由却有很多<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> roadhog jenkins build经常失败，原因未知，解决办法，换个版本号呵呵</span><br><span class="line"><span class="number">2.</span> roadhog 阉割了的webpack，一些自定义的功能接口不能使用，不太方便</span><br><span class="line"><span class="number">3.</span> roadhog 相当于又学了一个不通用的轮子，开源的东西可能更好一些</span><br><span class="line"><span class="number">4.</span> 我们想做自己的脚手架，从打包到ui最终都尽量用自己的东西，更好掌控一些</span><br></pre></td></tr></table></figure></p>
<h3 id="三、首次迁移的遗留问题"><a href="#三、首次迁移的遗留问题" class="headerlink" title="三、首次迁移的遗留问题"></a>三、首次迁移的遗留问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 打包过大，按需加载，优化</span><br><span class="line"><span class="number">2.</span> 其他的更酷的配置，我们目前只用了webpack一些最常见的配置</span><br><span class="line"><span class="number">3.</span> 有一些有问题的配置，例如引不进react，强行插入了，先运行起来</span><br><span class="line"><span class="number">4.</span> 在layout和router menu中需要做的细节工作很多</span><br></pre></td></tr></table></figure>
<p>后面回持续跟进解决这些问题</p>
<h3 id="四、打包工具替换具体细节"><a href="#四、打包工具替换具体细节" class="headerlink" title="四、打包工具替换具体细节"></a>四、打包工具替换具体细节</h3><ol>
<li>webpack相关配置<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.base.conf.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> SRC_PATH = path.resolve(__dirname, <span class="string">'../src'</span>)</span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    src: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../build/windrunner'</span>),</span><br><span class="line">    filename: <span class="string">'js/bundle.js'</span>,</span><br><span class="line">    publicPath: <span class="string">'/'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'@src'</span>: SRC_PATH,</span><br><span class="line">      <span class="string">'@assets'</span>: path.resolve(SRC_PATH, <span class="string">'assets'</span>),</span><br><span class="line">      <span class="string">'@comp'</span>: path.resolve(SRC_PATH, <span class="string">'components'</span>),</span><br><span class="line">      <span class="string">'@common'</span>: path.resolve(SRC_PATH, <span class="string">'common'</span>),</span><br><span class="line">      <span class="string">'@models'</span>: path.resolve(SRC_PATH, <span class="string">'models'</span>),</span><br><span class="line">      <span class="string">'@api'</span>: path.resolve(SRC_PATH, <span class="string">'apis'</span>),</span><br><span class="line">      <span class="string">'@helper'</span>: path.resolve(SRC_PATH, <span class="string">'helpers'</span>),</span><br><span class="line">      <span class="string">'@pages'</span>: path.resolve(SRC_PATH, <span class="string">'pages'</span>),</span><br><span class="line">      <span class="string">'@const'</span>: path.resolve(SRC_PATH, <span class="string">'constants'</span>),</span><br><span class="line">      <span class="string">'@utils'</span>: path.resolve(SRC_PATH, <span class="string">'utils'</span>),</span><br><span class="line">      <span class="string">'@selector'</span>: path.resolve(SRC_PATH, <span class="string">'selectors'</span>),</span><br><span class="line">      <span class="string">'@services'</span>: path.resolve(SRC_PATH, <span class="string">'services'</span>),</span><br><span class="line">      <span class="string">'@layouts'</span>: path.resolve(SRC_PATH, <span class="string">'layouts'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        loader: <span class="string">'babel-loader?cacheDirectory'</span>,</span><br><span class="line">        include: SRC_PATH</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.ANALYZE) &#123;</span><br><span class="line">  <span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin</span><br><span class="line">  config.plugins = config.plugins || []</span><br><span class="line">  config.plugins.push(<span class="keyword">new</span> BundleAnalyzerPlugin())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>webpack.dev.conf.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf.js'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseWebpackConfig, &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  devtool: <span class="string">'cheap-module-source-map'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'js/[name].[hash:16].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;<span class="comment">// CSS处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        loader: <span class="string">'style-loader!css-loader?modules'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;<span class="comment">// antd样式处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/src/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">'style-loader'</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              importLoaders: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(less)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'less-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              javascriptEnabled: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(scss)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'sass-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          loader: <span class="string">'url-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            limit: <span class="number">8192</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'react-svg-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'public/index.html'</span>,</span><br><span class="line">      inject: <span class="string">'body'</span>,</span><br><span class="line">      chunksSortMode: <span class="string">'none'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      <span class="string">'React'</span>: <span class="string">'react'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">80</span>,</span><br><span class="line">    host: <span class="string">'local.dp-admin.test.xxxxx.io'</span>,</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: <span class="string">'http://localhost:3001'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.conf.js</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf.js'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> UglifyJSWebpackPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = merge(baseWebpackConfig, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'static/js/[name].[chunkhash:16].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;<span class="comment">// CSS处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        loader: <span class="string">'style-loader!css-loader?modules'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;<span class="comment">// antd样式处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/src/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">'style-loader'</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              importLoaders: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.(less)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'less-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              javascriptEnabled: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.(scss)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'sass-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          loader: <span class="string">'url-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            limit: <span class="number">8192</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'react-svg-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'public/index.html'</span>,</span><br><span class="line">      inject: <span class="string">'body'</span>,</span><br><span class="line">      chunksSortMode: <span class="string">'none'</span>,</span><br><span class="line">      minify: &#123;</span><br><span class="line">        minimize: <span class="literal">true</span>,</span><br><span class="line">        removeComments: <span class="literal">true</span>,</span><br><span class="line">        collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">        removeAttributeQuotes: <span class="literal">true</span>,</span><br><span class="line">        minifyCSS: <span class="literal">true</span>,</span><br><span class="line">        minifyJS: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      <span class="string">'React'</span>: <span class="string">'react'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'static/css/[name].[hash].css'</span>,</span><br><span class="line">      chunkFilename: <span class="string">'static/css/[id].[hash].css'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'../build'</span>], &#123; <span class="attr">allowExternal</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  ],</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="keyword">new</span> UglifyJSWebpackPlugin(&#123;</span><br><span class="line">        uglifyOptions: &#123;</span><br><span class="line">          ecma: <span class="number">8</span>,</span><br><span class="line">          compress: &#123;</span><br><span class="line">            warnings: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;</span><br><span class="line">        cssProcessorOptions: <span class="literal">true</span> <span class="comment">// eslint-disable-line</span></span><br><span class="line">          ? &#123;</span><br><span class="line">            map: &#123; <span class="attr">inline</span>: <span class="literal">false</span> &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          : &#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: <span class="string">'initial'</span>, <span class="comment">// 代码块类型 必须三选一： "initial"（初始化） | "all"(默认就是all) | "async"（动态加载）</span></span><br><span class="line">      minSize: <span class="number">0</span>, <span class="comment">// 最小尺寸，默认0</span></span><br><span class="line">      minChunks: <span class="number">1</span>, <span class="comment">// 最小 chunk ，默认1</span></span><br><span class="line">      maxAsyncRequests: <span class="number">1</span>, <span class="comment">// 最大异步请求数， 默认1</span></span><br><span class="line">      maxInitialRequests: <span class="number">1</span>, <span class="comment">// 最大初始化请求书，默认1</span></span><br><span class="line">      name: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, <span class="comment">// 名称，此选项课接收 function</span></span><br><span class="line">      cacheGroups: &#123; <span class="comment">// 缓存组会继承splitChunks的配置，但是test、priorty和reuseExistingChunk只能用于配置缓存组。</span></span><br><span class="line">        priority: <span class="string">'0'</span>, <span class="comment">// 缓存组优先级 false | object |</span></span><br><span class="line">        vendor: &#123; <span class="comment">// key 为entry中定义的 入口名称</span></span><br><span class="line">          chunks: <span class="string">'initial'</span>, <span class="comment">// 必须三选一： "initial"(初始化) | "all" | "async"(默认就是异步)</span></span><br><span class="line">          test: <span class="regexp">/react|antd|dva|dva-loading/</span>, <span class="comment">// 正则规则验证，如果符合就提取 chunk</span></span><br><span class="line">          name: <span class="string">'vendor'</span>, <span class="comment">// 要缓存的 分隔出来的 chunk 名称</span></span><br><span class="line">          minSize: <span class="number">0</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">          enforce: <span class="literal">true</span>,</span><br><span class="line">          reuseExistingChunk: <span class="literal">true</span> <span class="comment">// 可设置是否重用已用chunk 不再创建新的chunk</span></span><br><span class="line">        &#125;,</span><br><span class="line">        common: &#123; <span class="comment">// key 为entry中定义的 入口名称</span></span><br><span class="line">          chunks: <span class="string">'initial'</span>, <span class="comment">// 必须三选一： "initial"(初始化) | "all" | "async"(默认就是异步)</span></span><br><span class="line">          test: <span class="regexp">/moment/</span>, <span class="comment">// 正则规则验证，如果符合就提取 chunk</span></span><br><span class="line">          name: <span class="string">'common'</span>, <span class="comment">// 要缓存的 分隔出来的 chunk 名称</span></span><br><span class="line">          minSize: <span class="number">0</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">          enforce: <span class="literal">true</span>,</span><br><span class="line">          reuseExistingChunk: <span class="literal">true</span> <span class="comment">// 可设置是否重用已用chunk 不再创建新的chunk</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>package.json 删除原有的roadhog部分script，替换成新的webpack的相关命令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"debug"</span>: <span class="string">"webpack-dev-server --config config/webpack.dev.conf.js"</span>,</span><br><span class="line">    <span class="string">"analysis"</span>: <span class="string">"ANALYZE=true node scripts/build.js"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"node scripts/build.js"</span>,</span><br><span class="line">    <span class="string">"proxy"</span>: <span class="string">"node data/proxy.js"</span>,</span><br><span class="line">    <span class="string">"mock"</span>: <span class="string">"node data/mock.js"</span>,</span><br><span class="line">    <span class="string">"standard"</span>: <span class="string">"standard"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">      <span class="string">"@babel/core"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-class-properties"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-decorators"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-object-rest-spread"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-syntax-dynamic-import"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-transform-runtime"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"@babel/polyfill"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/preset-env"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"@babel/preset-react"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/runtime"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"@babel/runtime-corejs2"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"autoprefixer"</span>: <span class="string">"^9.2.1"</span>,</span><br><span class="line">    <span class="string">"babel-eslint"</span>: <span class="string">"^10.0.1"</span>,</span><br><span class="line">    <span class="string">"babel-loader"</span>: <span class="string">"^8.0.4"</span>,</span><br><span class="line">       <span class="string">"babel-plugin-syntax-dynamic-import"</span>: <span class="string">"^6.18.0"</span>,</span><br><span class="line">    <span class="string">"chalk"</span>: <span class="string">"^2.4.1"</span>,</span><br><span class="line">    <span class="string">"clean-webpack-plugin"</span>: <span class="string">"^0.1.19"</span>,</span><br><span class="line">    <span class="string">"compression-webpack-plugin"</span>: <span class="string">"^2.0.0"</span>,</span><br><span class="line">    <span class="string">"cross-env"</span>: <span class="string">"^5.2.0"</span>,</span><br><span class="line">    <span class="string">"css-loader"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="string">"enzyme"</span>: <span class="string">"^3.1.0"</span>,</span><br><span class="line">    <span class="string">"express"</span>: <span class="string">"^4.16.4"</span>,</span><br><span class="line">    <span class="string">"gh-pages"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="string">"html-webpack-plugin"</span>: <span class="string">"^3.2.0"</span>,</span><br><span class="line">    <span class="string">"husky"</span>: <span class="string">"^1.1.2"</span>,</span><br><span class="line">    <span class="string">"less"</span>: <span class="string">"^3.8.1"</span>,</span><br><span class="line">    <span class="string">"less-loader"</span>: <span class="string">"^4.1.0"</span>,</span><br><span class="line">    <span class="string">"lint-staged"</span>: <span class="string">"^6.0.0"</span>,</span><br><span class="line">    <span class="string">"meepojs-loader"</span>: <span class="string">"0.0.5"</span>,</span><br><span class="line">    <span class="string">"mini-css-extract-plugin"</span>: <span class="string">"^0.4.4"</span>,</span><br><span class="line">    <span class="string">"mockjs"</span>: <span class="string">"^1.0.1-beta3"</span>,</span><br><span class="line">    <span class="string">"node-sass"</span>: <span class="string">"^4.9.4"</span>,</span><br><span class="line">    <span class="string">"optimize-css-assets-webpack-plugin"</span>: <span class="string">"^5.0.1"</span>,</span><br><span class="line">    <span class="string">"ora"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">    <span class="string">"postcss"</span>: <span class="string">"^7.0.5"</span>,</span><br><span class="line">    <span class="string">"postcss-loader"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">    <span class="string">"prettier"</span>: <span class="string">"1.11.1"</span>,</span><br><span class="line">    <span class="string">"react-svg-loader"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">    <span class="string">"redbox-react"</span>: <span class="string">"^1.5.0"</span>,</span><br><span class="line">    <span class="string">"regenerator-runtime"</span>: <span class="string">"^0.11.1"</span>,</span><br><span class="line">    <span class="string">"request"</span>: <span class="string">"^2.88.0"</span>,</span><br><span class="line">    <span class="string">"sass-loader"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"standard"</span>: <span class="string">"^12.0.1"</span>,</span><br><span class="line">    <span class="string">"style-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">    <span class="string">"uglifyjs-webpack-plugin"</span>: <span class="string">"^1.1.6"</span>,</span><br><span class="line">    <span class="string">"url-loader"</span>: <span class="string">"^1.1.2"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^4.23.1"</span>,</span><br><span class="line">    <span class="string">"webpack-bundle-analyzer"</span>: <span class="string">"^3.0.3"</span>,</span><br><span class="line">    <span class="string">"webpack-cli"</span>: <span class="string">"^3.1.2"</span>,</span><br><span class="line">    <span class="string">"webpack-dev-server"</span>: <span class="string">"^3.1.10"</span>,</span><br><span class="line">    <span class="string">"webpack-merge"</span>: <span class="string">"^4.1.4"</span>  </span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>babelrc.js   postcss.config.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets:[</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"shippedProposals"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"forceAllTransforms"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"browsers"</span>: [</span><br><span class="line">            <span class="string">"&gt; 1%"</span>,</span><br><span class="line">            <span class="string">"last 5 versions"</span>,</span><br><span class="line">            <span class="string">"ie &gt;= 8"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"@babel/preset-react"</span></span><br><span class="line">  ],</span><br><span class="line">  plugins: [</span><br><span class="line">    [<span class="string">"import"</span>, &#123;</span><br><span class="line">      <span class="string">"libraryName"</span>: <span class="string">"antd"</span>,</span><br><span class="line">      <span class="string">"libraryDirectory"</span>: <span class="string">"es"</span>,</span><br><span class="line">      <span class="string">"style"</span>: <span class="string">"css"</span> </span><br><span class="line">    &#125;], <span class="comment">// `style: true` 会加载 less 文件</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/plugin-transform-runtime"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"@babel/transform-arrow-functions"</span>,</span><br><span class="line">    [<span class="string">"@babel/plugin-proposal-decorators"</span>, &#123; <span class="string">"legacy"</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">    [<span class="string">"@babel/plugin-proposal-class-properties"</span>, &#123; <span class="string">"loose"</span> : <span class="literal">true</span> &#125;],</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-object-rest-spread"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-syntax-dynamic-import"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>postcss.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">  plugins: &#123;</span><br><span class="line">    autoprefixer: &#123; <span class="attr">browsers</span>: [<span class="string">'last 5 version'</span>, <span class="string">'&gt;1%'</span>, <span class="string">'ie &gt;= 8'</span>] &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>build脚本美化终端展示<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">'ora'</span>)</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> webpackConfig = <span class="built_in">require</span>(<span class="string">'../config/webpack.prod.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> spinner = ora(<span class="string">'编译中...\n'</span>).start()</span><br><span class="line">webpack(webpackConfig, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    spinner.fail(<span class="string">'编译失败'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  spinner.succeed(<span class="string">'编译已结束. \n'</span>)</span><br><span class="line"></span><br><span class="line">  process.stdout.write(stats.toString(&#123;</span><br><span class="line">    colors: <span class="literal">true</span>,</span><br><span class="line">    modules: <span class="literal">false</span>,</span><br><span class="line">    children: <span class="literal">false</span>,</span><br><span class="line">    chunks: <span class="literal">false</span>,</span><br><span class="line">    chunkModules: <span class="literal">false</span></span><br><span class="line">  &#125;) + <span class="string">'\n\n'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(chalk.cyan(<span class="string">'  编译成功！\n'</span>))</span><br><span class="line">  <span class="built_in">console</span>.log(chalk.yellow(</span><br><span class="line">    <span class="string">'  提示: 编译后的文件可以上传并且部署到服务器\n'</span> +</span><br><span class="line">        <span class="string">'  通过file:// 打开index.html不会起作用.\n'</span></span><br><span class="line">  ))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="五、路由相关地方替换细节"><a href="#五、路由相关地方替换细节" class="headerlink" title="五、路由相关地方替换细节"></a>五、路由相关地方替换细节</h3><ol>
<li><p>删除原有router配置，将menu和router的配置合并在一起</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; countryCodeID &#125; <span class="keyword">from</span> <span class="string">'@const/index'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> menuData = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Order'</span>,</span><br><span class="line">    icon: <span class="string">'book'</span>,</span><br><span class="line">    title: <span class="string">'Order List'</span>,</span><br><span class="line">    path: <span class="string">'/order/list'</span>,</span><br><span class="line">    model: [<span class="string">'order'</span>],</span><br><span class="line">    component: <span class="string">'Order/List'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Refund'</span>,</span><br><span class="line">    icon: <span class="string">'book'</span>,</span><br><span class="line">    path: <span class="string">'/refund/list'</span>,</span><br><span class="line">    title: <span class="string">'Refund List'</span>,</span><br><span class="line">    model: [<span class="string">'refund'</span>],</span><br><span class="line">    component: <span class="string">'Refund/List'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Order'</span>,</span><br><span class="line">    icon: <span class="string">'profile'</span>,</span><br><span class="line">    title: <span class="string">'Order Detail'</span>,</span><br><span class="line">    path: <span class="string">'/order/detail/:id'</span>,</span><br><span class="line">    model: [<span class="string">'order'</span>],</span><br><span class="line">    component: <span class="string">'Order/Detail'</span>,</span><br><span class="line">    hideInMenu: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Refund'</span>,</span><br><span class="line">    icon: <span class="string">'profile'</span>,</span><br><span class="line">    title: <span class="string">'Refund Detail'</span>,</span><br><span class="line">    path: <span class="string">'/refund/detail/:id'</span>,</span><br><span class="line">    model: [<span class="string">'refund'</span>, <span class="string">'order'</span>],</span><br><span class="line">    component: <span class="string">'Refund/Detail'</span>,</span><br><span class="line">    hideInMenu: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Product'</span>,</span><br><span class="line">    icon: <span class="string">'schedule'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Product List'</span>,</span><br><span class="line">        path: <span class="string">'/product/list'</span>,</span><br><span class="line">        title: <span class="string">'Product List'</span>,</span><br><span class="line">        model: [<span class="string">'product'</span>],</span><br><span class="line">        component: <span class="string">'Product/List'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Product MassEdit'</span>,</span><br><span class="line">        path: <span class="string">'/product/massedit'</span>,</span><br><span class="line">        title: <span class="string">'Product MassEdit'</span>,</span><br><span class="line">        model: [<span class="string">'product'</span>],</span><br><span class="line">        component: <span class="string">'Product/MassEdit'</span></span><br><span class="line">      &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Product'</span>,</span><br><span class="line">    icon: <span class="string">'profile'</span>,</span><br><span class="line">    title: <span class="string">'Product Detail'</span>,</span><br><span class="line">    path: <span class="string">'/product/detail/:id'</span>,</span><br><span class="line">    model: [<span class="string">'product'</span>],</span><br><span class="line">    component: <span class="string">'Product/Detail'</span>,</span><br><span class="line">    hideInMenu: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Coins'</span>,</span><br><span class="line">    icon: <span class="string">'form'</span>,</span><br><span class="line">    path: <span class="string">'coins'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Coins Spend'</span>,</span><br><span class="line">        path: <span class="string">'/coins/spend'</span>,</span><br><span class="line">        title: <span class="string">'Coins Spend'</span>,</span><br><span class="line">        model: [<span class="string">'coins'</span>],</span><br><span class="line">        component: <span class="string">'Coins/Spend'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Coins Earn'</span>,</span><br><span class="line">        path: <span class="string">'/coins/earn'</span>,</span><br><span class="line">        title: <span class="string">'Coins Earn'</span>,</span><br><span class="line">        model: [<span class="string">'coins'</span>],</span><br><span class="line">        component: <span class="string">'Coins/Earn'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Report'</span>,</span><br><span class="line">    icon: <span class="string">'fund'</span>,</span><br><span class="line">    title: <span class="string">'Report Download'</span>,</span><br><span class="line">    path: <span class="string">'/report/download'</span>,</span><br><span class="line">    model: [<span class="string">'report'</span>],</span><br><span class="line">    component: <span class="string">'Report/Download'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Banner'</span>,</span><br><span class="line">    icon: <span class="string">'form'</span>,</span><br><span class="line">    title: <span class="string">'Banner List'</span>,</span><br><span class="line">    path: <span class="string">'/banner/list'</span>,</span><br><span class="line">    model: [<span class="string">'banner'</span>],</span><br><span class="line">    component: <span class="string">'Banner/List'</span>,</span><br><span class="line">    hideInMenu: (countryCodeID !== <span class="string">'id'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getRouterData = <span class="function">(<span class="params">menuData</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> routerList = []</span><br><span class="line">  <span class="keyword">const</span> getMenuRouter = <span class="function">(<span class="params">menuData</span>) =&gt;</span> &#123;</span><br><span class="line">    (menuData || []).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.title &amp;&amp; item.component &amp;&amp; !item.children) &#123;</span><br><span class="line">        routerList.push(&#123;</span><br><span class="line">          model: item.model,</span><br><span class="line">          path: item.path,</span><br><span class="line">          title: item.title,</span><br><span class="line">          component: item.component</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.children &amp;&amp; item.children.length) &#123;</span><br><span class="line">        getMenuRouter(item.children)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  getMenuRouter(menuData)</span><br><span class="line">  <span class="keyword">return</span> routerList</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routerData = getRouterData(menuData)</span><br></pre></td></tr></table></figure>
</li>
<li><p>BasicLayout</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; createElement &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Layout &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'dva'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route, Redirect, Switch &#125; <span class="keyword">from</span> <span class="string">'dva/router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ContainerQuery &#125; <span class="keyword">from</span> <span class="string">'react-container-query'</span></span><br><span class="line"><span class="keyword">import</span> &#123; routerData &#125; <span class="keyword">from</span> <span class="string">'@common/menu'</span></span><br><span class="line"><span class="keyword">import</span> &#123; setCountry &#125; <span class="keyword">from</span> <span class="string">'@utils/utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123; accountLogout &#125; <span class="keyword">from</span> <span class="string">'@services/api'</span></span><br><span class="line"><span class="keyword">import</span> &#123; layoutData &#125; <span class="keyword">from</span> <span class="string">'@common/default'</span></span><br><span class="line"><span class="keyword">import</span> DocumentTitle <span class="keyword">from</span> <span class="string">'react-document-title'</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">'classnames'</span></span><br><span class="line"><span class="keyword">import</span> GlobalHeader <span class="keyword">from</span> <span class="string">'@comp/GlobalHeader'</span></span><br><span class="line"><span class="keyword">import</span> SiderMenu <span class="keyword">from</span> <span class="string">'@comp/SiderMenu/index.js'</span></span><br><span class="line"><span class="keyword">import</span> NotFound <span class="keyword">from</span> <span class="string">'@pages/Exception/500'</span></span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'@assets/favicon.jpg'</span></span><br><span class="line"><span class="keyword">import</span> dynamic <span class="keyword">from</span> <span class="string">'dva/dynamic'</span></span><br><span class="line"><span class="keyword">const</span> &#123; Content, Header, Footer &#125; = Layout</span><br><span class="line"></span><br><span class="line"><span class="comment">// wrapper of dynamic</span></span><br><span class="line"><span class="keyword">const</span> dynamicWrapper = <span class="function">(<span class="params">app, models, component</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> dynamic(&#123;</span><br><span class="line">    app,</span><br><span class="line">    models: <span class="function"><span class="params">()</span> =&gt;</span> ((models &amp;&amp; models.map(<span class="function"><span class="params">m</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">`@models/<span class="subst">$&#123;m&#125;</span>.js`</span>))) || [<span class="keyword">import</span>(<span class="string">`@models/refund.js`</span>)]),</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> component().then(<span class="function"><span class="params">raw</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> Component = raw.default || raw</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">props</span> =&gt;</span></span><br><span class="line">          createElement(Component, &#123;</span><br><span class="line">            ...props</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicLayout</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">const</span> &#123; app &#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      collapsed: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.routerConfig = routerData.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> component = dynamicWrapper(app, item.model, () =&gt; <span class="keyword">import</span>(<span class="string">'@pages/'</span> + item.component))</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;Route</span><br><span class="line">          key=&#123;index&#125;</span><br><span class="line">          path=&#123;item.path&#125;</span><br><span class="line">          title=&#123;item.name&#125;</span><br><span class="line">          component=&#123;component&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleMenuCollapse = <span class="function"><span class="params">collapsed</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      collapsed: !<span class="keyword">this</span>.state.collapsed</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.props.dispatch(&#123;</span><br><span class="line">      type: <span class="string">'global/changeLayoutCollapsed'</span>,</span><br><span class="line">      payload: !collapsed</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleMenuClick = <span class="function">(<span class="params">&#123; key &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">'logout'</span>) &#123;</span><br><span class="line">      accountLogout().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.sessionStorage.setItem(<span class="string">'dp-admin-auth'</span>, <span class="literal">null</span>)</span><br><span class="line">        <span class="built_in">window</span>.location.reload()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  handleCountryClick = <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`selected <span class="subst">$&#123;key&#125;</span>`</span>)</span><br><span class="line">    setCountry(key)</span><br><span class="line">    <span class="built_in">window</span>.location = <span class="built_in">window</span>.location.origin + <span class="string">'/'</span> + key</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; collapsed &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> layout = (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;SiderMenu</span><br><span class="line">          collapsed=&#123;collapsed&#125;</span><br><span class="line">          isMobile=&#123;<span class="keyword">this</span>.state.isMobile&#125;</span><br><span class="line">          onCollapse=&#123;<span class="keyword">this</span>.handleMenuCollapse&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Layout&gt;</span><br><span class="line">          &#123; &lt;Header style=&#123;&#123; <span class="attr">padding</span>: <span class="number">0</span> &#125;&#125;&gt;</span><br><span class="line">            &lt;GlobalHeader</span><br><span class="line">              logo=&#123;logo&#125;</span><br><span class="line">              collapsed=&#123;collapsed&#125;</span><br><span class="line">              isMobile=&#123;<span class="keyword">this</span>.state.isMobile&#125;</span><br><span class="line">              onCountryClick=&#123;<span class="keyword">this</span>.handleCountryClick&#125;</span><br><span class="line">              onMenuClick=&#123;<span class="keyword">this</span>.handleMenuClick&#125;</span><br><span class="line">              onCollapse=&#123;<span class="keyword">this</span>.handleMenuCollapse&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Header&gt; &#125;</span></span><br><span class="line"><span class="regexp">          &lt;Content style=&#123;&#123; margin: '24px 24px 0', height: '100%' &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">              &#123; this.routerConfig &#125;</span></span><br><span class="line"><span class="regexp">              &lt;Redirect exact from='/</span><span class="string">' to='</span>order/list<span class="string">' /&gt;</span></span><br><span class="line"><span class="string">              &lt;Route render=&#123;NotFound&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">          &lt;/Content&gt;</span></span><br><span class="line"><span class="string">          &lt;Footer style=&#123;&#123; padding: 0 &#125;&#125; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">      &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    return (</span></span><br><span class="line"><span class="string">      &lt;DocumentTitle title=&#123;layoutData.docTitle&#125;&gt;</span></span><br><span class="line"><span class="string">        &lt;ContainerQuery query=&#123;layoutData.query&#125;&gt;</span></span><br><span class="line"><span class="string">          &#123;params =&gt; &lt;div className=&#123;classNames(params)&#125;&gt;&#123;layout&#125;&lt;/div&gt;&#125;</span></span><br><span class="line"><span class="string">        &lt;/ContainerQuery&gt;</span></span><br><span class="line"><span class="string">      &lt;/DocumentTitle&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default connect((&#123; login, global &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="string">  collapsed: global.collapsed</span></span><br><span class="line"><span class="string">&#125;))(BasicLayout)</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>删掉那些多的模块一直做减法，遇到报错就google大概就差不多了</p>
<h3 id="六、-要安装的基础包大概如下"><a href="#六、-要安装的基础包大概如下" class="headerlink" title="六、 要安装的基础包大概如下"></a>六、 要安装的基础包大概如下</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[wepack]     |   webpack-cli webpack webpack-merge</span><br><span class="line">[react]      |   react react-dom</span><br><span class="line">[babel]      |   babel-loader @babel/preset-core @babel/preset-env @babel/preset-core</span><br><span class="line">[html]       |   html-webpack-plugin clean-webpack-plugin</span><br><span class="line">[js]         |   uglifyjs-webpack-plugin </span><br><span class="line">[css]        |   style-loader css-loader  mini-css-extract-plugin less-loader sass-loader node-sass </span><br><span class="line">[css]        |   optimize-css-assets-webpack-plugin postcss postcss_loader autoprefixer</span><br><span class="line">[devserver]  |   webpack-dev-server</span><br><span class="line">[anlyzer]    |   webpack-bundle-analyzer</span><br><span class="line">[eslint]     |   husky standardjs</span><br><span class="line">[pretty]     |   ora chalk</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/22/banner轮播图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/22/banner轮播图/" class="post-title-link" itemprop="url">banner轮播图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-22 22:01:15" itemprop="dateCreated datePublished" datetime="2018-10-22T22:01:15+00:00">2018-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xxxxx/" itemprop="url" rel="index"><span itemprop="name">xxxxx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、banner-ui部分"><a href="#一、banner-ui部分" class="headerlink" title="一、banner ui部分"></a>一、banner ui部分</h3><ol>
<li><p>UI部分BannerItem和BannerDots banerItem.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;</span><br><span class="line">import classNames from &apos;classnames&apos;</span><br><span class="line">import style from &apos;./style.scss&apos;</span><br><span class="line"></span><br><span class="line">export const BannerItem = (&#123; count, item &#125;) =&gt; (</span><br><span class="line">  &lt;li className=&#123;style.bannerItem&#125; style=&#123;&#123; width: (100 / count + &apos;%&apos;) &#125;&#125;&gt;</span><br><span class="line">    &lt;a href=&#123;item.link || &apos;javascript:;&apos;&#125;&gt; &lt;img src=&#123;item.src&#125; alt=&#123;item.alt || &apos;&apos;&#125; /&gt;&lt;/a&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">)</span><br><span class="line">export class BannerDots extends Component &#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    const &#123; count, curIndex &#125; = this.props</span><br><span class="line">    let dotNodes = []</span><br><span class="line">    for (let i = 0; i &lt; count; i++) &#123;</span><br><span class="line">      dotNodes[i] = (</span><br><span class="line">        &lt;span</span><br><span class="line">          key=&#123;i&#125;</span><br><span class="line">          className=&#123;classNames(&#123;</span><br><span class="line">            [style.bannerDots]: true,</span><br><span class="line">            [style.bannerDotsSelected]: i + 1 === curIndex</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&#123;style.bannerDotsWrap&#125;&gt;</span><br><span class="line">        &#123;dotNodes&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>scss</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">*&#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">touch-action</span>: pan-y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">  .bannerItem &#123;</span><br><span class="line">    <span class="selector-tag">display</span>: <span class="selector-tag">inline-block</span>;</span><br><span class="line">    &amp;&gt;<span class="selector-tag">a</span>&gt;<span class="selector-tag">img</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: block;</span><br><span class="line">      <span class="attribute">height</span>: <span class="built_in">calc</span>(25vw);</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bannerDotsWrap</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  .bannerDots &#123;</span><br><span class="line">    <span class="selector-tag">display</span>: <span class="selector-tag">inline-block</span>;</span><br><span class="line">    <span class="selector-tag">width</span>: 6<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-tag">white</span>;</span><br><span class="line">    <span class="selector-tag">margin-right</span>: 6<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">cursor</span>: <span class="selector-tag">pointer</span>;</span><br><span class="line">    &amp;<span class="selector-class">.bannerDotsSelected</span> &#123;</span><br><span class="line">      <span class="attribute">margin-bottom</span>: -<span class="number">2px</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">4px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">4px</span>;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">1px</span>  solid white;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="二、banner-轮播部分逻辑"><a href="#二、banner-轮播部分逻辑" class="headerlink" title="二、banner 轮播部分逻辑"></a>二、banner 轮播部分逻辑</h3><ol>
<li>Banner.js<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;</span><br><span class="line">import &#123; BannerItem, BannerDots &#125; from &apos;./BannerItem&apos;</span><br><span class="line">import style from &apos;./style.scss&apos;</span><br><span class="line">export default class Banner extends Component &#123;</span><br><span class="line">  constructor (props) &#123;</span><br><span class="line">    super(props)</span><br><span class="line">    const &#123; sourceList, duration &#125; = this.props</span><br><span class="line">    const initTransit = &apos;all &apos; + duration + &apos;s ease &apos;</span><br><span class="line">    const sourceCount = sourceList.length</span><br><span class="line">    const itemList = [sourceList[sourceCount - 1]].concat(sourceList).concat([sourceList[0]])</span><br><span class="line">    const itemCount = itemList.length</span><br><span class="line"></span><br><span class="line">    this.state = &#123;</span><br><span class="line">      index: 1,</span><br><span class="line">      move: -100 / itemCount,</span><br><span class="line">      transition: initTransit,</span><br><span class="line">      itemList: itemList,</span><br><span class="line">      itemCount: itemCount,</span><br><span class="line">      sourceCount: sourceCount,</span><br><span class="line">      initTransit: initTransit</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.startPos = null</span><br><span class="line">    this.endPos = null</span><br><span class="line">    this.isScrolling = 0</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    this.autoPlay()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  turn = (step) =&gt; &#123;</span><br><span class="line">    const &#123; index, itemCount, sourceCount, initTransit &#125; = this.state</span><br><span class="line">    const &#123; duration &#125; = this.props</span><br><span class="line">    let curIndex = index + step</span><br><span class="line">    let move = -curIndex * 100 / itemCount</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      move: move,</span><br><span class="line">      transition: initTransit</span><br><span class="line">    &#125;)</span><br><span class="line">    if (curIndex &lt; 1 || curIndex &gt; sourceCount) &#123;</span><br><span class="line">      if (curIndex &lt; 1) &#123;</span><br><span class="line">        curIndex = curIndex + sourceCount</span><br><span class="line">      &#125; else if (curIndex &gt; sourceCount) &#123;</span><br><span class="line">        curIndex = curIndex - sourceCount</span><br><span class="line">      &#125;</span><br><span class="line">      move = -curIndex * 100 / itemCount</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        this.setState(&#123; move: move, transition: &apos;none&apos; &#125;)</span><br><span class="line">      &#125;, duration * 1000)</span><br><span class="line">    &#125;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      index: curIndex</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  autoPlay = () =&gt; &#123;</span><br><span class="line">    if (this.props.autoplay) &#123;</span><br><span class="line">      this.autoPlayFlag = setInterval(() =&gt; &#123;</span><br><span class="line">        this.turn(1)</span><br><span class="line">      &#125;, this.props.delay * 1000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  pausePlay = () =&gt; &#123;</span><br><span class="line">    clearInterval(this.autoPlayFlag)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onTouchStart = (event) =&gt; &#123;</span><br><span class="line">    this.pausePlay()</span><br><span class="line">    let touch = event.targetTouches[0]</span><br><span class="line">    this.startPos = &#123; x: touch.pageX, y: touch.pageY, time: +new Date() &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onTouchMove = (event) =&gt; &#123;</span><br><span class="line">    if (event.targetTouches.length &gt; 1 || (event.scale &amp;&amp; event.scale !== 1)) return</span><br><span class="line">    let touch = event.targetTouches[0]</span><br><span class="line">    this.endPos = &#123; x: touch.pageX - this.startPos.x, y: touch.pageY - this.startPos.y &#125;</span><br><span class="line">    this.isScrolling = Math.abs(this.endPos.x) &lt; Math.abs(this.endPos.y) ? 1 : 0</span><br><span class="line">    if (this.isScrolling === 0) &#123;</span><br><span class="line">      event.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onTouchEnd = (event) =&gt; &#123;</span><br><span class="line">    let duration = +new Date() - this.startPos.time</span><br><span class="line">    if (this.isScrolling === 0) &#123;</span><br><span class="line">      if (Number(duration) &gt; 10) &#123;</span><br><span class="line">        if (this.endPos &amp;&amp; this.endPos.x &gt; 10) &#123;</span><br><span class="line">          this.turn(-1)</span><br><span class="line">        &#125; else if (this.endPos &amp;&amp; this.endPos.x &lt; -10) &#123;</span><br><span class="line">          this.turn(1)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this.autoPlay()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    const &#123; sourceCount, itemCount, itemList, move, transition, index &#125; = this.state</span><br><span class="line">    const &#123; pause &#125; = this.props</span><br><span class="line">    const curStyle = &#123;</span><br><span class="line">      transform: &apos;translateX(&apos; + (move) + &apos;%)&apos;,</span><br><span class="line">      transition: transition,</span><br><span class="line">      width: itemCount * 100 + &apos;%&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    return sourceCount ? (</span><br><span class="line">      &lt;div</span><br><span class="line">        className=&#123;style.banner&#125;</span><br><span class="line">        onMouseOver=&#123;pause ? this.pausePlay : null&#125;</span><br><span class="line">        onMouseOut=&#123;pause ? this.autoPlay : null&#125;&gt;</span><br><span class="line">        &lt;ul style=&#123;curStyle&#125;</span><br><span class="line">          onTouchStart=&#123;this.onTouchStart&#125;</span><br><span class="line">          onTouchMove=&#123;this.onTouchMove&#125;</span><br><span class="line">          onTouchEnd=&#123;this.onTouchEnd&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123; itemList.map((item, idx) =&gt; &#123;</span><br><span class="line">            return (&lt;BannerItem</span><br><span class="line">              item=&#123;item&#125;</span><br><span class="line">              count=&#123;itemCount&#125;</span><br><span class="line">              key=&#123;&apos;item&apos; + idx&#125; /&gt;)</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &#123;&lt;BannerDots count=&#123;sourceCount&#125; curIndex=&#123;index&#125; /&gt;&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    ) : null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Banner.defaultProps = &#123;</span><br><span class="line">  duration: 1,</span><br><span class="line">  delay: 3,</span><br><span class="line">  pause: false,</span><br><span class="line">  autoplay: true,</span><br><span class="line">  dots: true,</span><br><span class="line">  sourceList: []</span><br><span class="line">&#125;</span><br><span class="line">Banner.autoPlayFlag = null</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="三、banner-数据请求逻辑部分"><a href="#三、banner-数据请求逻辑部分" class="headerlink" title="三、banner 数据请求逻辑部分"></a>三、banner 数据请求逻辑部分</h3><ol>
<li>index.js<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;</span><br><span class="line">import &#123; bannerApi &#125; from &apos;@api/index.js&apos;</span><br><span class="line">import Banner from &apos;./Banner.js&apos;</span><br><span class="line"></span><br><span class="line">class ShowBanner extends Component &#123;</span><br><span class="line">  constructor (props) &#123;</span><br><span class="line">    super(props)</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      itemList: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    bannerApi.fetchBannerInfo(&#123; query: &#123;&#125; &#125;).then((data) =&gt; &#123;</span><br><span class="line">      if (data &amp;&amp; data.data[0] &amp;&amp; data.data[0].imgInfo) &#123;</span><br><span class="line">        const itemList = data.data[0].imgInfo.map((item) =&gt; &#123;</span><br><span class="line">          return &#123;</span><br><span class="line">            src: item.location,</span><br><span class="line">            link: item.url,</span><br><span class="line">            alt: &apos;images&apos; + item.ordinal</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">          itemList: itemList</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    const &#123; itemList &#125; = this.state</span><br><span class="line">    return itemList.length ? (</span><br><span class="line">      &lt;Banner</span><br><span class="line">        sourceList=&#123;itemList&#125;</span><br><span class="line">        duration=&#123;2&#125;</span><br><span class="line">        delay=&#123;3&#125;</span><br><span class="line">        autoplay</span><br><span class="line">        dots</span><br><span class="line">      /&gt;</span><br><span class="line">    ) : null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default ShowBanner</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="四、调用demo"><a href="#四、调用demo" class="headerlink" title="四、调用demo"></a>四、调用demo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;</span><br><span class="line">import ReactDom from &apos;react-dom&apos;</span><br><span class="line">import style from &apos;./index.scss&apos;</span><br><span class="line">import ShowBanner from &apos;@comp/Banner/index.js&apos;</span><br><span class="line"></span><br><span class="line">ReactDom.render(</span><br><span class="line">  (&lt;div&gt;</span><br><span class="line">    &lt;h1 className=&#123;style.main&#125;&gt;Banner Componets&lt;/h1&gt;</span><br><span class="line">    &lt;ShowBanner /&gt;</span><br><span class="line">  &lt;/div&gt;),</span><br><span class="line">  document.getElementById(&apos;root&apos;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/22/express和mockjs搭建mock服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/22/express和mockjs搭建mock服务/" class="post-title-link" itemprop="url">express和mockjs搭建mock服务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-22 20:54:49" itemprop="dateCreated datePublished" datetime="2018-10-22T20:54:49+00:00">2018-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index"><span itemprop="name">react</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、express起一个本地服务"><a href="#一、express起一个本地服务" class="headerlink" title="一、express起一个本地服务"></a>一、express起一个本地服务</h3><ol>
<li><p><a href="http://www.expressjs.com.cn/guide/using-middleware.html" target="_blank" rel="noopener">express</a> 设置中间件起一个server端服务 mockjs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"><span class="keyword">const</span> banner = <span class="built_in">require</span>(<span class="string">'./routes/banner'</span>)</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">''</span>, banner)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3001</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'app listening'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>mock具体数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> Mock = <span class="built_in">require</span>(<span class="string">'mockjs'</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/display_plan'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> ret = &#123;</span><br><span class="line">    data: [&#123;</span><br><span class="line">      imgInfo: []</span><br><span class="line">    &#125;],</span><br><span class="line">    err_code: <span class="number">0</span>,</span><br><span class="line">    err_msg: <span class="string">'success'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">4</span>; index++) &#123; <span class="comment">// eslint-disable-line</span></span><br><span class="line">    <span class="keyword">var</span> data = Mock.mock(&#123;</span><br><span class="line">      name: Mock.Random.name(),</span><br><span class="line">      url: Mock.Random.url(),</span><br><span class="line">      location: Mock.Random.image(),</span><br><span class="line">      ordinal: index + <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    ret.data[<span class="number">0</span>].imgInfo.push(data)</span><br><span class="line">  &#125;</span><br><span class="line">  res.json(ret)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>
</li>
<li><p>package.json里面添加</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "mock": "node index.js"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>npm run mock 访问 <a href="http://localhost:3001/digital-product/api/banner/display_plan正常，则服务端的代码写的没问题" target="_blank" rel="noopener">http://localhost:3001/digital-product/api/banner/display_plan正常，则服务端的代码写的没问题</a></p>
</li>
</ol>
<h3 id="二、-webpack-devServer设置proxy解决跨域"><a href="#二、-webpack-devServer设置proxy解决跨域" class="headerlink" title="二、 webpack devServer设置proxy解决跨域"></a>二、 webpack devServer设置proxy解决跨域</h3><ol>
<li>设置devServer<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  proxy: &#123;</span><br><span class="line">    <span class="string">'/digital-product/api'</span>: <span class="string">'http://localhost:3001'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这样localhost:8080访问接口/digital-product/api/banner/display_plan时候，会被devServer转发到3001端口，访问到了我们的mock server，这里并不存在浏览器的跨域问题，正常拿到我们mock的数据。</p>
<ol start="2">
<li>如果cgi你的访问的路径不是localhost，记得页面相应的url设置成和cgi一样的域名，再配置host即可</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/18/csv问题记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/18/csv问题记录/" class="post-title-link" itemprop="url">csv问题记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-18 16:31:07" itemprop="dateCreated datePublished" datetime="2018-10-18T16:31:07+00:00">2018-10-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h3><ol>
<li><p>遇到逗号分列，用””号把字段包起来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> item) &#123;</span><br><span class="line">    item[key] = <span class="string">'"'</span> + item[key] + <span class="string">'"'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>长数字自动变成科学计数法，在字段末尾加上\t，强制分割列</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> item) &#123;</span><br><span class="line">    item[key] = item[key] + <span class="string">'\t'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>所以后台的所有字段最好都统一做一次处理<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> item) &#123;</span><br><span class="line">    item[key] = <span class="string">'"'</span> + item[key] + <span class="string">'\t"'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li><p>编辑再保存csv，多列自动变成了一列，挤到一行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csv编辑之后在保存，需要选择保存格式。【选中第一列，点击菜单栏–数据–分列–分隔符号】</span><br></pre></td></tr></table></figure>
</li>
<li><p>upload的时候记得设置文件格式(xxxx).csv</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">weiqian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">weiqian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
