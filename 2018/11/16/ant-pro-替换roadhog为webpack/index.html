<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="前言admin项目最初时间紧迫，再确定了使用react技术栈后，选择了快速产出的antd及开箱即用的框架antd-pro。当初框架用的有多爽，后来就有多哭～ 9月底决定干掉框架，造一些自己的轮子，为了不影响线上业务，分为3个步骤做：1.替换打包roadhog为webpack 2.替换dva框架为开源的react技术栈 3.替换antd的UI本篇主要记录替换roadhog的步骤。 一、替">
<meta name="keywords" content="admin,webpack,roadhog">
<meta property="og:type" content="article">
<meta property="og:title" content="ant-pro 替换roadhog为webpack">
<meta property="og:url" content="http://yoursite.com/2018/11/16/ant-pro-替换roadhog为webpack/index.html">
<meta property="og:site_name" content="There is no magic">
<meta property="og:description" content="前言admin项目最初时间紧迫，再确定了使用react技术栈后，选择了快速产出的antd及开箱即用的框架antd-pro。当初框架用的有多爽，后来就有多哭～ 9月底决定干掉框架，造一些自己的轮子，为了不影响线上业务，分为3个步骤做：1.替换打包roadhog为webpack 2.替换dva框架为开源的react技术栈 3.替换antd的UI本篇主要记录替换roadhog的步骤。 一、替">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2021-05-09T20:26:28.396Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ant-pro 替换roadhog为webpack">
<meta name="twitter:description" content="前言admin项目最初时间紧迫，再确定了使用react技术栈后，选择了快速产出的antd及开箱即用的框架antd-pro。当初框架用的有多爽，后来就有多哭～ 9月底决定干掉框架，造一些自己的轮子，为了不影响线上业务，分为3个步骤做：1.替换打包roadhog为webpack 2.替换dva框架为开源的react技术栈 3.替换antd的UI本篇主要记录替换roadhog的步骤。 一、替">

<link rel="canonical" href="http://yoursite.com/2018/11/16/ant-pro-替换roadhog为webpack/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'default'
  };
</script>

  <title>ant-pro 替换roadhog为webpack | There is no magic</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">There is no magic</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/16/ant-pro-替换roadhog为webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="weiqian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="There is no magic">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ant-pro 替换roadhog为webpack
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-16 12:29:22" itemprop="dateCreated datePublished" datetime="2018-11-16T12:29:22+00:00">2018-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-09 20:26:28" itemprop="dateModified" datetime="2021-05-09T20:26:28+00:00">2021-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/xxxxx/" itemprop="url" rel="index"><span itemprop="name">xxxxx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>admin项目最初时间紧迫，再确定了使用react技术栈后，选择了快速产出的antd及开箱即用的框架antd-pro。当初框架用的有多爽，后来就有多哭～</p>
<p>9月底决定干掉框架，造一些自己的轮子，为了不影响线上业务，分为3个步骤做：1.替换打包roadhog为webpack 2.替换dva框架为开源的react技术栈 3.替换antd的UI<br>本篇主要记录替换roadhog的步骤。</p>
<h3 id="一、替换步骤概览（what）"><a href="#一、替换步骤概览（what）" class="headerlink" title="一、替换步骤概览（what）"></a>一、替换步骤概览（what）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 新建webpack的配置 config/webpack.base.conf.js|webpack.dev.conf.js|webpack.prod.conf.js</span><br><span class="line"><span class="number">2.</span> 删除webpackrc.js、paths.js，删除package.json里面的roadhog相关包和命令</span><br><span class="line"><span class="number">3.</span> 新增package.json里webpack的依赖包及相关命令、配置babelrc等</span><br><span class="line"><span class="number">4.</span> 删除原来移动文件操作的build.js，改成新的build.js，做终端的编译美化工作。</span><br><span class="line"><span class="number">5.</span> 删掉之前的router模块，改造为react-router4的做法，把menu和路由配置在一起</span><br><span class="line"><span class="number">6.</span> 精简之前的layout|pageheader|golbalheader等</span><br><span class="line"><span class="number">7.</span> 删除所有关于登录权限的模块，我们的权限是后台控制的相当于前端不做权限模块。</span><br></pre></td></tr></table></figure>
<h3 id="二、为什么要做替换呢-why"><a href="#二、为什么要做替换呢-why" class="headerlink" title="二、为什么要做替换呢(why)"></a>二、为什么要做替换呢(why)</h3><p>当初选择的理由只有一个，是框架里自带的，适合快速产出，替换的理由却有很多<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> roadhog jenkins build经常失败，原因未知，解决办法，换个版本号呵呵</span><br><span class="line"><span class="number">2.</span> roadhog 阉割了的webpack，一些自定义的功能接口不能使用，不太方便</span><br><span class="line"><span class="number">3.</span> roadhog 相当于又学了一个不通用的轮子，开源的东西可能更好一些</span><br><span class="line"><span class="number">4.</span> 我们想做自己的脚手架，从打包到ui最终都尽量用自己的东西，更好掌控一些</span><br></pre></td></tr></table></figure></p>
<h3 id="三、首次迁移的遗留问题"><a href="#三、首次迁移的遗留问题" class="headerlink" title="三、首次迁移的遗留问题"></a>三、首次迁移的遗留问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 打包过大，按需加载，优化</span><br><span class="line"><span class="number">2.</span> 其他的更酷的配置，我们目前只用了webpack一些最常见的配置</span><br><span class="line"><span class="number">3.</span> 有一些有问题的配置，例如引不进react，强行插入了，先运行起来</span><br><span class="line"><span class="number">4.</span> 在layout和router menu中需要做的细节工作很多</span><br></pre></td></tr></table></figure>
<p>后面回持续跟进解决这些问题</p>
<h3 id="四、打包工具替换具体细节"><a href="#四、打包工具替换具体细节" class="headerlink" title="四、打包工具替换具体细节"></a>四、打包工具替换具体细节</h3><ol>
<li>webpack相关配置<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.base.conf.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> SRC_PATH = path.resolve(__dirname, <span class="string">'../src'</span>)</span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    src: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../build/windrunner'</span>),</span><br><span class="line">    filename: <span class="string">'js/bundle.js'</span>,</span><br><span class="line">    publicPath: <span class="string">'/'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'@src'</span>: SRC_PATH,</span><br><span class="line">      <span class="string">'@assets'</span>: path.resolve(SRC_PATH, <span class="string">'assets'</span>),</span><br><span class="line">      <span class="string">'@comp'</span>: path.resolve(SRC_PATH, <span class="string">'components'</span>),</span><br><span class="line">      <span class="string">'@common'</span>: path.resolve(SRC_PATH, <span class="string">'common'</span>),</span><br><span class="line">      <span class="string">'@models'</span>: path.resolve(SRC_PATH, <span class="string">'models'</span>),</span><br><span class="line">      <span class="string">'@api'</span>: path.resolve(SRC_PATH, <span class="string">'apis'</span>),</span><br><span class="line">      <span class="string">'@helper'</span>: path.resolve(SRC_PATH, <span class="string">'helpers'</span>),</span><br><span class="line">      <span class="string">'@pages'</span>: path.resolve(SRC_PATH, <span class="string">'pages'</span>),</span><br><span class="line">      <span class="string">'@const'</span>: path.resolve(SRC_PATH, <span class="string">'constants'</span>),</span><br><span class="line">      <span class="string">'@utils'</span>: path.resolve(SRC_PATH, <span class="string">'utils'</span>),</span><br><span class="line">      <span class="string">'@selector'</span>: path.resolve(SRC_PATH, <span class="string">'selectors'</span>),</span><br><span class="line">      <span class="string">'@services'</span>: path.resolve(SRC_PATH, <span class="string">'services'</span>),</span><br><span class="line">      <span class="string">'@layouts'</span>: path.resolve(SRC_PATH, <span class="string">'layouts'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        loader: <span class="string">'babel-loader?cacheDirectory'</span>,</span><br><span class="line">        include: SRC_PATH</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.ANALYZE) &#123;</span><br><span class="line">  <span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin</span><br><span class="line">  config.plugins = config.plugins || []</span><br><span class="line">  config.plugins.push(<span class="keyword">new</span> BundleAnalyzerPlugin())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>webpack.dev.conf.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf.js'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseWebpackConfig, &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  devtool: <span class="string">'cheap-module-source-map'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'js/[name].[hash:16].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;<span class="comment">// CSS处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        loader: <span class="string">'style-loader!css-loader?modules'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;<span class="comment">// antd样式处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/src/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">'style-loader'</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              importLoaders: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(less)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'less-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              javascriptEnabled: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(scss)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'sass-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          loader: <span class="string">'url-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            limit: <span class="number">8192</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'react-svg-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'public/index.html'</span>,</span><br><span class="line">      inject: <span class="string">'body'</span>,</span><br><span class="line">      chunksSortMode: <span class="string">'none'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      <span class="string">'React'</span>: <span class="string">'react'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">80</span>,</span><br><span class="line">    host: <span class="string">'local.dp-admin.test.xxxxx.io'</span>,</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: <span class="string">'http://localhost:3001'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.conf.js</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.conf.js'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> UglifyJSWebpackPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = merge(baseWebpackConfig, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'static/js/[name].[chunkhash:16].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;<span class="comment">// CSS处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        loader: <span class="string">'style-loader!css-loader?modules'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;<span class="comment">// antd样式处理</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/src/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">'style-loader'</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              importLoaders: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.(less)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'less-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              javascriptEnabled: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.(scss)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              localIdentName: <span class="string">'[local]__[hash:7]'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'postcss-loader'</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            loader: <span class="string">'sass-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          loader: <span class="string">'url-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            limit: <span class="number">8192</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.svg$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'react-svg-loader'</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">'public/index.html'</span>,</span><br><span class="line">      inject: <span class="string">'body'</span>,</span><br><span class="line">      chunksSortMode: <span class="string">'none'</span>,</span><br><span class="line">      minify: &#123;</span><br><span class="line">        minimize: <span class="literal">true</span>,</span><br><span class="line">        removeComments: <span class="literal">true</span>,</span><br><span class="line">        collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">        removeAttributeQuotes: <span class="literal">true</span>,</span><br><span class="line">        minifyCSS: <span class="literal">true</span>,</span><br><span class="line">        minifyJS: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      <span class="string">'React'</span>: <span class="string">'react'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'static/css/[name].[hash].css'</span>,</span><br><span class="line">      chunkFilename: <span class="string">'static/css/[id].[hash].css'</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'../build'</span>], &#123; <span class="attr">allowExternal</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  ],</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="keyword">new</span> UglifyJSWebpackPlugin(&#123;</span><br><span class="line">        uglifyOptions: &#123;</span><br><span class="line">          ecma: <span class="number">8</span>,</span><br><span class="line">          compress: &#123;</span><br><span class="line">            warnings: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;</span><br><span class="line">        cssProcessorOptions: <span class="literal">true</span> <span class="comment">// eslint-disable-line</span></span><br><span class="line">          ? &#123;</span><br><span class="line">            map: &#123; <span class="attr">inline</span>: <span class="literal">false</span> &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          : &#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: <span class="string">'initial'</span>, <span class="comment">// 代码块类型 必须三选一： "initial"（初始化） | "all"(默认就是all) | "async"（动态加载）</span></span><br><span class="line">      minSize: <span class="number">0</span>, <span class="comment">// 最小尺寸，默认0</span></span><br><span class="line">      minChunks: <span class="number">1</span>, <span class="comment">// 最小 chunk ，默认1</span></span><br><span class="line">      maxAsyncRequests: <span class="number">1</span>, <span class="comment">// 最大异步请求数， 默认1</span></span><br><span class="line">      maxInitialRequests: <span class="number">1</span>, <span class="comment">// 最大初始化请求书，默认1</span></span><br><span class="line">      name: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, <span class="comment">// 名称，此选项课接收 function</span></span><br><span class="line">      cacheGroups: &#123; <span class="comment">// 缓存组会继承splitChunks的配置，但是test、priorty和reuseExistingChunk只能用于配置缓存组。</span></span><br><span class="line">        priority: <span class="string">'0'</span>, <span class="comment">// 缓存组优先级 false | object |</span></span><br><span class="line">        vendor: &#123; <span class="comment">// key 为entry中定义的 入口名称</span></span><br><span class="line">          chunks: <span class="string">'initial'</span>, <span class="comment">// 必须三选一： "initial"(初始化) | "all" | "async"(默认就是异步)</span></span><br><span class="line">          test: <span class="regexp">/react|antd|dva|dva-loading/</span>, <span class="comment">// 正则规则验证，如果符合就提取 chunk</span></span><br><span class="line">          name: <span class="string">'vendor'</span>, <span class="comment">// 要缓存的 分隔出来的 chunk 名称</span></span><br><span class="line">          minSize: <span class="number">0</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">          enforce: <span class="literal">true</span>,</span><br><span class="line">          reuseExistingChunk: <span class="literal">true</span> <span class="comment">// 可设置是否重用已用chunk 不再创建新的chunk</span></span><br><span class="line">        &#125;,</span><br><span class="line">        common: &#123; <span class="comment">// key 为entry中定义的 入口名称</span></span><br><span class="line">          chunks: <span class="string">'initial'</span>, <span class="comment">// 必须三选一： "initial"(初始化) | "all" | "async"(默认就是异步)</span></span><br><span class="line">          test: <span class="regexp">/moment/</span>, <span class="comment">// 正则规则验证，如果符合就提取 chunk</span></span><br><span class="line">          name: <span class="string">'common'</span>, <span class="comment">// 要缓存的 分隔出来的 chunk 名称</span></span><br><span class="line">          minSize: <span class="number">0</span>,</span><br><span class="line">          minChunks: <span class="number">1</span>,</span><br><span class="line">          enforce: <span class="literal">true</span>,</span><br><span class="line">          reuseExistingChunk: <span class="literal">true</span> <span class="comment">// 可设置是否重用已用chunk 不再创建新的chunk</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>package.json 删除原有的roadhog部分script，替换成新的webpack的相关命令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"debug"</span>: <span class="string">"webpack-dev-server --config config/webpack.dev.conf.js"</span>,</span><br><span class="line">    <span class="string">"analysis"</span>: <span class="string">"ANALYZE=true node scripts/build.js"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"node scripts/build.js"</span>,</span><br><span class="line">    <span class="string">"proxy"</span>: <span class="string">"node data/proxy.js"</span>,</span><br><span class="line">    <span class="string">"mock"</span>: <span class="string">"node data/mock.js"</span>,</span><br><span class="line">    <span class="string">"standard"</span>: <span class="string">"standard"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">      <span class="string">"@babel/core"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-class-properties"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-decorators"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-object-rest-spread"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-syntax-dynamic-import"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-transform-runtime"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"@babel/polyfill"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/preset-env"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"@babel/preset-react"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="string">"@babel/runtime"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"@babel/runtime-corejs2"</span>: <span class="string">"^7.1.2"</span>,</span><br><span class="line">    <span class="string">"autoprefixer"</span>: <span class="string">"^9.2.1"</span>,</span><br><span class="line">    <span class="string">"babel-eslint"</span>: <span class="string">"^10.0.1"</span>,</span><br><span class="line">    <span class="string">"babel-loader"</span>: <span class="string">"^8.0.4"</span>,</span><br><span class="line">       <span class="string">"babel-plugin-syntax-dynamic-import"</span>: <span class="string">"^6.18.0"</span>,</span><br><span class="line">    <span class="string">"chalk"</span>: <span class="string">"^2.4.1"</span>,</span><br><span class="line">    <span class="string">"clean-webpack-plugin"</span>: <span class="string">"^0.1.19"</span>,</span><br><span class="line">    <span class="string">"compression-webpack-plugin"</span>: <span class="string">"^2.0.0"</span>,</span><br><span class="line">    <span class="string">"cross-env"</span>: <span class="string">"^5.2.0"</span>,</span><br><span class="line">    <span class="string">"css-loader"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="string">"enzyme"</span>: <span class="string">"^3.1.0"</span>,</span><br><span class="line">    <span class="string">"express"</span>: <span class="string">"^4.16.4"</span>,</span><br><span class="line">    <span class="string">"gh-pages"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="string">"html-webpack-plugin"</span>: <span class="string">"^3.2.0"</span>,</span><br><span class="line">    <span class="string">"husky"</span>: <span class="string">"^1.1.2"</span>,</span><br><span class="line">    <span class="string">"less"</span>: <span class="string">"^3.8.1"</span>,</span><br><span class="line">    <span class="string">"less-loader"</span>: <span class="string">"^4.1.0"</span>,</span><br><span class="line">    <span class="string">"lint-staged"</span>: <span class="string">"^6.0.0"</span>,</span><br><span class="line">    <span class="string">"meepojs-loader"</span>: <span class="string">"0.0.5"</span>,</span><br><span class="line">    <span class="string">"mini-css-extract-plugin"</span>: <span class="string">"^0.4.4"</span>,</span><br><span class="line">    <span class="string">"mockjs"</span>: <span class="string">"^1.0.1-beta3"</span>,</span><br><span class="line">    <span class="string">"node-sass"</span>: <span class="string">"^4.9.4"</span>,</span><br><span class="line">    <span class="string">"optimize-css-assets-webpack-plugin"</span>: <span class="string">"^5.0.1"</span>,</span><br><span class="line">    <span class="string">"ora"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">    <span class="string">"postcss"</span>: <span class="string">"^7.0.5"</span>,</span><br><span class="line">    <span class="string">"postcss-loader"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">    <span class="string">"prettier"</span>: <span class="string">"1.11.1"</span>,</span><br><span class="line">    <span class="string">"react-svg-loader"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">    <span class="string">"redbox-react"</span>: <span class="string">"^1.5.0"</span>,</span><br><span class="line">    <span class="string">"regenerator-runtime"</span>: <span class="string">"^0.11.1"</span>,</span><br><span class="line">    <span class="string">"request"</span>: <span class="string">"^2.88.0"</span>,</span><br><span class="line">    <span class="string">"sass-loader"</span>: <span class="string">"^7.1.0"</span>,</span><br><span class="line">    <span class="string">"standard"</span>: <span class="string">"^12.0.1"</span>,</span><br><span class="line">    <span class="string">"style-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">    <span class="string">"uglifyjs-webpack-plugin"</span>: <span class="string">"^1.1.6"</span>,</span><br><span class="line">    <span class="string">"url-loader"</span>: <span class="string">"^1.1.2"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^4.23.1"</span>,</span><br><span class="line">    <span class="string">"webpack-bundle-analyzer"</span>: <span class="string">"^3.0.3"</span>,</span><br><span class="line">    <span class="string">"webpack-cli"</span>: <span class="string">"^3.1.2"</span>,</span><br><span class="line">    <span class="string">"webpack-dev-server"</span>: <span class="string">"^3.1.10"</span>,</span><br><span class="line">    <span class="string">"webpack-merge"</span>: <span class="string">"^4.1.4"</span>  </span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>babelrc.js   postcss.config.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets:[</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"shippedProposals"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"forceAllTransforms"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"browsers"</span>: [</span><br><span class="line">            <span class="string">"&gt; 1%"</span>,</span><br><span class="line">            <span class="string">"last 5 versions"</span>,</span><br><span class="line">            <span class="string">"ie &gt;= 8"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"@babel/preset-react"</span></span><br><span class="line">  ],</span><br><span class="line">  plugins: [</span><br><span class="line">    [<span class="string">"import"</span>, &#123;</span><br><span class="line">      <span class="string">"libraryName"</span>: <span class="string">"antd"</span>,</span><br><span class="line">      <span class="string">"libraryDirectory"</span>: <span class="string">"es"</span>,</span><br><span class="line">      <span class="string">"style"</span>: <span class="string">"css"</span> </span><br><span class="line">    &#125;], <span class="comment">// `style: true` 会加载 less 文件</span></span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/plugin-transform-runtime"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"@babel/transform-arrow-functions"</span>,</span><br><span class="line">    [<span class="string">"@babel/plugin-proposal-decorators"</span>, &#123; <span class="string">"legacy"</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">    [<span class="string">"@babel/plugin-proposal-class-properties"</span>, &#123; <span class="string">"loose"</span> : <span class="literal">true</span> &#125;],</span><br><span class="line">    <span class="string">"@babel/plugin-proposal-object-rest-spread"</span>,</span><br><span class="line">    <span class="string">"@babel/plugin-syntax-dynamic-import"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>postcss.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">  plugins: &#123;</span><br><span class="line">    autoprefixer: &#123; <span class="attr">browsers</span>: [<span class="string">'last 5 version'</span>, <span class="string">'&gt;1%'</span>, <span class="string">'ie &gt;= 8'</span>] &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>build脚本美化终端展示<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">'ora'</span>)</span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> webpackConfig = <span class="built_in">require</span>(<span class="string">'../config/webpack.prod.conf'</span>)</span><br><span class="line"><span class="keyword">const</span> spinner = ora(<span class="string">'编译中...\n'</span>).start()</span><br><span class="line">webpack(webpackConfig, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    spinner.fail(<span class="string">'编译失败'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  spinner.succeed(<span class="string">'编译已结束. \n'</span>)</span><br><span class="line"></span><br><span class="line">  process.stdout.write(stats.toString(&#123;</span><br><span class="line">    colors: <span class="literal">true</span>,</span><br><span class="line">    modules: <span class="literal">false</span>,</span><br><span class="line">    children: <span class="literal">false</span>,</span><br><span class="line">    chunks: <span class="literal">false</span>,</span><br><span class="line">    chunkModules: <span class="literal">false</span></span><br><span class="line">  &#125;) + <span class="string">'\n\n'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(chalk.cyan(<span class="string">'  编译成功！\n'</span>))</span><br><span class="line">  <span class="built_in">console</span>.log(chalk.yellow(</span><br><span class="line">    <span class="string">'  提示: 编译后的文件可以上传并且部署到服务器\n'</span> +</span><br><span class="line">        <span class="string">'  通过file:// 打开index.html不会起作用.\n'</span></span><br><span class="line">  ))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="五、路由相关地方替换细节"><a href="#五、路由相关地方替换细节" class="headerlink" title="五、路由相关地方替换细节"></a>五、路由相关地方替换细节</h3><ol>
<li><p>删除原有router配置，将menu和router的配置合并在一起</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; countryCodeID &#125; <span class="keyword">from</span> <span class="string">'@const/index'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> menuData = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Order'</span>,</span><br><span class="line">    icon: <span class="string">'book'</span>,</span><br><span class="line">    title: <span class="string">'Order List'</span>,</span><br><span class="line">    path: <span class="string">'/order/list'</span>,</span><br><span class="line">    model: [<span class="string">'order'</span>],</span><br><span class="line">    component: <span class="string">'Order/List'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Refund'</span>,</span><br><span class="line">    icon: <span class="string">'book'</span>,</span><br><span class="line">    path: <span class="string">'/refund/list'</span>,</span><br><span class="line">    title: <span class="string">'Refund List'</span>,</span><br><span class="line">    model: [<span class="string">'refund'</span>],</span><br><span class="line">    component: <span class="string">'Refund/List'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Order'</span>,</span><br><span class="line">    icon: <span class="string">'profile'</span>,</span><br><span class="line">    title: <span class="string">'Order Detail'</span>,</span><br><span class="line">    path: <span class="string">'/order/detail/:id'</span>,</span><br><span class="line">    model: [<span class="string">'order'</span>],</span><br><span class="line">    component: <span class="string">'Order/Detail'</span>,</span><br><span class="line">    hideInMenu: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Refund'</span>,</span><br><span class="line">    icon: <span class="string">'profile'</span>,</span><br><span class="line">    title: <span class="string">'Refund Detail'</span>,</span><br><span class="line">    path: <span class="string">'/refund/detail/:id'</span>,</span><br><span class="line">    model: [<span class="string">'refund'</span>, <span class="string">'order'</span>],</span><br><span class="line">    component: <span class="string">'Refund/Detail'</span>,</span><br><span class="line">    hideInMenu: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Product'</span>,</span><br><span class="line">    icon: <span class="string">'schedule'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Product List'</span>,</span><br><span class="line">        path: <span class="string">'/product/list'</span>,</span><br><span class="line">        title: <span class="string">'Product List'</span>,</span><br><span class="line">        model: [<span class="string">'product'</span>],</span><br><span class="line">        component: <span class="string">'Product/List'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Product MassEdit'</span>,</span><br><span class="line">        path: <span class="string">'/product/massedit'</span>,</span><br><span class="line">        title: <span class="string">'Product MassEdit'</span>,</span><br><span class="line">        model: [<span class="string">'product'</span>],</span><br><span class="line">        component: <span class="string">'Product/MassEdit'</span></span><br><span class="line">      &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Product'</span>,</span><br><span class="line">    icon: <span class="string">'profile'</span>,</span><br><span class="line">    title: <span class="string">'Product Detail'</span>,</span><br><span class="line">    path: <span class="string">'/product/detail/:id'</span>,</span><br><span class="line">    model: [<span class="string">'product'</span>],</span><br><span class="line">    component: <span class="string">'Product/Detail'</span>,</span><br><span class="line">    hideInMenu: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Coins'</span>,</span><br><span class="line">    icon: <span class="string">'form'</span>,</span><br><span class="line">    path: <span class="string">'coins'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Coins Spend'</span>,</span><br><span class="line">        path: <span class="string">'/coins/spend'</span>,</span><br><span class="line">        title: <span class="string">'Coins Spend'</span>,</span><br><span class="line">        model: [<span class="string">'coins'</span>],</span><br><span class="line">        component: <span class="string">'Coins/Spend'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'Coins Earn'</span>,</span><br><span class="line">        path: <span class="string">'/coins/earn'</span>,</span><br><span class="line">        title: <span class="string">'Coins Earn'</span>,</span><br><span class="line">        model: [<span class="string">'coins'</span>],</span><br><span class="line">        component: <span class="string">'Coins/Earn'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Report'</span>,</span><br><span class="line">    icon: <span class="string">'fund'</span>,</span><br><span class="line">    title: <span class="string">'Report Download'</span>,</span><br><span class="line">    path: <span class="string">'/report/download'</span>,</span><br><span class="line">    model: [<span class="string">'report'</span>],</span><br><span class="line">    component: <span class="string">'Report/Download'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Banner'</span>,</span><br><span class="line">    icon: <span class="string">'form'</span>,</span><br><span class="line">    title: <span class="string">'Banner List'</span>,</span><br><span class="line">    path: <span class="string">'/banner/list'</span>,</span><br><span class="line">    model: [<span class="string">'banner'</span>],</span><br><span class="line">    component: <span class="string">'Banner/List'</span>,</span><br><span class="line">    hideInMenu: (countryCodeID !== <span class="string">'id'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getRouterData = <span class="function">(<span class="params">menuData</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> routerList = []</span><br><span class="line">  <span class="keyword">const</span> getMenuRouter = <span class="function">(<span class="params">menuData</span>) =&gt;</span> &#123;</span><br><span class="line">    (menuData || []).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.title &amp;&amp; item.component &amp;&amp; !item.children) &#123;</span><br><span class="line">        routerList.push(&#123;</span><br><span class="line">          model: item.model,</span><br><span class="line">          path: item.path,</span><br><span class="line">          title: item.title,</span><br><span class="line">          component: item.component</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.children &amp;&amp; item.children.length) &#123;</span><br><span class="line">        getMenuRouter(item.children)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  getMenuRouter(menuData)</span><br><span class="line">  <span class="keyword">return</span> routerList</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routerData = getRouterData(menuData)</span><br></pre></td></tr></table></figure>
</li>
<li><p>BasicLayout</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; createElement &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Layout &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'dva'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route, Redirect, Switch &#125; <span class="keyword">from</span> <span class="string">'dva/router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ContainerQuery &#125; <span class="keyword">from</span> <span class="string">'react-container-query'</span></span><br><span class="line"><span class="keyword">import</span> &#123; routerData &#125; <span class="keyword">from</span> <span class="string">'@common/menu'</span></span><br><span class="line"><span class="keyword">import</span> &#123; setCountry &#125; <span class="keyword">from</span> <span class="string">'@utils/utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123; accountLogout &#125; <span class="keyword">from</span> <span class="string">'@services/api'</span></span><br><span class="line"><span class="keyword">import</span> &#123; layoutData &#125; <span class="keyword">from</span> <span class="string">'@common/default'</span></span><br><span class="line"><span class="keyword">import</span> DocumentTitle <span class="keyword">from</span> <span class="string">'react-document-title'</span></span><br><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">'classnames'</span></span><br><span class="line"><span class="keyword">import</span> GlobalHeader <span class="keyword">from</span> <span class="string">'@comp/GlobalHeader'</span></span><br><span class="line"><span class="keyword">import</span> SiderMenu <span class="keyword">from</span> <span class="string">'@comp/SiderMenu/index.js'</span></span><br><span class="line"><span class="keyword">import</span> NotFound <span class="keyword">from</span> <span class="string">'@pages/Exception/500'</span></span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'@assets/favicon.jpg'</span></span><br><span class="line"><span class="keyword">import</span> dynamic <span class="keyword">from</span> <span class="string">'dva/dynamic'</span></span><br><span class="line"><span class="keyword">const</span> &#123; Content, Header, Footer &#125; = Layout</span><br><span class="line"></span><br><span class="line"><span class="comment">// wrapper of dynamic</span></span><br><span class="line"><span class="keyword">const</span> dynamicWrapper = <span class="function">(<span class="params">app, models, component</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> dynamic(&#123;</span><br><span class="line">    app,</span><br><span class="line">    models: <span class="function"><span class="params">()</span> =&gt;</span> ((models &amp;&amp; models.map(<span class="function"><span class="params">m</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">`@models/<span class="subst">$&#123;m&#125;</span>.js`</span>))) || [<span class="keyword">import</span>(<span class="string">`@models/refund.js`</span>)]),</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> component().then(<span class="function"><span class="params">raw</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> Component = raw.default || raw</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">props</span> =&gt;</span></span><br><span class="line">          createElement(Component, &#123;</span><br><span class="line">            ...props</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicLayout</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">const</span> &#123; app &#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      collapsed: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.routerConfig = routerData.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> component = dynamicWrapper(app, item.model, () =&gt; <span class="keyword">import</span>(<span class="string">'@pages/'</span> + item.component))</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;Route</span><br><span class="line">          key=&#123;index&#125;</span><br><span class="line">          path=&#123;item.path&#125;</span><br><span class="line">          title=&#123;item.name&#125;</span><br><span class="line">          component=&#123;component&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleMenuCollapse = <span class="function"><span class="params">collapsed</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      collapsed: !<span class="keyword">this</span>.state.collapsed</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.props.dispatch(&#123;</span><br><span class="line">      type: <span class="string">'global/changeLayoutCollapsed'</span>,</span><br><span class="line">      payload: !collapsed</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleMenuClick = <span class="function">(<span class="params">&#123; key &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">'logout'</span>) &#123;</span><br><span class="line">      accountLogout().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.sessionStorage.setItem(<span class="string">'dp-admin-auth'</span>, <span class="literal">null</span>)</span><br><span class="line">        <span class="built_in">window</span>.location.reload()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  handleCountryClick = <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`selected <span class="subst">$&#123;key&#125;</span>`</span>)</span><br><span class="line">    setCountry(key)</span><br><span class="line">    <span class="built_in">window</span>.location = <span class="built_in">window</span>.location.origin + <span class="string">'/'</span> + key</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; collapsed &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> layout = (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;SiderMenu</span><br><span class="line">          collapsed=&#123;collapsed&#125;</span><br><span class="line">          isMobile=&#123;<span class="keyword">this</span>.state.isMobile&#125;</span><br><span class="line">          onCollapse=&#123;<span class="keyword">this</span>.handleMenuCollapse&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Layout&gt;</span><br><span class="line">          &#123; &lt;Header style=&#123;&#123; <span class="attr">padding</span>: <span class="number">0</span> &#125;&#125;&gt;</span><br><span class="line">            &lt;GlobalHeader</span><br><span class="line">              logo=&#123;logo&#125;</span><br><span class="line">              collapsed=&#123;collapsed&#125;</span><br><span class="line">              isMobile=&#123;<span class="keyword">this</span>.state.isMobile&#125;</span><br><span class="line">              onCountryClick=&#123;<span class="keyword">this</span>.handleCountryClick&#125;</span><br><span class="line">              onMenuClick=&#123;<span class="keyword">this</span>.handleMenuClick&#125;</span><br><span class="line">              onCollapse=&#123;<span class="keyword">this</span>.handleMenuCollapse&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Header&gt; &#125;</span></span><br><span class="line"><span class="regexp">          &lt;Content style=&#123;&#123; margin: '24px 24px 0', height: '100%' &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">              &#123; this.routerConfig &#125;</span></span><br><span class="line"><span class="regexp">              &lt;Redirect exact from='/</span><span class="string">' to='</span>order/list<span class="string">' /&gt;</span></span><br><span class="line"><span class="string">              &lt;Route render=&#123;NotFound&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">          &lt;/Content&gt;</span></span><br><span class="line"><span class="string">          &lt;Footer style=&#123;&#123; padding: 0 &#125;&#125; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">      &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    return (</span></span><br><span class="line"><span class="string">      &lt;DocumentTitle title=&#123;layoutData.docTitle&#125;&gt;</span></span><br><span class="line"><span class="string">        &lt;ContainerQuery query=&#123;layoutData.query&#125;&gt;</span></span><br><span class="line"><span class="string">          &#123;params =&gt; &lt;div className=&#123;classNames(params)&#125;&gt;&#123;layout&#125;&lt;/div&gt;&#125;</span></span><br><span class="line"><span class="string">        &lt;/ContainerQuery&gt;</span></span><br><span class="line"><span class="string">      &lt;/DocumentTitle&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default connect((&#123; login, global &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="string">  collapsed: global.collapsed</span></span><br><span class="line"><span class="string">&#125;))(BasicLayout)</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>删掉那些多的模块一直做减法，遇到报错就google大概就差不多了</p>
<h3 id="六、-要安装的基础包大概如下"><a href="#六、-要安装的基础包大概如下" class="headerlink" title="六、 要安装的基础包大概如下"></a>六、 要安装的基础包大概如下</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[wepack]     |   webpack-cli webpack webpack-merge</span><br><span class="line">[react]      |   react react-dom</span><br><span class="line">[babel]      |   babel-loader @babel/preset-core @babel/preset-env @babel/preset-core</span><br><span class="line">[html]       |   html-webpack-plugin clean-webpack-plugin</span><br><span class="line">[js]         |   uglifyjs-webpack-plugin </span><br><span class="line">[css]        |   style-loader css-loader  mini-css-extract-plugin less-loader sass-loader node-sass </span><br><span class="line">[css]        |   optimize-css-assets-webpack-plugin postcss postcss_loader autoprefixer</span><br><span class="line">[devserver]  |   webpack-dev-server</span><br><span class="line">[anlyzer]    |   webpack-bundle-analyzer</span><br><span class="line">[eslint]     |   husky standardjs</span><br><span class="line">[pretty]     |   ora chalk</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/admin/" rel="tag"># admin</a>
              <a href="/tags/webpack/" rel="tag"># webpack</a>
              <a href="/tags/roadhog/" rel="tag"># roadhog</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/10/22/banner轮播图/" rel="prev" title="banner轮播图">
      <i class="fa fa-chevron-left"></i> banner轮播图
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/11/16/ant-pro替换-dva框架/" rel="next" title="ant-pro替换-dva框架">
      ant-pro替换-dva框架 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一、替换步骤概览（what）"><span class="nav-number">2.</span> <span class="nav-text">一、替换步骤概览（what）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、为什么要做替换呢-why"><span class="nav-number">3.</span> <span class="nav-text">二、为什么要做替换呢(why)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、首次迁移的遗留问题"><span class="nav-number">4.</span> <span class="nav-text">三、首次迁移的遗留问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、打包工具替换具体细节"><span class="nav-number">5.</span> <span class="nav-text">四、打包工具替换具体细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、路由相关地方替换细节"><span class="nav-number">6.</span> <span class="nav-text">五、路由相关地方替换细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#六、-要安装的基础包大概如下"><span class="nav-number">7.</span> <span class="nav-text">六、 要安装的基础包大概如下</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">weiqian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">weiqian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
